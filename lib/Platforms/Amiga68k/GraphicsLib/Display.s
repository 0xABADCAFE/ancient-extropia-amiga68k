
; Storm C Compiler
; extropialib:lib/Platforms/Amiga68k/GraphicsLib/Display.cpp
	mc68030
	mc68881
	XREF	_0dt__DRAWLIST__T
	XREF	Delete__xTEXFONT__T
	XREF	_0ct__xTEXSURF__T
	XREF	Delete__xTEXSURF__T
	XREF	ReadBody__xTEXSURF__TR05XSFIO
	XREF	WriteBody__xTEXSURF__TR05XSFIO
	XREF	ReadyForRead__xTEXSURF__T
	XREF	ReadyForWrite__xTEXSURF__T
	XREF	_0ct__XSFOBJ__T
	XREF	Set__XSFHEAD__TPCcUcUcUcUc
	XREF	op__equal__XSFHEAD__TR05XSFIO
	XREF	op__equal__XSFHEAD__TR07XSFHEAD
	XREF	op__notEqual__XSFHEAD__TR07XSFHEAD
	XREF	Value__XDATAID__TPCc
	XREF	MoveEvent__xDISPLAYIO__T
	XREF	ResizeEvent__xDISPLAYIO__T
	XREF	ViewSurface__xDISPLAY__T
	XREF	DrawSurface__xDISPLAY__T
	XREF	Refresh__xDISPLAY__T
	XREF	Close__xDISPLAY__T
	XREF	Open__xDISPLAY__T
	XREF	_0dt__LOCK__T
	XREF	_0dt__THREAD__T
	XREF	Sleep__THREAD__UjssUj
	XREF	Run__THREAD__T
	XREF	_0dt__DELAY__T
	XREF	_0ct__DELAY__T
	XREF	Pause__DELAY__TUj
	XREF	Pause__DELAY__TUjUj
	XREF	Abort__DELAY__T
	XREF	UnLink__xCHAINABLE__T
	XREF	Close__xFILEIO__T
	XREF	Flush__xFILEIO__T
	XREF	Write64Swap__xFILEIO__TPvUi
	XREF	Write32Swap__xFILEIO__TPvUi
	XREF	Write16Swap__xFILEIO__TPvUi
	XREF	Write__xFILEIO__TPvUiUi
	XREF	Read64Swap__xFILEIO__TPvUi
	XREF	Read32Swap__xFILEIO__TPvUi
	XREF	Read16Swap__xFILEIO__TPvUi
	XREF	Read__xFILEIO__TPvUiUi
	XREF	Tell__xFILEIO__T
	XREF	Seek__xFILEIO__Tjj
	XREF	Open__xFILEIO__TPCcjj
	XREF	SendPacket__xFILEIO__TPv
	XREF	WaitPacket__xFILEIO__T
	XREF	InputQueued__xINPUT__T
	XREF	Idle__xINPUT__T
	XREF	ExitEvent__xINPUT__T
	XREF	MouseEvent__xINPUT__Tjjj
	XREF	ApplyInputModification__xINPUT__T
	XREF	_0dt__xKEY__T
	XREF	_0ct__xKEY__T
	XREF	KeyEvent__xKEY__Tjsj
	XREF	KeyToChar__xKEY__P12IntuiMessage
	XREF	_0dt__xSURFACE__T
	XREF	Delete__xSURFACE__T
	XREF	Create__xSURFACE__TssP08xSURFACE
	XREF	Attach__xSURFACE__Tr14P06BitMap
	XREF	Attach__xSURFACE__Tr14P08RastPort
	XREF	_0dt__POOL_ST__T
	XREF	_0ct__POOL_ST__TUsUj
	XREF	FreeT__POOL_ST__TPv
	XREF	NewT__POOL_ST__TPvUs
	XREF	NewT__POOL_ST__TPv
	XREF	Create__POOL_ST__TUsUj
	XREF	_0dt__POOL_LT__T
	XREF	DrawSurface__x3D__P08xSURFACE
	XREF	v3DrawLineStrip__x3D__jj
	XREF	v3DrawLines__x3D__jj
	XREF	_W3D_DrawArray
	XREF	_W3D_BindTexture
	XREF	_strncpy
	XREF	_system
	XREF	_vsprintf
	XREF	_std__in
	XREF	_std__out
	XREF	_std__err
	XREF	_st
	XREF	_gxSt
	XREF	_numStartArgs__xBASELIB
	XREF	_startArgs__xBASELIB
	XREF	_SysBase
	XREF	_IntuitionBase
	XREF	_TimerBase
	XREF	_DOSBase
	XREF	_PowerPCBase
	XREF	_sysData__sysBASELIB
	XREF	_msgbuff__sysBASELIB
	XREF	_main__sysBASELIB
	XREF	_allocated__MEM
	XREF	_totSize__MEM
	XREF	_nextFree__MEM
	XREF	_cnt__MEM
	XREF	_maxAllocs__MEM
	XREF	_fpuPrecision__CPU
	XREF	_cpuNames__CPU
	XREF	_GfxBase
	XREF	_CyberGfxBase
	XREF	_surfaceTypes__x2D
	XREF	_Warp3DBase
	XREF	_hw3D__sys3DDEVICE
	XREF	_context__sys3DDEVICE
	XREF	_drawRegion__x3D
	XREF	_fogData__x3D
	XREF	_flags__x3D
	XREF	_vertices__x3D
	XREF	_currTex__x3D
	XREF	_drawSurface__x3D
	XREF	_currCol__x3D
	XREF	_useV4__x3D
	XREF	_flags__xGFX
	XREF	_mode__xGFX
	XREF	_numModes__xGFX
	XREF	_rPool__xSURFACE
	XREF	_KeymapBase
	XREF	_useCount__xKEY
	XREF	_TimerBase__MILLICLOCK
	XREF	_current__MILLICLOCK
	XREF	_clockFreq__MILLICLOCK
	XREF	_threadCnt__THREAD
	XREF	_threadsIdle__THREAD
	XREF	_rootThread__THREAD
	XREF	_sigXSF__XSFHEAD
	XREF	_fileMarker__XSFOBJ
	XREF	_DiskfontBase
	XREF	_flags__DRAW
	XREF	_stack__VGPU
	XREF	_stackPos__VGPU
	XREF	_vertexBase__VGPU
	XREF	_vertexTop__VGPU
	XREF	_dataPos__VGPU
	XREF	_instPos__VGPU
	XREF	_exe_flags__VGPU
	XREF	_exe_stateReg__VGPU
	XREF	_exe_colourReg__VGPU
	XREF	_exe_texReg__VGPU
	XREF	_exe_fogReg__VGPU
	XREF	_exe_errReg__VGPU
	XREF	_funcTab__VGPU
	XREF	_qTrigTab__DRAWLIST

	SECTION "Round16__r23d:0",CODE

	rts

	SECTION "MessageBox__xDISPLAY__TPcPcPce:0",CODE


;sint32 xDISPLAY::MessageBox(char* title, char* opts, char* body,...)
	XDEF	MessageBox__xDISPLAY__TPcPcPce
MessageBox__xDISPLAY__TPcPcPce
L153	EQU	-$118
	link	a5,#L153
	movem.l	d2/a2/a3/a6,-(a7)
	movem.l	$8(a5),a2/a6
	move.l	$10(a5),a3
L152
;	va_start(arglist,body)
	lea	$14(a5),a0
	move.l	a0,d2
	addq.l	#4,d2
;	vsprintf(msgbuff,body,arglist);
	move.l	d2,-(a7)
	move.l	$14(a5),-(a7)
	pea	-$100(a5)
	jsr	_vsprintf
	add.w	#$C,a7
;	EasyStruct mb = {sizeof(EasyStruct),0,title, msgbuff, o
	lea	-$118(a5),a0
	move.l	#$14,(a0)+
	clr.l	(a0)+
	move.l	a6,(a0)+
	lea	-$100(a5),a1
	move.l	a1,(a0)+
	move.l	a3,(a0)
;	return EasyRequest(win, &mb, 0, arglist);
	move.l	d2,-(a7)
	move.l	$4A(a2),a0
	move.l	_IntuitionBase,a6
	lea	-$118(a5),a1
	sub.l	a2,a2
	move.l	a7,a3
	jsr	-$24C(a6)
	addq.w	#4,a7
	movem.l	(a7)+,d2/a2/a3/a6
	unlk	a5
	rts

	SECTION "Free__xDBWIN__T:0",CODE


;void xDBWIN::Free()
	XDEF	Free__xDBWIN__T
Free__xDBWIN__T
	movem.l	a2/a6,-(a7)
	move.l	$C(a7),a2
L154
;	disp.Delete();
	pea	$7A(a2)
	jsr	Delete__xSURFACE__T
	addq.w	#4,a7
;	bBuf.Delete();
	pea	$5A(a2)
	jsr	Delete__xSURFACE__T
	addq.w	#4,a7
;	if (win)
	move.l	a2,a1
	tst.l	$4A(a1)
	beq.b	L156
L155
;		CloseWindow(win);
	move.l	a2,a1
	move.l	_IntuitionBase,a6
	move.l	$4A(a1),a0
	jsr	-$48(a6)
;		win = 0;
	move.l	a2,a1
	clr.l	$4A(a1)
L156
;	if (scr)
	move.l	a2,a1
	tst.l	$46(a1)
	beq.b	L158
L157
;		UnlockPubScreen(0, scr);
	move.l	a2,a0
	move.l	$46(a0),a1
	move.l	_IntuitionBase,a6
	sub.l	a0,a0
	jsr	-$204(a6)
;		scr = 0;
	move.l	a2,a1
	clr.l	$46(a1)
L158
;	format = SURF_NONE;
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L160
L159
	move.l	(a0),a0
L160
	move.w	#$F,6(a0)
;	flags &= ~WIN_OPEN;
	move.l	a2,a0
	move.l	$52(a0),d0
	and.l	#-2,d0
	move.l	a2,a0
	move.l	d0,$52(a0)
	movem.l	(a7)+,a2/a6
	rts

	SECTION "Set__xDBWIN__TsssssPCc:0",CODE


;sint32 xDBWIN::Set(S_RECT, sint16 d, const char* title)
	XDEF	Set__xDBWIN__TsssssPCc
Set__xDBWIN__TsssssPCc
	movem.l	d2-d7/a2,-(a7)
	move.w	$2C(a7),d3
	move.w	$2A(a7),d4
	move.w	$28(a7),d5
	move.w	$26(a7),d6
	move.w	$24(a7),d7
	move.l	$20(a7),a0
	move.l	$2E(a7),a2
L161
;	if (flags & WIN_OPEN)
	move.l	$52(a0),d0
	and.l	#1,d0
	beq.b	L163
L162
;		return ERR_RSC_LOCKED;
	move.l	#-$3050004,d0
	movem.l	(a7)+,d2-d7/a2
	rts
L163
;	if (x < 0 || y < 0 || w < W_MIN_WIDTH || h < W_MIN_HEIGHT || d < 8
	tst.w	d7
	bmi.b	L169
L164
	tst.w	d6
	bmi.b	L169
L165
	cmp.w	#$80,d5
	blt.b	L169
L166
	cmp.w	#$80,d4
	blt.b	L169
L167
	cmp.w	#$8,d3
	blt.b	L169
L168
	cmp.w	#$20,d3
	ble.b	L170
L169
;		return ERR_VALUE_ILLEGAL;
	move.l	#-$3010001,d0
	movem.l	(a7)+,d2-d7/a2
	rts
L170
;	width		= ClipInt(w, W_MIN_WIDTH, S_MAX_WIDTH);
	move.l	#$640,d2
	move.l	#$80,d1
	move.w	d5,d0
	ext.l	d0
	cmp.l	d1,d0
	bge.b	L172
L171
	move.l	d1,d0
	bra.b	L176
L172
	cmp.l	d2,d0
	ble.b	L174
L173
	move.l	d2,d0
L174
L175
L176
	move.l	a0,a1
	cmp.w	#0,a1
	beq.b	L178
L177
	move.l	(a1),a1
L178
	move.w	d0,(a1)
;	height	= ClipInt(h, W_MIN_HEIGHT, S_MAX_HEIGHT);
	move.l	#$4B0,d2
	move.l	#$80,d1
	move.w	d4,d0
	ext.l	d0
	cmp.l	d1,d0
	bge.b	L180
L179
	move.l	d1,d0
	bra.b	L184
L180
	cmp.l	d2,d0
	ble.b	L182
L181
	move.l	d2,d0
L182
L183
L184
	move.l	a0,a1
	cmp.w	#0,a1
	beq.b	L186
L185
	move.l	(a1),a1
L186
	move.w	d0,2(a1)
;	left		= ClipInt(x, 0, S_MAX_WIDTH-width);
	move.l	a0,a1
	cmp.w	#0,a1
	beq.b	L188
L187
	move.l	(a1),a1
L188
	move.w	(a1),d0
	ext.l	d0
	move.l	#$640,d2
	sub.l	d0,d2
	moveq	#0,d1
	move.w	d7,d0
	ext.l	d0
	cmp.l	d1,d0
	bge.b	L190
L189
	move.l	d1,d0
	bra.b	L194
L190
	cmp.l	d2,d0
	ble.b	L192
L191
	move.l	d2,d0
L192
L193
L194
	move.w	d0,$56(a0)
;	top			= ClipInt(y, 0, S_MAX_HEIGHT-height);
	move.l	a0,a1
	cmp.w	#0,a1
	beq.b	L196
L195
	move.l	(a1),a1
L196
	move.w	2(a1),d0
	ext.l	d0
	move.l	#$4B0,d2
	sub.l	d0,d2
	moveq	#0,d1
	move.w	d6,d0
	ext.l	d0
	cmp.l	d1,d0
	bge.b	L198
L197
	move.l	d1,d0
	bra.b	L202
L198
	cmp.l	d2,d0
	ble.b	L200
L199
	move.l	d2,d0
L200
L201
L202
	move.w	d0,$58(a0)
;	depth		= d;
	move.l	a0,a1
	cmp.w	#0,a1
	beq.b	L204
L203
	move.l	(a1),a1
L204
	move.w	d3,4(a1)
;	strncpy(name, title, 63);
	pea	$3F.w
	move.l	a2,-(a7)
	pea	5(a0)
	jsr	_strncpy
	add.w	#$C,a7
;	return OK;
	moveq	#0,d0
	movem.l	(a7)+,d2-d7/a2
	rts

	SECTION "Open__xDBWIN__T:0",CODE


;sint32 xDBWIN::Open()
	XDEF	Open__xDBWIN__T
Open__xDBWIN__T
	movem.l	d2-d4/a2/a6,-(a7)
	move.l	$18(a7),a2
L205
;	if (flags & WIN_OPEN)
	move.l	a2,a0
	move.l	$52(a0),d0
	and.l	#1,d0
	beq.b	L207
L206
;		return OK;
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a6
	rts
L207
;	scr = LockPubScreen(0);
	move.l	_IntuitionBase,a6
	sub.l	a0,a0
	jsr	-$1FE(a6)
	move.l	a2,a1
	move.l	d0,$46(a1)
;	if (!scr)
	move.l	a2,a1
	tst.l	$46(a1)
	bne.b	L209
L208
;		Free();
	move.l	a2,-(a7)
	jsr	Free__xDBWIN__T
	addq.w	#4,a7
;		flags |= SCR_LOCK_FAILED;
	move.l	a2,a0
	move.l	$52(a0),d0
	or.l	#$100,d0
	move.l	a2,a0
	move.l	d0,$52(a0)
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,d2-d4/a2/a6
	rts
L209
;	if (GetCyberMapAttr(scr->RastPort.BitMap, CYBRMATTR_ISCYBERGFX)==f
	move.l	a2,a1
	move.l	$46(a1),a0
	move.l	_CyberGfxBase,a6
	move.l	#$80000008,d0
	move.l	$58(a0),a0
	jsr	-$60(a6)
	tst.l	d0
	bne.b	L211
L210
;		Free();
	move.l	a2,-(a7)
	jsr	Free__xDBWIN__T
	addq.w	#4,a7
;		flags |= SCR_TYPE_FAILED;
	move.l	a2,a0
	move.l	$52(a0),d0
	or.l	#$200,d0
	move.l	a2,a0
	move.l	d0,$52(a0)
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,d2-d4/a2/a6
	rts
L211
;		sint16 d = GetCyberMapAttr(scr->RastPort.BitMap, CYBRMATTR_DEPTH)
	move.l	a2,a1
	move.l	$46(a1),a0
	move.l	_CyberGfxBase,a6
	move.l	#$80000007,d0
	move.l	$58(a0),a0
	jsr	-$60(a6)
;		if (depth > d)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L213
L212
	move.l	(a0),a0
L213
	move.w	4(a0),d1
	cmp.w	d0,d1
	ble.b	L215
L214
;			Free();
	move.l	a2,-(a7)
	jsr	Free__xDBWIN__T
	addq.w	#4,a7
;			flags |= SCR_DEPTH_FAILED;
	move.l	a2,a0
	move.l	$52(a0),d0
	or.l	#$400,d0
	move.l	a2,a0
	move.l	d0,$52(a0)
;			return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,d2-d4/a2/a6
	rts
L215
;		depth		= d;
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L217
L216
	move.l	(a0),a0
L217
	move.w	d0,4(a0)
;		format	= GetCyberMapAttr(scr->RastPort.BitMap, CYBRMATTR_PIXFMT);
	move.l	a2,a1
	move.l	$46(a1),a0
	move.l	_CyberGfxBase,a6
	move.l	#$80000004,d0
	move.l	$58(a0),a0
	jsr	-$60(a6)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L219
L218
	move.l	(a0),a0
L219
	move.w	d0,6(a0)
;		sint16 scrw = GetCyberMapAttr(scr->RastPort.BitMap, CYBRMATTR_WI
	move.l	a2,a1
	move.l	$46(a1),a0
	move.l	_CyberGfxBase,a6
	move.l	#$80000005,d0
	move.l	$58(a0),a0
	jsr	-$60(a6)
	move.w	d0,d4
;		sint16 scrh = GetCyberMapAttr(scr->RastPort.BitMap, CYBRMATTR_HE
	move.l	a2,a1
	move.l	$46(a1),a0
	move.l	_CyberGfxBase,a6
	move.l	#$80000006,d0
	move.l	$58(a0),a0
	jsr	-$60(a6)
;		width		= ClipInt(width, W_MIN_WIDTH, scrw);
	move.w	d4,d3
	ext.l	d3
	move.l	#$80,d2
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L221
L220
	move.l	(a0),a0
L221
	move.w	(a0),d1
	ext.l	d1
	cmp.l	d2,d1
	bge.b	L223
L222
	move.l	d2,d1
	bra.b	L227
L223
	cmp.l	d3,d1
	ble.b	L225
L224
	move.l	d3,d1
L225
L226
L227
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L229
L228
	move.l	(a0),a0
L229
	move.w	d1,(a0)
;		height	= ClipInt(height, W_MIN_HEIGHT, scrh);
	move.w	d0,d3
	ext.l	d3
	move.l	#$80,d2
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L231
L230
	move.l	(a0),a0
L231
	move.w	2(a0),d1
	ext.l	d1
	cmp.l	d2,d1
	bge.b	L233
L232
	move.l	d2,d1
	bra.b	L237
L233
	cmp.l	d3,d1
	ble.b	L235
L234
	move.l	d3,d1
L235
L236
L237
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L239
L238
	move.l	(a0),a0
L239
	move.w	d1,2(a0)
;		left		= ClipInt(left, 0, scrw-width);
	move.w	d4,d2
	ext.l	d2
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L241
L240
	move.l	(a0),a0
L241
	move.w	(a0),d1
	ext.l	d1
	sub.l	d1,d2
	moveq	#0,d3
	move.l	a2,a0
	move.w	$56(a0),d1
	ext.l	d1
	cmp.l	d3,d1
	bge.b	L243
L242
	move.l	d3,d1
	bra.b	L247
L243
	cmp.l	d2,d1
	ble.b	L245
L244
	move.l	d2,d1
L245
L246
L247
	move.l	a2,a0
	move.w	d1,$56(a0)
;		top			= ClipInt(top, 0, scrh-height);
	ext.l	d0
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L249
L248
	move.l	(a0),a0
L249
	move.w	2(a0),d1
	ext.l	d1
	sub.l	d1,d0
	moveq	#0,d2
	move.l	a2,a0
	move.w	$58(a0),d1
	ext.l	d1
	cmp.l	d2,d1
	bge.b	L251
L250
	move.l	d2,d1
	bra.b	L255
L251
	cmp.l	d0,d1
	ble.b	L253
L252
	move.l	d0,d1
L253
L254
L255
	move.l	a2,a0
	move.w	d1,$58(a0)
;		win = OpenWindowTags(0,
	clr.l	-(a7)
	move.l	#$10202,-(a7)
	move.l	#$8000006B,-(a7)
	pea	1.w
	move.l	#$80000083,-(a7)
	pea	5(a2)
	move.l	#$8000006E,-(a7)
	move.l	a2,a0
	move.w	$58(a0),d0
	ext.l	d0
	move.l	d0,-(a7)
	move.l	#$80000065,-(a7)
	move.l	a2,a0
	move.w	$56(a0),d0
	ext.l	d0
	move.l	d0,-(a7)
	move.l	#$80000064,-(a7)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L257
L256
	move.l	(a0),a0
L257
	move.w	2(a0),d0
	ext.l	d0
	move.l	d0,-(a7)
	move.l	#$80000077,-(a7)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L259
L258
	move.l	(a0),a0
L259
	move.w	(a0),d0
	ext.l	d0
	move.l	d0,-(a7)
	move.l	#$80000076,-(a7)
	move.l	a2,a1
	move.l	$46(a1),-(a7)
	move.l	#$80000079,-(a7)
	move.l	_IntuitionBase,a6
	sub.l	a0,a0
	move.l	a7,a1
	jsr	-$25E(a6)
	add.w	#$44,a7
	move.l	a2,a1
	move.l	d0,$4A(a1)
;	if (!win)
	move.l	a2,a1
	tst.l	$4A(a1)
	bne.b	L261
L260
;		Free();
	move.l	a2,-(a7)
	jsr	Free__xDBWIN__T
	addq.w	#4,a7
;		flags |= WIN_OPEN_FAILED;
	move.l	a2,a0
	move.l	$52(a0),d0
	or.l	#$800,d0
	move.l	a2,a0
	move.l	d0,$52(a0)
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,d2-d4/a2/a6
	rts
L261
;	if (disp.Attach(win->RPort)!=OK)
	move.l	a2,a1
	move.l	$4A(a1),a0
	move.l	$32(a0),a6
	pea	$7A(a2)
	jsr	Attach__xSURFACE__Tr14P08RastPort
	addq.w	#4,a7
	tst.l	d0
	beq.b	L263
L262
;		Free();
	move.l	a2,-(a7)
	jsr	Free__xDBWIN__T
	addq.w	#4,a7
;		flags |= WIN_SURF_FAILED;
	move.l	a2,a0
	move.l	$52(a0),d0
	or.l	#$1000,d0
	move.l	a2,a0
	move.l	d0,$52(a0)
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,d2-d4/a2/a6
	rts
L263
;	if (bBuf.Create(width, height, &disp)!=OK)
	pea	$7A(a2)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L265
L264
	move.l	(a0),a0
L265
	move.w	2(a0),-(a7)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L267
L266
	move.l	(a0),a0
L267
	move.w	(a0),-(a7)
	pea	$5A(a2)
	jsr	Create__xSURFACE__TssP08xSURFACE
	add.w	#$C,a7
	tst.l	d0
	beq.b	L269
L268
;		Free();
	move.l	a2,-(a7)
	jsr	Free__xDBWIN__T
	addq.w	#4,a7
;		flags |= BUF_ALLOC_FAILED;
	move.l	a2,a0
	move.l	$52(a0),d0
	or.l	#$2000,d0
	move.l	a2,a0
	move.l	d0,$52(a0)
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,d2-d4/a2/a6
	rts
L269
;	return OK;
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a6
	rts

	SECTION "Close__xDBWIN__T:0",CODE


;sint32 xDBWIN::Close()
	XDEF	Close__xDBWIN__T
Close__xDBWIN__T
	move.l	4(a7),a0
L270
;	Free();
	move.l	a0,-(a7)
	jsr	Free__xDBWIN__T
	addq.w	#4,a7
;	return OK;
	moveq	#0,d0
	rts

	SECTION "Set__xSCREEN__TP06xDMODEPCc:0",CODE


;sint32 xSCREEN::Set(xDMODE* mode, const char* title)
	XDEF	Set__xSCREEN__TP06xDMODEPCc
Set__xSCREEN__TP06xDMODEPCc
	movem.l	a2/a3/a6,-(a7)
	movem.l	$14(a7),a2/a6
	move.l	$10(a7),a3
L271
;	if (!mode || scr)
	cmp.w	#0,a2
	beq.b	L273
L272
	move.l	a3,a1
	tst.l	$46(a1)
	beq.b	L274
L273
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,a2/a3/a6
	rts
L274
;	modeID	= mode->MachineID();
	move.l	a3,a0
	move.l	$C(a2),$72(a0)
;	width		= mode->Width();
	move.l	a2,a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$2C(a1),d0
	move.l	d0,-(a7)
	move.l	$28(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L276
L275
	move.l	(a0),a0
L276
	move.w	d0,(a0)
;	height	= mode->Height();
	move.l	a2,a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$24(a1),d0
	move.l	d0,-(a7)
	move.l	$20(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L278
L277
	move.l	(a0),a0
L278
	move.w	d0,2(a0)
;	depth		= mode->Depth();
	move.l	a2,a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$1C(a1),d0
	move.l	d0,-(a7)
	move.l	$18(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L280
L279
	move.l	(a0),a0
L280
	move.w	d0,4(a0)
;	format	= mode->Format();
	move.l	$8(a2),a0
	move.l	a2,d0
	add.l	$14(a0),d0
	move.l	d0,-(a7)
	move.l	$10(a0),a0
	jsr	(a0)
	addq.w	#4,a7
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L282
L281
	move.l	(a0),a0
L282
	move.w	d0,6(a0)
;	strncpy(name, title, 63);
	pea	$3F.w
	move.l	a6,-(a7)
	pea	5(a3)
	jsr	_strncpy
	add.w	#$C,a7
;	return OK;
	moveq	#0,d0
	movem.l	(a7)+,a2/a3/a6
	rts

	SECTION "Open__xSCREEN__T:0",CODE


;sint32	xSCREEN::Open()
	XDEF	Open__xSCREEN__T
Open__xSCREEN__T
	movem.l	a2/a6,-(a7)
	move.l	$C(a7),a2
L283
;	if (scr)
	move.l	a2,a1
	tst.l	$46(a1)
	beq.b	L285
L284
;		return ERR_RSC;
	move.l	#-$3050000,d0
	movem.l	(a7)+,a2/a6
	rts
L285
;	scr = OpenScreenTags(0,
	clr.l	-(a7)
	pea	5(a2)
	move.l	#$80000028,-(a7)
	clr.l	-(a7)
	move.l	#$8000003E,-(a7)
	clr.l	-(a7)
	move.l	#$80000036,-(a7)
	move.l	a2,a0
	move.l	$72(a0),-(a7)
	move.l	#$80000032,-(a7)
	pea	$8.w
	move.l	#$80000025,-(a7)
	move.l	_IntuitionBase,a6
	sub.l	a0,a0
	move.l	a7,a1
	jsr	-$264(a6)
	add.w	#$2C,a7
	move.l	a2,a1
	move.l	d0,$46(a1)
;	if (!scr)
	move.l	a2,a1
	tst.l	$46(a1)
	bne.b	L287
L286
;		Free();
	move.l	a2,-(a7)
	jsr	Free__xSCREEN__T
	addq.w	#4,a7
;		flags |= SCR_OPEN_FAILED;
	move.l	a2,a0
	move.l	$76(a0),d0
	or.l	#$100,d0
	move.l	a2,a0
	move.l	d0,$76(a0)
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,a2/a6
	rts
L287
;	win = OpenWindowTags(0,
	clr.l	-(a7)
	move.l	#$11B00,-(a7)
	move.l	#$8000006B,-(a7)
	clr.l	-(a7)
	move.l	#$8000006E,-(a7)
	clr.l	-(a7)
	move.l	#$80000065,-(a7)
	clr.l	-(a7)
	move.l	#$80000064,-(a7)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L289
L288
	move.l	(a0),a0
L289
	move.w	2(a0),d0
	ext.l	d0
	move.l	d0,-(a7)
	move.l	#$80000067,-(a7)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L291
L290
	move.l	(a0),a0
L291
	move.w	(a0),d0
	ext.l	d0
	move.l	d0,-(a7)
	move.l	#$80000066,-(a7)
	move.l	a2,a1
	move.l	$46(a1),-(a7)
	move.l	#$80000070,-(a7)
	move.l	_IntuitionBase,a6
	sub.l	a0,a0
	move.l	a7,a1
	jsr	-$25E(a6)
	add.w	#$3C,a7
	move.l	a2,a1
	move.l	d0,$4A(a1)
;	if (!win)
	move.l	a2,a1
	tst.l	$4A(a1)
	bne.b	L293
L292
;		Free();
	move.l	a2,-(a7)
	jsr	Free__xSCREEN__T
	addq.w	#4,a7
;		flags |= WIN_OPEN_FAILED;
	move.l	a2,a0
	move.l	$76(a0),d0
	or.l	#$800,d0
	move.l	a2,a0
	move.l	d0,$76(a0)
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,a2/a6
	rts
L293
;	if (surf.Attach(scr->RastPort.BitMap)!=OK)
	move.l	a2,a1
	move.l	$46(a1),a0
	move.l	$58(a0),a6
	pea	$52(a2)
	jsr	Attach__xSURFACE__Tr14P06BitMap
	addq.w	#4,a7
	tst.l	d0
	beq.b	L295
L294
;		Free();
	move.l	a2,-(a7)
	jsr	Free__xSCREEN__T
	addq.w	#4,a7
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,a2/a6
	rts
L295
;	flags |= WIN_OPEN;
	move.l	a2,a0
	move.l	$76(a0),d0
	or.l	#1,d0
	move.l	a2,a0
	move.l	d0,$76(a0)
;	return OK;
	moveq	#0,d0
	movem.l	(a7)+,a2/a6
	rts

	SECTION "Free__xSCREEN__T:0",CODE


;void	xSCREEN::Free()
	XDEF	Free__xSCREEN__T
Free__xSCREEN__T
	movem.l	a2/a6,-(a7)
	move.l	$C(a7),a2
L296
;	surf.Delete();
	pea	$52(a2)
	jsr	Delete__xSURFACE__T
	addq.w	#4,a7
;	if (scr)
	move.l	a2,a1
	tst.l	$46(a1)
	beq.b	L300
L297
;		if (win)
	move.l	a2,a1
	tst.l	$4A(a1)
	beq.b	L299
L298
;			CloseWindow(win);
	move.l	a2,a1
	move.l	_IntuitionBase,a6
	move.l	$4A(a1),a0
	jsr	-$48(a6)
;			win = 0;
	move.l	a2,a1
	clr.l	$4A(a1)
L299
;		CloseScreen(scr);
	move.l	a2,a1
	move.l	_IntuitionBase,a6
	move.l	$46(a1),a0
	jsr	-$42(a6)
;		scr = 0;
	move.l	a2,a1
	clr.l	$46(a1)
L300
;	flags &= ~WIN_OPEN;
	move.l	a2,a0
	move.l	$76(a0),d0
	and.l	#-2,d0
	move.l	a2,a0
	move.l	d0,$76(a0)
	movem.l	(a7)+,a2/a6
	rts

	SECTION "Close__xSCREEN__T:0",CODE


;sint32	xSCREEN::Close()
	XDEF	Close__xSCREEN__T
Close__xSCREEN__T
	move.l	4(a7),a0
L301
;	Free();
	move.l	a0,-(a7)
	jsr	Free__xSCREEN__T
	addq.w	#4,a7
;	return OK;
	moveq	#0,d0
	rts

	SECTION "_0ct__xDBSCREEN__T:0",CODE


;xDBSCREEN::xDBSCREEN()
	XDEF	_0ct__xDBSCREEN__T
_0ct__xDBSCREEN__T
	move.l	a2,-(a7)
	move.l	$8(a7),a1
L302
	move.l	a1,a2
	btst	#0,4(a2)
	beq.b	L304
L303
	move.l	(a2),a0
	clr.w	(a0)
	clr.w	2(a0)
	clr.w	4(a0)
	move.w	#$F,6(a0)
L304
	clr.l	$46(a2)
	clr.l	$4A(a2)
	lea	$52(a1),a0
	moveq	#1,d0
L305
	clr.w	(a0)
	clr.w	2(a0)
	clr.w	4(a0)
	move.w	#$F,6(a0)
	clr.l	$C(a0)
	clr.l	$10(a0)
	clr.l	$14(a0)
	clr.l	$18(a0)
	clr.l	$1C(a0)
	add.w	#$20,a0
	subq.l	#1,d0
	tst.l	d0
	bpl.b	L305
L306
	clr.l	$9E(a1)
	clr.l	$A2(a1)
;	buffer[0]=0;
	clr.l	$92(a1)
; buffer[1]=0;
	lea	$92(a1),a0
	clr.l	4(a0)
	move.l	(a7)+,a2
	rts

	SECTION "_0ct__xDBSCREEN__TP06xDMODEPCc:0",CODE


;xDBSCREEN::xDBSCREEN(xDMODE* mode, const char* title) 
	XDEF	_0ct__xDBSCREEN__TP06xDMODEPCc
_0ct__xDBSCREEN__TP06xDMODEPCc
	movem.l	a2/a3/a6,-(a7)
	movem.l	$10(a7),a1/a3/a6
L307
	move.l	a1,a2
	btst	#0,4(a2)
	beq.b	L309
L308
	move.l	(a2),a0
	clr.w	(a0)
	clr.w	2(a0)
	clr.w	4(a0)
	move.w	#$F,6(a0)
L309
	clr.l	$46(a2)
	clr.l	$4A(a2)
	lea	$52(a1),a0
	moveq	#1,d0
L310
	clr.w	(a0)
	clr.w	2(a0)
	clr.w	4(a0)
	move.w	#$F,6(a0)
	clr.l	$C(a0)
	clr.l	$10(a0)
	clr.l	$14(a0)
	clr.l	$18(a0)
	clr.l	$1C(a0)
	add.w	#$20,a0
	subq.l	#1,d0
	tst.l	d0
	bpl.b	L310
L311
	clr.l	$9E(a1)
	clr.l	$A2(a1)
;	buffer[0]=0;
	clr.l	$92(a1)
; buffer[1]=0;
	lea	$92(a1),a0
	clr.l	4(a0)
;	Set(mode, title);
	move.l	a6,-(a7)
	move.l	a3,-(a7)
	move.l	a1,-(a7)
	jsr	Set__xDBSCREEN__TP06xDMODEPCc
	add.w	#$C,a7
	movem.l	(a7)+,a2/a3/a6
	rts

	SECTION "Set__xDBSCREEN__TP06xDMODEPCc:0",CODE


;sint32 xDBSCREEN::Set(xDMODE* mode, const char* title)
	XDEF	Set__xDBSCREEN__TP06xDMODEPCc
Set__xDBSCREEN__TP06xDMODEPCc
	movem.l	a2/a3/a6,-(a7)
	movem.l	$14(a7),a2/a6
	move.l	$10(a7),a3
L312
;	if (!mode || scr)
	cmp.w	#0,a2
	beq.b	L314
L313
	move.l	a3,a1
	tst.l	$46(a1)
	beq.b	L315
L314
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,a2/a3/a6
	rts
L315
;	modeID	= mode->MachineID();
	move.l	a3,a0
	move.l	$C(a2),$9A(a0)
;	width		= mode->Width();
	move.l	a2,a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$2C(a1),d0
	move.l	d0,-(a7)
	move.l	$28(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L317
L316
	move.l	(a0),a0
L317
	move.w	d0,(a0)
;	height	= mode->Height();
	move.l	a2,a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$24(a1),d0
	move.l	d0,-(a7)
	move.l	$20(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L319
L318
	move.l	(a0),a0
L319
	move.w	d0,2(a0)
;	depth		= mode->Depth();
	move.l	a2,a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$1C(a1),d0
	move.l	d0,-(a7)
	move.l	$18(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L321
L320
	move.l	(a0),a0
L321
	move.w	d0,4(a0)
;	format	= mode->Format();
	move.l	$8(a2),a0
	move.l	a2,d0
	add.l	$14(a0),d0
	move.l	d0,-(a7)
	move.l	$10(a0),a0
	jsr	(a0)
	addq.w	#4,a7
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L323
L322
	move.l	(a0),a0
L323
	move.w	d0,6(a0)
;	strncpy(name, title, 63);
	pea	$3F.w
	move.l	a6,-(a7)
	pea	5(a3)
	jsr	_strncpy
	add.w	#$C,a7
;	return OK;
	moveq	#0,d0
	movem.l	(a7)+,a2/a3/a6
	rts

	SECTION "Open__xDBSCREEN__T:0",CODE


;sint32	xDBSCREEN::Open()
	XDEF	Open__xDBSCREEN__T
Open__xDBSCREEN__T
	movem.l	a2/a6,-(a7)
	move.l	$C(a7),a2
L324
;	if (scr)
	move.l	a2,a1
	tst.l	$46(a1)
	beq.b	L326
L325
;		return ERR_RSC;
	move.l	#-$3050000,d0
	movem.l	(a7)+,a2/a6
	rts
L326
;	scr = OpenScreenTags(0,
	clr.l	-(a7)
	pea	5(a2)
	move.l	#$80000028,-(a7)
	clr.l	-(a7)
	move.l	#$8000003E,-(a7)
	clr.l	-(a7)
	move.l	#$80000036,-(a7)
	move.l	a2,a0
	move.l	$9A(a0),-(a7)
	move.l	#$80000032,-(a7)
	pea	$8.w
	move.l	#$80000025,-(a7)
	move.l	_IntuitionBase,a6
	sub.l	a0,a0
	move.l	a7,a1
	jsr	-$264(a6)
	add.w	#$2C,a7
	move.l	a2,a1
	move.l	d0,$46(a1)
;	if (!scr)
	move.l	a2,a1
	tst.l	$46(a1)
	bne.b	L328
L327
;		flags |= SCR_OPEN_FAILED;
	move.l	a2,a0
	move.l	$A2(a0),d0
	or.l	#$100,d0
	move.l	a2,a0
	move.l	d0,$A2(a0)
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,a2/a6
	rts
L328
;	win = OpenWindowTags(0,
	clr.l	-(a7)
	move.l	#$11B00,-(a7)
	move.l	#$8000006B,-(a7)
	clr.l	-(a7)
	move.l	#$8000006E,-(a7)
	clr.l	-(a7)
	move.l	#$80000065,-(a7)
	clr.l	-(a7)
	move.l	#$80000064,-(a7)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L330
L329
	move.l	(a0),a0
L330
	move.w	2(a0),d0
	ext.l	d0
	move.l	d0,-(a7)
	move.l	#$80000067,-(a7)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L332
L331
	move.l	(a0),a0
L332
	move.w	(a0),d0
	ext.l	d0
	move.l	d0,-(a7)
	move.l	#$80000066,-(a7)
	move.l	a2,a1
	move.l	$46(a1),-(a7)
	move.l	#$80000070,-(a7)
	move.l	_IntuitionBase,a6
	sub.l	a0,a0
	move.l	a7,a1
	jsr	-$25E(a6)
	add.w	#$3C,a7
	move.l	a2,a1
	move.l	d0,$4A(a1)
;	if (!win)
	move.l	a2,a1
	tst.l	$4A(a1)
	bne.b	L334
L333
;		Free();
	move.l	a2,-(a7)
	jsr	Free__xDBSCREEN__T
	addq.w	#4,a7
;		flags |= WIN_OPEN_FAILED;
	move.l	a2,a0
	move.l	$A2(a0),d0
	or.l	#$800,d0
	move.l	a2,a0
	move.l	d0,$A2(a0)
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,a2/a6
	rts
L334
;	buffer[0] = AllocScreenBuffer(scr, 0, SB_SCREEN_BITMAP);
	move.l	a2,a1
	move.l	$46(a1),a0
	move.l	_IntuitionBase,a6
	moveq	#1,d0
	sub.l	a1,a1
	jsr	-$300(a6)
	move.l	d0,$92(a2)
;	if (!buffer[0])
	tst.l	$92(a2)
	bne.b	L336
L335
;		Free();
	move.l	a2,-(a7)
	jsr	Free__xDBSCREEN__T
	addq.w	#4,a7
;		flags |= BUF_ALLOC_FAILED;
	move.l	a2,a0
	move.l	$A2(a0),d0
	or.l	#$2000,d0
	move.l	a2,a0
	move.l	d0,$A2(a0)
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,a2/a6
	rts
L336
;	buffer[1] = AllocScreenBuffer(scr, 0, 0);
	move.l	a2,a1
	move.l	$46(a1),a0
	move.l	_IntuitionBase,a6
	moveq	#0,d0
	sub.l	a1,a1
	jsr	-$300(a6)
	lea	$92(a2),a0
	move.l	d0,4(a0)
;	if (!buffer[1])
	lea	$92(a2),a0
	tst.l	4(a0)
	bne.b	L338
L337
;		Free();
	move.l	a2,-(a7)
	jsr	Free__xDBSCREEN__T
	addq.w	#4,a7
;		flags |= BUF_ALLOC_FAILED;
	move.l	a2,a0
	move.l	$A2(a0),d0
	or.l	#$2000,d0
	move.l	a2,a0
	move.l	d0,$A2(a0)
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,a2/a6
	rts
L338
;	if ((surf[0].Attach(buffer[0]->sb_BitMap)!=OK) || (surf[1].Attach(
	move.l	$92(a2),a0
	move.l	(a0),a6
	pea	$52(a2)
	jsr	Attach__xSURFACE__Tr14P06BitMap
	addq.w	#4,a7
	tst.l	d0
	bne.b	L340
L339
	lea	$92(a2),a0
	move.l	4(a0),a0
	move.l	(a0),a6
	lea	$52(a2),a0
	pea	$20(a0)
	jsr	Attach__xSURFACE__Tr14P06BitMap
	addq.w	#4,a7
	tst.l	d0
	beq.b	L341
L340
;		Free();
	move.l	a2,-(a7)
	jsr	Free__xDBSCREEN__T
	addq.w	#4,a7
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,a2/a6
	rts
L341
;	drawBuffer = 1;
	move.l	a2,a0
	move.l	#1,$9E(a0)
;	flags |= WIN_OPEN;
	move.l	a2,a0
	move.l	$A2(a0),d0
	or.l	#1,d0
	move.l	a2,a0
	move.l	d0,$A2(a0)
;	return OK;
	moveq	#0,d0
	movem.l	(a7)+,a2/a6
	rts

	SECTION "Free__xDBSCREEN__T:0",CODE


;void	xDBSCREEN::Free()
	XDEF	Free__xDBSCREEN__T
Free__xDBSCREEN__T
	movem.l	a2/a3/a6,-(a7)
	move.l	$10(a7),a3
L342
;	surf[0].Delete();
	pea	$52(a3)
	jsr	Delete__xSURFACE__T
	addq.w	#4,a7
;	surf[1].Delete();
	lea	$52(a3),a0
	pea	$20(a0)
	jsr	Delete__xSURFACE__T
	addq.w	#4,a7
;	if (scr)
	move.l	a3,a1
	tst.l	$46(a1)
	beq	L352
L343
;		if (buffer[0])
	tst.l	$92(a3)
	beq.b	L347
L344
;			buffer[0]->sb_DBufInfo->dbi_SafeMessage.mn_ReplyPort = 0;
	move.l	$92(a3),a0
	move.l	4(a0),a0
	clr.l	$16(a0)
;			while (!ChangeScreenBuffer(scr, buffer[0]))
L345
	move.l	a3,a2
	move.l	_IntuitionBase,a6
	move.l	$46(a2),a0
	move.l	$92(a3),a1
	jsr	-$30C(a6)
	tst.l	d0
	beq.b	L345
L346
;			FreeScreenBuffer(scr, buffer[0]);
	move.l	a3,a2
	move.l	_IntuitionBase,a6
	move.l	$46(a2),a0
	move.l	$92(a3),a1
	jsr	-$306(a6)
;			buffer[0] = 0;
	clr.l	$92(a3)
L347
;		if (buffer[1])
	lea	$92(a3),a0
	tst.l	4(a0)
	beq.b	L349
L348
;			FreeScreenBuffer(scr, buffer[1]);
	lea	$92(a3),a0
	move.l	4(a0),a1
	move.l	a3,a2
	move.l	_IntuitionBase,a6
	move.l	$46(a2),a0
	jsr	-$306(a6)
;			buffer[1] = 0;
	lea	$92(a3),a0
	clr.l	4(a0)
L349
;		if (win)
	move.l	a3,a1
	tst.l	$4A(a1)
	beq.b	L351
L350
;			CloseWindow(win);
	move.l	a3,a1
	move.l	_IntuitionBase,a6
	move.l	$4A(a1),a0
	jsr	-$48(a6)
;			win = 0;
	move.l	a3,a1
	clr.l	$4A(a1)
L351
;		CloseScreen(scr);
	move.l	a3,a1
	move.l	_IntuitionBase,a6
	move.l	$46(a1),a0
	jsr	-$42(a6)
;		scr = 0;
	move.l	a3,a1
	clr.l	$46(a1)
L352
;	flags &= ~WIN_OPEN;
	move.l	a3,a0
	move.l	$A2(a0),d0
	and.l	#-2,d0
	move.l	a3,a0
	move.l	d0,$A2(a0)
	movem.l	(a7)+,a2/a3/a6
	rts

	SECTION "Close__xDBSCREEN__T:0",CODE


;sint32	xDBSCREEN::Close()
	XDEF	Close__xDBSCREEN__T
Close__xDBSCREEN__T
	move.l	4(a7),a0
L353
;	Free();
	move.l	a0,-(a7)
	jsr	Free__xDBSCREEN__T
	addq.w	#4,a7
;	return OK;
	moveq	#0,d0
	rts

	SECTION "Refresh__xDBSCREEN__T:0",CODE


;void	xDBSCREEN::Refresh()
	XDEF	Refresh__xDBSCREEN__T
Refresh__xDBSCREEN__T
	movem.l	a2/a3/a6,-(a7)
	move.l	$10(a7),a3
L354
;	buffer[drawBuffer]->sb_DBufInfo->dbi_SafeMessage.mn_ReplyPort = 0;
	move.l	a3,a1
	lea	$92(a3),a0
	move.l	$9E(a1),d0
	move.l	0(a0,d0.l*4),a0
	move.l	4(a0),a0
	clr.l	$16(a0)
;	while (!ChangeScreenBuffer(scr, buffer[drawBuffer]) )
L355
	move.l	a3,a1
	lea	$92(a3),a0
	move.l	$9E(a1),d0
	move.l	0(a0,d0.l*4),a1
	move.l	a3,a2
	move.l	_IntuitionBase,a6
	move.l	$46(a2),a0
	jsr	-$30C(a6)
	tst.l	d0
	beq.b	L355
L356
;	drawBuffer ^= 1UL;
	move.l	a3,a0
	move.l	$9E(a0),d0
	eor.l	#1,d0
	move.l	a3,a0
	move.l	d0,$9E(a0)
	movem.l	(a7)+,a2/a3/a6
	rts

	SECTION "ApplyInputModification__xDISPLAYIO__T:0",CODE


;void xDISPLAYIO::ApplyInputModification()
	XDEF	ApplyInputModification__xDISPLAYIO__T
ApplyInputModification__xDISPLAYIO__T
	movem.l	d2/a6,-(a7)
	move.l	$C(a7),a0
L357
;	uint32 IDCMPflags = 0;
	moveq	#0,d0
;	IDCMPflags |= (inputMask & IKEYBOARD) ? /*IDCMP_VANILLAKEY|*/IDCMP
	move.l	a0,a1
	cmp.w	#0,a1
	beq.b	L359
L358
	addq.w	#4,a1
L359
	move.l	4(a1),d1
	and.l	#1,d1
	beq.b	L361
L360
	move.l	#$400,d1
	bra.b	L362
L361
	moveq	#0,d1
L362
	or.l	d1,d0
;	IDCMPflags |= (inputMask & IMOUSEKEYS) ? IDCMP_MOUSEBUTTONS : 0;
	move.l	a0,a1
	cmp.w	#0,a1
	beq.b	L364
L363
	addq.w	#4,a1
L364
	move.l	4(a1),d1
	and.l	#$E,d1
	beq.b	L366
L365
	moveq	#$8,d1
	bra.b	L367
L366
	moveq	#0,d1
L367
	or.l	d1,d0
;	IDCMPflags |= (inputMask & IMOUSEMOVE) ? IDCMP_MOUSEMOVE : 0;
	move.l	a0,a1
	cmp.w	#0,a1
	beq.b	L369
L368
	addq.w	#4,a1
L369
	move.l	4(a1),d1
	and.l	#$30,d1
	beq.b	L371
L370
	moveq	#$10,d1
	bra.b	L372
L371
	moveq	#0,d1
L372
	or.l	d1,d0
;	IDCMPflags |= (inputMask & ICLOSE) ? IDCMP_CLOSEWINDOW : 0;
	move.l	a0,a1
	cmp.w	#0,a1
	beq.b	L374
L373
	addq.w	#4,a1
L374
	move.l	4(a1),d1
	and.l	#$80,d1
	beq.b	L376
L375
	move.l	#$200,d1
	bra.b	L377
L376
	moveq	#0,d1
L377
	or.l	d1,d0
;	ModifyIDCMP(xDISPLAY::win, IDCMPflags);
	cmp.w	#0,a0
	beq.b	L379
L378
	move.l	(a0),a0
L379
	move.l	_IntuitionBase,a6
	move.l	$4A(a0),a0
	jsr	-$96(a6)
	movem.l	(a7)+,d2/a6
	rts

	SECTION "Idle__xDISPLAYIO__T:0",CODE


;void	xDISPLAYIO::Idle()
	XDEF	Idle__xDISPLAYIO__T
Idle__xDISPLAYIO__T
	move.l	a2,-(a7)
	move.l	$8(a7),a2
L380
;	if (!xDISPLAY::win)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L382
L381
	move.l	(a0),a0
L382
	tst.l	$4A(a0)
	bne.b	L384
L383
;		return;
	move.l	(a7)+,a2
	rts
L384
;	if (HandleEvent()==false)
	move.l	a2,-(a7)
	jsr	HandleEvent__xDISPLAYIO__T
	addq.w	#4,a7
	tst.w	d0
	bne.b	L386
L385
;		WaitForEvent();
	move.l	a2,-(a7)
	jsr	WaitForEvent__xDISPLAYIO__T
	addq.w	#4,a7
L386
	move.l	(a7)+,a2
	rts

	SECTION "HandleEvent__xDISPLAYIO__T:0",CODE


;bool	xDISPLAYIO::HandleEvent()
	XDEF	HandleEvent__xDISPLAYIO__T
HandleEvent__xDISPLAYIO__T
	movem.l	d2-d5/a2/a6,-(a7)
	move.l	$1C(a7),a2
L387
;	IntuiMessage* msg = (IntuiMessage*)GetMsg(xDISPLAY::wi
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L389
L388
	move.l	(a0),a0
L389
	move.l	$4A(a0),a0
	move.l	_SysBase,a6
	move.l	$56(a0),a0
	jsr	-$174(a6)
	move.l	d0,a6
;	if (msg)
	cmp.w	#0,a6
	beq	L480
L390
;		sint32 mouseX			= msg->MouseX-(win->BorderLeft);
	move.w	$20(a6),d2
	ext.l	d2
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L392
L391
	move.l	(a0),a0
L392
	move.l	$4A(a0),a0
	move.b	$36(a0),d0
	extb.l	d0
	sub.l	d0,d2
;		sint32 mouseY			= msg->MouseY-(win->BorderTop);
	move.w	$22(a6),d1
	ext.l	d1
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L394
L393
	move.l	(a0),a0
L394
	move.l	$4A(a0),a0
	move.b	$37(a0),d0
	extb.l	d0
	sub.l	d0,d1
;		sint32 mouseButton = 0;
	moveq	#0,d0
;		bool	mouseKeyEvent = false;
	moveq	#0,d5
;		switch (msg->Class)
	move.l	$14(a6),d3
	cmp.l	#$10,d3
	beq	L436
	bhi.b	L481
	cmp.l	#2,d3
	beq	L474
	cmp.l	#$8,d3
	beq.b	L398
	bra	L478
L481
	cmp.l	#$200,d3
	beq	L475
	cmp.l	#$400,d3
	beq.b	L395
	bra	L478
;			
L395
;				KeyEvent(msg->Code & 0x0000007F, (msg->Code & 0x00000080)==0
	move.l	a6,-(a7)
	jsr	KeyToChar__xKEY__P12IntuiMessage
	addq.w	#4,a7
	move.l	d0,-(a7)
	moveq	#0,d0
	move.w	$18(a6),d0
	and.l	#$80,d0
	seq	d0
	and.l	#1,d0
	move.w	d0,-(a7)
	moveq	#0,d0
	move.w	$18(a6),d0
	and.l	#$7F,d0
	move.l	d0,-(a7)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L397
L396
	moveq	#4,d0
	add.l	a2,d0
	move.l	d0,a2
L397
	move.l	a2,a1
	move.l	(a1),a0
	move.l	a2,d0
	add.l	$14(a0),d0
	move.l	d0,-(a7)
	move.l	$10(a0),a0
	jsr	(a0)
	add.w	#$E,a7
;				
	bra	L479
L398
;				switch(msg->Code)
	move.w	$18(a6),d3
	cmp.w	#$E8,d3
	beq.b	L405
	bhi.b	L482
	cmp.w	#$69,d3
	beq	L423
	bhi.b	L483
	cmp.w	#$68,d3
	beq.b	L399
	bra	L435
L483
	cmp.w	#$6A,d3
	beq.b	L411
	bra	L435
L482
	cmp.w	#$E9,d3
	beq	L429
	cmp.w	#$EA,d3
	beq.b	L417
	bra	L435
;					
L399
;					case SELECTDOWN:	mouseButton |= (inputMas
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L401
L400
	addq.w	#4,a0
L401
	move.l	4(a0),d3
	and.l	#2,d3
	beq.b	L403
L402
	moveq	#1,d3
	bra.b	L404
L403
	moveq	#0,d3
L404
	or.l	d3,d0
;			
	bra	L435
L405
;					case SELECTUP:		mouseButton &= (inputMask 
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L407
L406
	addq.w	#4,a0
L407
	move.l	4(a0),d3
	and.l	#2,d3
	beq.b	L409
L408
	moveq	#-2,d3
	bra.b	L410
L409
	moveq	#0,d3
L410
	and.l	d3,d0
;			
	bra	L435
L411
;					case MIDDLEDOWN:	mouseButton |= (inputMas
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L413
L412
	addq.w	#4,a0
L413
	move.l	4(a0),d3
	and.l	#4,d3
	beq.b	L415
L414
	moveq	#2,d3
	bra.b	L416
L415
	moveq	#0,d3
L416
	or.l	d3,d0
;	
	bra.b	L435
L417
;					case MIDDLEUP:		mouseButton &= (inputMask 
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L419
L418
	addq.w	#4,a0
L419
	move.l	4(a0),d3
	and.l	#4,d3
	beq.b	L421
L420
	moveq	#-3,d3
	bra.b	L422
L421
	moveq	#0,d3
L422
	and.l	d3,d0
;	
	bra.b	L435
L423
;					case MENUDOWN:		mouseButton |= (inputMask 
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L425
L424
	addq.w	#4,a0
L425
	move.l	4(a0),d3
	and.l	#$8,d3
	beq.b	L427
L426
	moveq	#4,d3
	bra.b	L428
L427
	moveq	#0,d3
L428
	or.l	d3,d0
;		
	bra.b	L435
L429
;					case MENUUP:			mouseButton &= (inputMask & 
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L431
L430
	addq.w	#4,a0
L431
	move.l	4(a0),d3
	and.l	#$8,d3
	beq.b	L433
L432
	moveq	#-5,d3
	bra.b	L434
L433
	moveq	#0,d3
L434
	and.l	d3,d0
;		
L435
;				mouseKeyEvent = true;
	moveq	#1,d5
;			
L436
;				if ((inputMask & IMOUSENOCLIP)==0)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L438
L437
	addq.w	#4,a0
L438
	move.l	4(a0),d3
	and.l	#$40,d3
	bne.b	L456
L439
;					mouseX = ClipInt(mouseX, 0, width-1);
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L441
L440
	move.l	(a0),a0
	move.l	(a0),a0
L441
	move.w	(a0),d3
	ext.l	d3
	subq.l	#1,d3
	moveq	#0,d4
	cmp.l	d4,d2
	bge.b	L443
L442
	move.l	d4,d2
	bra.b	L447
L443
	cmp.l	d3,d2
	ble.b	L445
L444
	move.l	d3,d2
L445
L446
L447
;					mouseY = ClipInt(mouseY, 0, height-1);
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L449
L448
	move.l	(a0),a0
	move.l	(a0),a0
L449
	move.w	2(a0),d3
	ext.l	d3
	subq.l	#1,d3
	moveq	#0,d4
	cmp.l	d4,d1
	bge.b	L451
L450
	move.l	d4,d1
	bra.b	L455
L451
	cmp.l	d3,d1
	ble.b	L453
L452
	move.l	d3,d1
L453
L454
L455
L456
;				if (inputMask & IMOUSEIDLEMOVE)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L458
L457
	addq.w	#4,a0
L458
	move.l	4(a0),d3
	and.l	#$20,d3
	beq.b	L462
L459
;					MouseEvent(mouseX, mouseY, mouseButton);
	move.l	d0,-(a7)
	move.l	d1,-(a7)
	move.l	d2,-(a7)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L461
L460
	moveq	#4,d0
	add.l	a2,d0
	move.l	d0,a2
L461
	move.l	a2,a1
	move.l	(a1),a0
	move.l	a2,d0
	add.l	$44(a0),d0
	move.l	d0,-(a7)
	move.l	$40(a0),a0
	jsr	(a0)
	add.w	#$10,a7
	bra	L473
L462
;				else if ((inputMask & IMOUSEKEYMOVE) && mouseButton)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L464
L463
	addq.w	#4,a0
L464
	move.l	4(a0),d3
	and.l	#$10,d3
	beq.b	L469
L465
	tst.l	d0
	beq.b	L469
L466
;					MouseEvent(mouseX, mouseY, mouseButton);
	move.l	d0,-(a7)
	move.l	d1,-(a7)
	move.l	d2,-(a7)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L468
L467
	moveq	#4,d0
	add.l	a2,d0
	move.l	d0,a2
L468
	move.l	a2,a1
	move.l	(a1),a0
	move.l	a2,d0
	add.l	$44(a0),d0
	move.l	d0,-(a7)
	move.l	$40(a0),a0
	jsr	(a0)
	add.w	#$10,a7
	bra.b	L473
L469
;				else if (mouseKeyEvent)
	tst.w	d5
	beq.b	L473
L470
;					MouseEvent(mouseX, mouseY, mouseButton);
	move.l	d0,-(a7)
	move.l	d1,-(a7)
	move.l	d2,-(a7)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L472
L471
	moveq	#4,d0
	add.l	a2,d0
	move.l	d0,a2
L472
	move.l	a2,a1
	move.l	(a1),a0
	move.l	a2,d0
	add.l	$44(a0),d0
	move.l	d0,-(a7)
	move.l	$40(a0),a0
	jsr	(a0)
	add.w	#$10,a7
L473
;				
	bra.b	L479
L474
;				ResizeEvent();
	move.l	a2,a1
	move.l	4(a1),a0
	move.l	a2,d0
	add.l	$6C(a0),d0
	move.l	d0,-(a7)
	move.l	$68(a0),a0
	jsr	(a0)
	addq.w	#4,a7
;				
	bra.b	L479
L475
;				ExitEvent();
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L477
L476
	moveq	#4,d0
	add.l	a2,d0
	move.l	d0,a2
L477
	move.l	a2,a1
	move.l	(a1),a0
	move.l	a2,d0
	add.l	$3C(a0),d0
	move.l	d0,-(a7)
	move.l	$38(a0),a0
	jsr	(a0)
	addq.w	#4,a7
;				
L478
;				
L479
;		ReplyMsg((Message*)msg);
	move.l	a6,a1
	move.l	_SysBase,a6
	jsr	-$17A(a6)
;		return true;
	moveq	#1,d0
	movem.l	(a7)+,d2-d5/a2/a6
	rts
L480
;	return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d5/a2/a6
	rts

	SECTION "WaitForEvent__xDISPLAYIO__T:0",CODE


;bool xDISPLAYIO::WaitForEvent()
	XDEF	WaitForEvent__xDISPLAYIO__T
WaitForEvent__xDISPLAYIO__T
	move.l	4(a7),a0
L484
;	sysSIGNAL eventSignal = 1<<xDISPLAY::win->UserPort->mp_SigBit;
	cmp.w	#0,a0
	beq.b	L486
L485
	move.l	(a0),a0
L486
	move.l	$4A(a0),a0
	move.l	$56(a0),a0
	moveq	#0,d0
	move.b	$F(a0),d0
	moveq	#1,d1
	asl.l	d0,d1
;	if (THREAD::SYSTEMSIGNAL==THREAD::Sleep(0, true, false, eventSigna
	move.l	d1,-(a7)
	clr.w	-(a7)
	move.w	#1,-(a7)
	clr.l	-(a7)
	jsr	Sleep__THREAD__UjssUj
	add.w	#$C,a7
	cmp.l	#3,d0
	bne.b	L488
L487
;		return true;
	moveq	#1,d0
	rts
L488
;	return false;
	moveq	#0,d0
	rts

	SECTION "DiscardQueued__xDISPLAYIO__T:0",CODE


;void xDISPLAYIO::DiscardQueued()
	XDEF	DiscardQueued__xDISPLAYIO__T
DiscardQueued__xDISPLAYIO__T
	movem.l	a2/a6,-(a7)
	move.l	$C(a7),a2
L489
;	if (xDISPLAY::win)
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L491
L490
	move.l	(a0),a0
L491
	tst.l	$4A(a0)
	beq.b	L497
L492
;		Message* dummy = 0;
;		while(dummy = GetMsg(xDISPLAY::win->UserPort))
	bra.b	L494
L493
;			ReplyMsg(dummy);
	move.l	_SysBase,a6
	jsr	-$17A(a6)
L494
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L496
L495
	move.l	(a0),a0
L496
	move.l	$4A(a0),a0
	move.l	_SysBase,a6
	move.l	$56(a0),a0
	jsr	-$174(a6)
	move.l	d0,a1
	cmp.w	#0,a1
	bne.b	L493
L497
	movem.l	(a7)+,a2/a6
	rts

	END
