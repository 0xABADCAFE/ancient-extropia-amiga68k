
; Storm C Compiler
; extropialib:lib/Platforms/Amiga68k/GraphicsLib/GraphicsBase.cpp
	mc68030
	mc68881
	XREF	_0dt__DRAWLIST__T
	XREF	Delete__xTEXFONT__T
	XREF	_0ct__xTEXSURF__T
	XREF	Delete__xTEXSURF__T
	XREF	ReadBody__xTEXSURF__TR05XSFIO
	XREF	WriteBody__xTEXSURF__TR05XSFIO
	XREF	ReadyForRead__xTEXSURF__T
	XREF	ReadyForWrite__xTEXSURF__T
	XREF	_0ct__XSFOBJ__T
	XREF	Set__XSFHEAD__TPCcUcUcUcUc
	XREF	op__equal__XSFHEAD__TR05XSFIO
	XREF	op__equal__XSFHEAD__TR07XSFHEAD
	XREF	op__notEqual__XSFHEAD__TR07XSFHEAD
	XREF	Value__XDATAID__TPCc
	XREF	Refresh__xDBSCREEN__T
	XREF	Close__xDBSCREEN__T
	XREF	Open__xDBSCREEN__T
	XREF	Close__xSCREEN__T
	XREF	Open__xSCREEN__T
	XREF	Set__xSCREEN__TP06xDMODEPCc
	XREF	Close__xDBWIN__T
	XREF	Open__xDBWIN__T
	XREF	Set__xDBWIN__TsssssPCc
	XREF	MoveEvent__xDISPLAYIO__T
	XREF	ResizeEvent__xDISPLAYIO__T
	XREF	Idle__xDISPLAYIO__T
	XREF	HandleEvent__xDISPLAYIO__T
	XREF	ApplyInputModification__xDISPLAYIO__T
	XREF	ViewSurface__xDISPLAY__T
	XREF	DrawSurface__xDISPLAY__T
	XREF	Refresh__xDISPLAY__T
	XREF	Close__xDISPLAY__T
	XREF	Open__xDISPLAY__T
	XREF	_0dt__LOCK__T
	XREF	_0dt__THREAD__T
	XREF	Run__THREAD__T
	XREF	_0dt__DELAY__T
	XREF	_0ct__DELAY__T
	XREF	Pause__DELAY__TUj
	XREF	Pause__DELAY__TUjUj
	XREF	Abort__DELAY__T
	XREF	UnLink__xCHAINABLE__T
	XREF	Close__xFILEIO__T
	XREF	Flush__xFILEIO__T
	XREF	Write64Swap__xFILEIO__TPvUi
	XREF	Write32Swap__xFILEIO__TPvUi
	XREF	Write16Swap__xFILEIO__TPvUi
	XREF	Write__xFILEIO__TPvUiUi
	XREF	Read64Swap__xFILEIO__TPvUi
	XREF	Read32Swap__xFILEIO__TPvUi
	XREF	Read16Swap__xFILEIO__TPvUi
	XREF	Read__xFILEIO__TPvUiUi
	XREF	Tell__xFILEIO__T
	XREF	Seek__xFILEIO__Tjj
	XREF	Open__xFILEIO__TPCcjj
	XREF	SendPacket__xFILEIO__TPv
	XREF	WaitPacket__xFILEIO__T
	XREF	InputQueued__xINPUT__T
	XREF	Idle__xINPUT__T
	XREF	ExitEvent__xINPUT__T
	XREF	MouseEvent__xINPUT__Tjjj
	XREF	ApplyInputModification__xINPUT__T
	XREF	_0dt__xKEY__T
	XREF	_0ct__xKEY__T
	XREF	KeyEvent__xKEY__Tjsj
	XREF	_0dt__xSURFACE__T
	XREF	Done__xSURFACE_
	XREF	Init__xSURFACE_
	XREF	_0dt__POOL_ST__T
	XREF	_0ct__POOL_ST__TUsUj
	XREF	FreeT__POOL_ST__TPv
	XREF	NewT__POOL_ST__TPvUs
	XREF	NewT__POOL_ST__TPv
	XREF	Create__POOL_ST__TUsUj
	XREF	_0dt__POOL_LT__T
	XREF	Done__x3D_
	XREF	Init__x3D__Uj
	XREF	DrawSurface__x3D__P08xSURFACE
	XREF	v3DrawLineStrip__x3D__jj
	XREF	v3DrawLines__x3D__jj
	XREF	_W3D_DrawArray
	XREF	_W3D_BindTexture
	XREF	Free__MEM__Pv
	XREF	Alloc__MEM__UisE
	XREF	MessageBox__sysBASELIB__PcPcPce
	XREF	_strncpy
	XREF	_system
	XREF	op__delete__PvUi
	XREF	_std__in
	XREF	_std__out
	XREF	_std__err
	XREF	_st
	XREF	_gxSt
	XREF	_numStartArgs__xBASELIB
	XREF	_startArgs__xBASELIB
	XREF	_SysBase
	XREF	_IntuitionBase
	XREF	_TimerBase
	XREF	_DOSBase
	XREF	_PowerPCBase
	XREF	_sysData__sysBASELIB
	XREF	_msgbuff__sysBASELIB
	XREF	_main__sysBASELIB
	XREF	_allocated__MEM
	XREF	_totSize__MEM
	XREF	_nextFree__MEM
	XREF	_cnt__MEM
	XREF	_maxAllocs__MEM
	XREF	_fpuPrecision__CPU
	XREF	_cpuNames__CPU
	XREF	_GfxBase
	XREF	_Warp3DBase
	XREF	_hw3D__sys3DDEVICE
	XREF	_context__sys3DDEVICE
	XREF	_drawRegion__x3D
	XREF	_fogData__x3D
	XREF	_flags__x3D
	XREF	_vertices__x3D
	XREF	_currTex__x3D
	XREF	_drawSurface__x3D
	XREF	_currCol__x3D
	XREF	_useV4__x3D
	XREF	_rPool__xSURFACE
	XREF	_KeymapBase
	XREF	_useCount__xKEY
	XREF	_TimerBase__MILLICLOCK
	XREF	_current__MILLICLOCK
	XREF	_clockFreq__MILLICLOCK
	XREF	_threadCnt__THREAD
	XREF	_threadsIdle__THREAD
	XREF	_rootThread__THREAD
	XREF	_sigXSF__XSFHEAD
	XREF	_fileMarker__XSFOBJ
	XREF	_DiskfontBase
	XREF	_flags__DRAW
	XREF	_stack__VGPU
	XREF	_stackPos__VGPU
	XREF	_vertexBase__VGPU
	XREF	_vertexTop__VGPU
	XREF	_dataPos__VGPU
	XREF	_instPos__VGPU
	XREF	_exe_flags__VGPU
	XREF	_exe_stateReg__VGPU
	XREF	_exe_colourReg__VGPU
	XREF	_exe_texReg__VGPU
	XREF	_exe_fogReg__VGPU
	XREF	_exe_errReg__VGPU
	XREF	_funcTab__VGPU
	XREF	_qTrigTab__DRAWLIST

	SECTION "Round16__r23d:0",CODE

	rts

	SECTION "_GfxBase:1",DATA

	XDEF	_GfxBase
_GfxBase
	dc.l	0

	SECTION "_CyberGfxBase:1",DATA

	XDEF	_CyberGfxBase
_CyberGfxBase
	dc.l	0

	SECTION "_surfaceTypes__x2D:1",DATA

	XDEF	_surfaceTypes__x2D
_surfaceTypes__x2D
	dc.l	0

	SECTION "Init__x2D_:0",CODE


;sint32 x2D::Init()
	XDEF	Init__x2D_
Init__x2D_
	move.l	a6,-(a7)
L135
;	::GfxBase = (GFXBASE*)OpenLibrary("graphics.library", 40);
	move.l	_SysBase,a6
	moveq	#$28,d0
	move.l	#L129,a1
	jsr	-$228(a6)
	move.l	d0,_GfxBase
;	if (!::GfxBase)
	tst.l	_GfxBase
	bne.b	L137
L136
;		sysBASELIB::MessageBox("Debug Info", "Proceed", "x2D
	move.l	#L130,-(a7)
	move.l	#L131,-(a7)
	move.l	#L132,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	move.l	(a7)+,a6
	rts
L137
;	CyberGfxBase = OpenLibrary("cybergraphics.library", 42);
	move.l	_SysBase,a6
	moveq	#$2A,d0
	move.l	#L133,a1
	jsr	-$228(a6)
	move.l	d0,_CyberGfxBase
;	if (!CyberGfxBase)
	tst.l	_CyberGfxBase
	bne.b	L139
L138
;		sysBASELIB::MessageBox("Debug Info", "Proceed", "x2D
	move.l	#L134,-(a7)
	move.l	#L131,-(a7)
	move.l	#L132,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	move.l	(a7)+,a6
	rts
L139
;	return OK;
	moveq	#0,d0
	move.l	(a7)+,a6
	rts

L132
	dc.b	'Debug Info',0
L131
	dc.b	'Proceed',0
L133
	dc.b	'cybergraphics.library',0
L129
	dc.b	'graphics.library',0
L134
	dc.b	'x2D::Init()',$A,'Failed to open cybergraphics.library',0
L130
	dc.b	'x2D::Init()',$A,'Failed to open graphics.library',0

	SECTION "Done__x2D_:0",CODE


;sint32 x2D::Done()
	XDEF	Done__x2D_
Done__x2D_
	move.l	a6,-(a7)
L140
;	if (CyberGfxBase)
	tst.l	_CyberGfxBase
	beq.b	L142
L141
;		CloseLibrary(CyberGfxBase);
	move.l	_CyberGfxBase,a1
	move.l	_SysBase,a6
	jsr	-$19E(a6)
;		CyberGfxBase = 0;
	clr.l	_CyberGfxBase
L142
;	if (::GfxBase)
	tst.l	_GfxBase
	beq.b	L144
L143
;		CloseLibrary((LIBRARY*)::GfxBase);
	move.l	_GfxBase,a1
	move.l	_SysBase,a6
	jsr	-$19E(a6)
;		::GfxBase = 0;
	clr.l	_GfxBase
L144
;	return OK;
	moveq	#0,d0
	move.l	(a7)+,a6
	rts

	SECTION "_flags__xGFX:1",DATA

	XDEF	_flags__xGFX
_flags__xGFX
	dc.l	0

	SECTION "_mode__xGFX:1",DATA

	XDEF	_mode__xGFX
_mode__xGFX
	dc.l	0

	SECTION "_numModes__xGFX:1",DATA

	XDEF	_numModes__xGFX
_numModes__xGFX
	dc.l	0

	SECTION "Init__xGFX_:0",CODE


;sint32 xGFX::Init()
	XDEF	Init__xGFX_
Init__xGFX_
	movem.l	d2/a2/a3/a6,-(a7)
L149
;		if (flags & GFX_SYSTEM_OK)
	move.l	_flags__xGFX,d0
	and.l	#1,d0
	beq.b	L151
L150
;			return OK;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2/a3/a6
	rts
L151
;	if (x2D::Init()!=OK)
	jsr	Init__x2D_
	tst.l	d0
	beq.b	L153
L152
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,d2/a2/a3/a6
	rts
L153
;		List* cyberModeList = AllocCModeListTagList(0);
	move.l	_CyberGfxBase,a6
	sub.l	a1,a1
	jsr	-$48(a6)
	move.l	d0,a3
;		if (cyberModeList == 0)
	move.l	a3,a0
	cmp.w	#0,a0
	bne.b	L155
L154
;			return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,d2/a2/a3/a6
	rts
L155
;		for (Node* n = cyberModeList->lh_Head;
	move.l	a3,a0
	move.l	(a0),a6
	bra.b	L157
L156
;			numModes++;
	addq.l	#1,_numModes__xGFX
	move.l	(a6),a6
L157
	tst.l	(a6)
	bne.b	L156
L158
;		numModes++;
	addq.l	#1,_numModes__xGFX
;		mode = New(mode, numModes);
	move.l	_numModes__xGFX,d2
	clr.l	-(a7)
	clr.w	-(a7)
	move.l	d2,d0
	mulu.l	#$30,d0
	addq.l	#$8,d0
	move.l	d0,-(a7)
	jsr	Alloc__MEM__UisE
	add.w	#$A,a7
	move.l	d0,a0
	cmp.w	#0,a0
	beq.b	L164
L159
	move.l	d2,(a0)
	move.l	#$30,4(a0)
	lea	$8(a0),a1
	move.l	a1,a6
	move.l	a6,a1
	move.l	d2,d0
	addq.l	#1,d0
	bra.b	L162
L160
	move.l	a1,a0
	add.w	#$30,a1
	cmp.w	#0,a0
	beq.b	L162
L161
	move.l	#_0virttab__06xDMODE__06xDMODE,$8(a0)
	clr.w	(a0)
	clr.w	2(a0)
	clr.w	4(a0)
	move.w	#$F,6(a0)
	clr.l	$C(a0)
L162
	subq.l	#1,d0
	tst.l	d0
	bne.b	L160
L163
	bra.b	L165
L164
	sub.l	a6,a6
L165
	move.l	a6,_mode__xGFX
;		if (mode == 0)
	move.l	_mode__xGFX,a0
	cmp.w	#0,a0
	bne.b	L167
L166
;			FreeCModeList(cyberModeList);
	move.l	_CyberGfxBase,a6
	move.l	a3,a0
	jsr	-$4E(a6)
;			return ERR_NO_FREE_STORE;
	move.l	#-$3030001,d0
	movem.l	(a7)+,d2/a2/a3/a6
	rts
L167
;		mode[0].ID = DISPLAYMODE_WINDOW;
	move.l	_mode__xGFX,a0
	clr.l	$C(a0)
;		strncpy(mode[0].name, "Windowed", DISPLAYNAMELEN-1);
	pea	$1F.w
	move.l	#L148,-(a7)
	move.l	_mode__xGFX,a1
	pea	$10(a1)
	jsr	_strncpy
	add.w	#$C,a7
;		sint32 m = 1;
	moveq	#1,d2
;		for (n = cyberModeList->lh_Head;
	move.l	a3,a0
	move.l	(a0),a6
	bra.b	L169
L168
;			mode[m].ReadCGXData((CyberModeNode*)n);
	move.l	a6,-(a7)
	move.l	d2,d0
	muls.l	#$30,d0
	move.l	_mode__xGFX,a1
	pea	0(a1,d0.l)
	jsr	ReadCGXData__xDMODE__TP13CyberModeNode
	addq.w	#$8,a7
;			surfaceTypes |= (1<<(mode[m].Format()));
	move.l	d2,d0
	muls.l	#$30,d0
	move.l	_mode__xGFX,a1
	lea	0(a1,d0.l),a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$14(a1),d0
	move.l	d0,-(a7)
	move.l	$10(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	moveq	#1,d1
	asl.l	d0,d1
	or.l	d1,_surfaceTypes__x2D
	move.l	(a6),a6
	addq.l	#1,d2
L169
	tst.l	(a6)
	bne.b	L168
L170
;		FreeCModeList(cyberModeList);
	move.l	_CyberGfxBase,a6
	move.l	a3,a0
	jsr	-$4E(a6)
;		flags = GFX_SYSTEM_OK;
	move.l	#1,_flags__xGFX
;	xDMODE* md = BestMode(640,380,15);
	clr.w	-(a7)
	move.b	#$F,-(a7)
	move.w	#$17C,-(a7)
	move.w	#$280,-(a7)
	jsr	BestMode__xGFX__ssUcs
	addq.w	#$8,a7
;	if (x3D::Init(md->ID)==OK) // choose a dead common display for 3D 
	move.l	d0,a0
	move.l	$C(a0),-(a7)
	jsr	Init__x3D__Uj
	addq.w	#4,a7
	tst.l	d0
	bne.b	L172
L171
;		flags |= GFX_3DHW_AVAIL;
	or.l	#2,_flags__xGFX
L172
;	xSURFACE::Init();
	jsr	Init__xSURFACE_
;	return OK;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2/a3/a6
	rts

L148
	dc.b	'Windowed',0

	SECTION "Done__xGFX_:0",CODE


;sint32 xGFX::Done()
	XDEF	Done__xGFX_
Done__xGFX_
	movem.l	d2/a2/a3/a6,-(a7)
L173
;	if (!flags)
	tst.l	_flags__xGFX
	bne.b	L175
L174
;		return OK;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2/a3/a6
	rts
L175
;	if (mode)
	tst.l	_mode__xGFX
	beq.b	L183
L176
;		Delete(mode);
	move.l	_mode__xGFX,a3
	cmp.w	#0,a3
	beq.b	L182
L177
	move.l	a3,d0
	subq.l	#$8,d0
	move.l	d0,a6
	move.l	a6,a0
	move.l	(a0),d2
	addq.l	#1,d2
	bra.b	L180
L178
	move.l	a3,a2
	moveq	#$30,d0
	add.l	a3,d0
	move.l	d0,a3
	cmp.w	#0,a2
	beq.b	L180
L179
	move.l	$8(a2),a0
	move.l	a2,d0
	add.l	$3C(a0),d0
	move.l	d0,-(a7)
	move.l	$38(a0),a0
	jsr	(a0)
	addq.w	#4,a7
	move.l	$8(a2),a0
	move.l	$30(a0),-(a7)
	move.l	$34(a0),d0
	add.l	a2,d0
	move.l	d0,-(a7)
	jsr	op__delete__PvUi
	addq.w	#$8,a7
L180
	subq.l	#1,d2
	tst.l	d2
	bne.b	L178
L181
	move.l	a6,-(a7)
	jsr	Free__MEM__Pv
	addq.w	#4,a7
L182
L183
;	xSURFACE::Done();
	jsr	Done__xSURFACE_
;	if (flags & GFX_3DHW_AVAIL)
	move.l	_flags__xGFX,d0
	and.l	#2,d0
	beq.b	L185
L184
;		x3D::Done();
	jsr	Done__x3D_
L185
;	x2D::Done();
	jsr	Done__x2D_
;	flags = 0;
	clr.l	_flags__xGFX
;	return OK;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2/a3/a6
	rts

	SECTION "BestMode__xGFX__ssUcs:0",CODE


;xDMODE* xGFX::BestMode(sint16 w, sint16 h, uint8 bpp, bool exa
	XDEF	BestMode__xGFX__ssUcs
BestMode__xGFX__ssUcs
	movem.l	d2-d5,-(a7)
	move.w	$1A(a7),d1
	move.b	$18(a7),d3
	move.w	$16(a7),d4
	move.w	$14(a7),d5
L186
;	sint32 m = 0
	moveq	#0,d2
;	sint32 m = 0, found = -1;
	moveq	#-1,d0
;	if (exact)
	tst.w	d1
	beq	L199
L187
;		while (++m < numModes && found == -1)
	bra	L194
L188
;			found = ((mode[m].Width() == w) && (mode[m].Height() == h) && 
	move.l	d2,d0
	muls.l	#$30,d0
	move.l	_mode__xGFX,a1
	lea	0(a1,d0.l),a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$2C(a1),d0
	move.l	d0,-(a7)
	move.l	$28(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	move.w	d5,d1
	ext.l	d1
	cmp.l	d1,d0
	bne.b	L192
L189
	move.l	d2,d0
	muls.l	#$30,d0
	move.l	_mode__xGFX,a1
	lea	0(a1,d0.l),a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$24(a1),d0
	move.l	d0,-(a7)
	move.l	$20(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	move.w	d4,d1
	ext.l	d1
	cmp.l	d1,d0
	bne.b	L192
L190
	move.l	d2,d0
	muls.l	#$30,d0
	move.l	_mode__xGFX,a1
	lea	0(a1,d0.l),a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$1C(a1),d0
	move.l	d0,-(a7)
	move.l	$18(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	moveq	#0,d1
	move.b	d3,d1
	cmp.l	d1,d0
	bne.b	L192
L191
	move.l	d2,d0
	bra.b	L193
L192
	moveq	#-1,d0
L193
L194
	addq.l	#1,d2
	cmp.l	_numModes__xGFX,d2
	bhs.b	L196
L195
	cmp.l	#-1,d0
	beq	L188
L196
;		if (found == -1)
	cmp.l	#-1,d0
	bne.b	L198
L197
;			return mode;
	move.l	_mode__xGFX,d0
	movem.l	(a7)+,d2-d5
	rts
L198
;			return &mode[found];
	muls.l	#$30,d0
	add.l	_mode__xGFX,d0
	movem.l	(a7)+,d2-d5
	rts
L199
;		while (++m < numModes && found == -1)
	bra	L206
L200
;			found = ((mode[m].Width() >= w) && (mode[m].Height() >= h) && 
	move.l	d2,d0
	muls.l	#$30,d0
	move.l	_mode__xGFX,a1
	lea	0(a1,d0.l),a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$2C(a1),d0
	move.l	d0,-(a7)
	move.l	$28(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	move.w	d5,d1
	ext.l	d1
	cmp.l	d1,d0
	blt.b	L204
L201
	move.l	d2,d0
	muls.l	#$30,d0
	move.l	_mode__xGFX,a1
	lea	0(a1,d0.l),a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$24(a1),d0
	move.l	d0,-(a7)
	move.l	$20(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	move.w	d4,d1
	ext.l	d1
	cmp.l	d1,d0
	blt.b	L204
L202
	move.l	d2,d0
	muls.l	#$30,d0
	move.l	_mode__xGFX,a1
	lea	0(a1,d0.l),a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$1C(a1),d0
	move.l	d0,-(a7)
	move.l	$18(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	moveq	#0,d1
	move.b	d3,d1
	cmp.l	d1,d0
	blt.b	L204
L203
	move.l	d2,d0
	bra.b	L205
L204
	moveq	#-1,d0
L205
L206
	addq.l	#1,d2
	cmp.l	_numModes__xGFX,d2
	bhs.b	L208
L207
	cmp.l	#-1,d0
	beq	L200
L208
;		if (found == -1)
	cmp.l	#-1,d0
	bne.b	L210
L209
;			return mode;
	move.l	_mode__xGFX,d0
	movem.l	(a7)+,d2-d5
	rts
L210
;			return &mode[found];
	muls.l	#$30,d0
	add.l	_mode__xGFX,d0
	movem.l	(a7)+,d2-d5
	rts

	SECTION "ReadCGXData__xDMODE__TP13CyberModeNode:0",CODE


;void xDMODE::ReadCGXData(CyberModeNode* m)
	XDEF	ReadCGXData__xDMODE__TP13CyberModeNode
ReadCGXData__xDMODE__TP13CyberModeNode
	movem.l	a2/a3/a6,-(a7)
	movem.l	$10(a7),a2/a3
L211
;	ID			= m->DisplayID;
	move.l	a3,a0
	move.l	$2E(a0),d0
	move.l	a2,a0
	move.l	d0,$C(a0)
;	width		= m->Width;
	move.l	a3,a0
	move.w	$32(a0),d0
	move.l	a2,a0
	move.w	d0,(a0)
;	height	= m->Height;
	move.l	a3,a0
	move.w	$34(a0),d0
	move.l	a2,a0
	move.w	d0,2(a0)
;	depth		= m->Depth;
	move.l	a3,a0
	move.w	$36(a0),d0
	move.l	a2,a0
	move.w	d0,4(a0)
;	format	= GetCyberIDAttr(CYBRIDATTR_PIXFMT, ID);
	move.l	a2,a0
	move.l	_CyberGfxBase,a6
	move.l	#$80000001,d0
	move.l	$C(a0),d1
	jsr	-$66(a6)
	move.l	a2,a0
	move.w	d0,6(a0)
;	strncpy(name, m->ModeText, DISPLAYNAMELEN-1);
	pea	$1F.w
	pea	$E(a3)
	pea	$10(a2)
	jsr	_strncpy
	add.w	#$C,a7
	movem.l	(a7)+,a2/a3/a6
	rts

	SECTION "Width__AREA__T:0",CODE

	CNOP	0,2

	XDEF	Width__AREA__T
Width__AREA__T
	move.l	4(a7),a0
L212
	move.w	(a0),d0
	ext.l	d0
	rts

	SECTION "Height__AREA__T:0",CODE

	CNOP	0,2

	XDEF	Height__AREA__T
Height__AREA__T
	move.l	4(a7),a0
L213
	move.w	2(a0),d0
	ext.l	d0
	rts

	SECTION "Depth__AREA__T:0",CODE

	CNOP	0,2

	XDEF	Depth__AREA__T
Depth__AREA__T
	move.l	4(a7),a0
L214
	move.w	4(a0),d0
	ext.l	d0
	rts

	SECTION "Format__AREA__T:0",CODE

	CNOP	0,2

	XDEF	Format__AREA__T
Format__AREA__T
	move.l	4(a7),a0
L215
	move.w	6(a0),d0
	ext.l	d0
	rts

	SECTION "_0dt__xDMODE__T:0",CODE

	CNOP	0,2

	XDEF	_0dt__xDMODE__T
_0dt__xDMODE__T
L216
	rts

	SECTION "_0virttab__06xDMODE__06xDMODE:0",CODE

	XDEF	_0virttab__06xDMODE__06xDMODE
_0virttab__06xDMODE__06xDMODE
	dc.l	$30,0
	dc.l	_0dt__xDMODE__T,0
	dc.l	Format__AREA__T,0
	dc.l	Depth__AREA__T,0
	dc.l	Height__AREA__T,0
	dc.l	Width__AREA__T,0
	dc.l	$30,0
	dc.l	_0dt__xDMODE__T,0

	END
