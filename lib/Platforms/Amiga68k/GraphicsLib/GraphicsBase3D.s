
; Storm C Compiler
; extropialib:lib/Platforms/Amiga68k/GraphicsLib/GraphicsBase3D.cpp
	mc68030
	mc68881
	XREF	_0dt__DRAWLIST__T
	XREF	Delete__xTEXFONT__T
	XREF	_0ct__xTEXSURF__T
	XREF	Delete__xTEXSURF__T
	XREF	ReadBody__xTEXSURF__TR05XSFIO
	XREF	WriteBody__xTEXSURF__TR05XSFIO
	XREF	ReadyForRead__xTEXSURF__T
	XREF	ReadyForWrite__xTEXSURF__T
	XREF	_0ct__XSFOBJ__T
	XREF	Set__XSFHEAD__TPCcUcUcUcUc
	XREF	op__equal__XSFHEAD__TR05XSFIO
	XREF	op__equal__XSFHEAD__TR07XSFHEAD
	XREF	op__notEqual__XSFHEAD__TR07XSFHEAD
	XREF	Value__XDATAID__TPCc
	XREF	Refresh__xDBSCREEN__T
	XREF	Close__xDBSCREEN__T
	XREF	Open__xDBSCREEN__T
	XREF	Close__xSCREEN__T
	XREF	Open__xSCREEN__T
	XREF	Set__xSCREEN__TP06xDMODEPCc
	XREF	Close__xDBWIN__T
	XREF	Open__xDBWIN__T
	XREF	Set__xDBWIN__TsssssPCc
	XREF	MoveEvent__xDISPLAYIO__T
	XREF	ResizeEvent__xDISPLAYIO__T
	XREF	Idle__xDISPLAYIO__T
	XREF	HandleEvent__xDISPLAYIO__T
	XREF	ApplyInputModification__xDISPLAYIO__T
	XREF	ViewSurface__xDISPLAY__T
	XREF	DrawSurface__xDISPLAY__T
	XREF	Refresh__xDISPLAY__T
	XREF	Close__xDISPLAY__T
	XREF	Open__xDISPLAY__T
	XREF	_0dt__LOCK__T
	XREF	_0dt__THREAD__T
	XREF	Run__THREAD__T
	XREF	_0dt__DELAY__T
	XREF	_0ct__DELAY__T
	XREF	Pause__DELAY__TUj
	XREF	Pause__DELAY__TUjUj
	XREF	Abort__DELAY__T
	XREF	UnLink__xCHAINABLE__T
	XREF	Close__xFILEIO__T
	XREF	Flush__xFILEIO__T
	XREF	Write64Swap__xFILEIO__TPvUi
	XREF	Write32Swap__xFILEIO__TPvUi
	XREF	Write16Swap__xFILEIO__TPvUi
	XREF	Write__xFILEIO__TPvUiUi
	XREF	Read64Swap__xFILEIO__TPvUi
	XREF	Read32Swap__xFILEIO__TPvUi
	XREF	Read16Swap__xFILEIO__TPvUi
	XREF	Read__xFILEIO__TPvUiUi
	XREF	Tell__xFILEIO__T
	XREF	Seek__xFILEIO__Tjj
	XREF	Open__xFILEIO__TPCcjj
	XREF	SendPacket__xFILEIO__TPv
	XREF	WaitPacket__xFILEIO__T
	XREF	InputQueued__xINPUT__T
	XREF	Idle__xINPUT__T
	XREF	ExitEvent__xINPUT__T
	XREF	MouseEvent__xINPUT__Tjjj
	XREF	ApplyInputModification__xINPUT__T
	XREF	_0dt__xKEY__T
	XREF	_0ct__xKEY__T
	XREF	KeyEvent__xKEY__Tjsj
	XREF	_0dt__xSURFACE__T
	XREF	_0dt__POOL_ST__T
	XREF	_0ct__POOL_ST__TUsUj
	XREF	FreeT__POOL_ST__TPv
	XREF	NewT__POOL_ST__TPvUs
	XREF	NewT__POOL_ST__TPv
	XREF	Create__POOL_ST__TUsUj
	XREF	_0dt__POOL_LT__T
	XREF	_W3D_DrawArray
	XREF	_W3D_BindTexture
	XREF	_W3D_ColorPointer
	XREF	_W3D_TexCoordPointer
	XREF	_W3D_VertexPointer
	XREF	_system
	XREF	_std__in
	XREF	_std__out
	XREF	_std__err
	XREF	_st
	XREF	_gxSt
	XREF	_numStartArgs__xBASELIB
	XREF	_startArgs__xBASELIB
	XREF	_SysBase
	XREF	_IntuitionBase
	XREF	_TimerBase
	XREF	_DOSBase
	XREF	_PowerPCBase
	XREF	_sysData__sysBASELIB
	XREF	_msgbuff__sysBASELIB
	XREF	_main__sysBASELIB
	XREF	_allocated__MEM
	XREF	_totSize__MEM
	XREF	_nextFree__MEM
	XREF	_cnt__MEM
	XREF	_maxAllocs__MEM
	XREF	_fpuPrecision__CPU
	XREF	_cpuNames__CPU
	XREF	_GfxBase
	XREF	_CyberGfxBase
	XREF	_surfaceTypes__x2D
	XREF	_flags__xGFX
	XREF	_mode__xGFX
	XREF	_numModes__xGFX
	XREF	_rPool__xSURFACE
	XREF	_KeymapBase
	XREF	_useCount__xKEY
	XREF	_TimerBase__MILLICLOCK
	XREF	_current__MILLICLOCK
	XREF	_clockFreq__MILLICLOCK
	XREF	_threadCnt__THREAD
	XREF	_threadsIdle__THREAD
	XREF	_rootThread__THREAD
	XREF	_sigXSF__XSFHEAD
	XREF	_fileMarker__XSFOBJ
	XREF	_DiskfontBase
	XREF	_flags__DRAW
	XREF	_stack__VGPU
	XREF	_stackPos__VGPU
	XREF	_vertexBase__VGPU
	XREF	_vertexTop__VGPU
	XREF	_dataPos__VGPU
	XREF	_instPos__VGPU
	XREF	_exe_flags__VGPU
	XREF	_exe_stateReg__VGPU
	XREF	_exe_colourReg__VGPU
	XREF	_exe_texReg__VGPU
	XREF	_exe_fogReg__VGPU
	XREF	_exe_errReg__VGPU
	XREF	_funcTab__VGPU
	XREF	_qTrigTab__DRAWLIST

	SECTION "Round16__r23d:0",CODE

	rts

	SECTION "_Warp3DBase:1",DATA

	XDEF	_Warp3DBase
_Warp3DBase
	dc.l	0

	SECTION "_hw3D__sys3DDEVICE:1",DATA

	XDEF	_hw3D__sys3DDEVICE
_hw3D__sys3DDEVICE
	dc.l	0

	SECTION "_context__sys3DDEVICE:1",DATA

	XDEF	_context__sys3DDEVICE
_context__sys3DDEVICE
	dc.l	0

	SECTION "_drawSurface__x3D:1",DATA

	XDEF	_drawSurface__x3D
_drawSurface__x3D
	dc.l	0

	SECTION "_flags__x3D:1",DATA

	XDEF	_flags__x3D
_flags__x3D
	dc.l	0

	SECTION "_drawRegion__x3D:1",DATA

	XDEF	_drawRegion__x3D
_drawRegion__x3D
	dc.l	0
	ds.b	12

	SECTION "_fogData__x3D:1",DATA

	XDEF	_fogData__x3D
_fogData__x3D
	dc.l	0
	ds.b	20

	SECTION "_vertices__x3D:1",DATA

	XDEF	_vertices__x3D
_vertices__x3D
	dc.l	0

	SECTION "_currTex__x3D:1",DATA

	XDEF	_currTex__x3D
_currTex__x3D
	dc.l	0

	SECTION "_currCol__x3D:1",DATA

	XDEF	_currCol__x3D
_currCol__x3D
	dc.l	0

	SECTION "_useV4__x3D:1",DATA

	XDEF	_useV4__x3D
_useV4__x3D
	dc.w	0

	SECTION "Init__x3D__Uj:0",CODE


;sint32 x3D::Init(uint32 ID)
	XDEF	Init__x3D__Uj
Init__x3D__Uj
	movem.l	d2/a6,-(a7)
	move.l	$C(a7),d2
L165
;	if (Warp3DBase)
	tst.l	_Warp3DBase
	beq.b	L167
L166
;		return OK;
	moveq	#0,d0
	movem.l	(a7)+,d2/a6
	rts
L167
;	if (Warp3DBase = OpenLibrary("Warp3D.library", 4))
	move.l	_SysBase,a6
	moveq	#4,d0
	move.l	#L164,a1
	jsr	-$228(a6)
	move.l	d0,_Warp3DBase
	tst.l	_Warp3DBase
	beq.b	L173
L168
;		if (W3D_CheckDriver() != W3D_DRIVER_UNAVAILABLE)
	move.l	_Warp3DBase,a6
	jsr	-$36(a6)
	cmp.l	#1,d0
	beq.b	L172
L169
;			hw3D = W3D_TestMode(ID);
	move.l	_Warp3DBase,a6
	move.l	d2,d0
	jsr	-$1B6(a6)
	move.l	d0,_hw3D__sys3DDEVICE
;			if (hw3D)
	tst.l	_hw3D__sys3DDEVICE
	beq.b	L171
L170
;				return OK;
	moveq	#0,d0
	movem.l	(a7)+,d2/a6
	rts
L171
;				return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,d2/a6
	rts
L172
;			return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,d2/a6
	rts
L173
;	return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,d2/a6
	rts

L164
	dc.b	'Warp3D.library',0

	SECTION "Done__x3D_:0",CODE


;sint32 x3D::Done()
	XDEF	Done__x3D_
Done__x3D_
	move.l	a6,-(a7)
L174
;	if (Warp3DBase)
	tst.l	_Warp3DBase
	beq.b	L176
L175
;		CloseLibrary(Warp3DBase);
	move.l	_Warp3DBase,a1
	move.l	_SysBase,a6
	jsr	-$19E(a6)
;		Warp3DBase = 0;
	clr.l	_Warp3DBase
L176
;	return OK;
	moveq	#0,d0
	move.l	(a7)+,a6
	rts

	SECTION "BuildContext__x3D__P08xSURFACEs:0",CODE


;sint32 x3D::BuildContext(xSURFACE* s, bool indirect)
	XDEF	BuildContext__x3D__P08xSURFACEs
BuildContext__x3D__P08xSURFACEs
L192	EQU	-4
	link	a5,#L192
	movem.l	a2/a6,-(a7)
	move.w	$C(a5),d0
	move.l	$8(a5),a2
L177
;	uint32 fault = 0;
	clr.l	-4(a5)
;	if (indirect)
	tst.w	d0
	beq.b	L182
L178
;		context = W3D_CreateContextTags(&fault,
	clr.l	-(a7)
	clr.l	-(a7)
	move.l	#$80200001,-(a7)
	pea	1.w
	move.l	#$80200004,-(a7)
	pea	1.w
	move.l	#$80200007,-(a7)
	pea	2.w
	move.l	#$80200002,-(a7)
	move.l	a2,a0
	tst.l	$C(a0)
	beq.b	L180
L179
	move.l	$C(a0),a0
	move.l	4(a0),a0
	bra.b	L181
L180
	sub.l	a0,a0
L181
	move.l	a0,-(a7)
	move.l	#$80200000,-(a7)
	move.l	_Warp3DBase,a6
	lea	-4(a5),a0
	move.l	a7,a1
	jsr	-$1E(a6)
	add.w	#$2C,a7
	move.l	d0,_context__sys3DDEVICE
	bra.b	L186
L182
;		context = W3D_CreateContextTags(&fault,
	clr.l	-(a7)
	clr.l	-(a7)
	move.l	#$80200001,-(a7)
	pea	1.w
	move.l	#$80200007,-(a7)
	pea	2.w
	move.l	#$80200002,-(a7)
	move.l	a2,a0
	tst.l	$C(a0)
	beq.b	L184
L183
	move.l	$C(a0),a0
	move.l	4(a0),a0
	bra.b	L185
L184
	sub.l	a0,a0
L185
	move.l	a0,-(a7)
	move.l	#$80200000,-(a7)
	move.l	_Warp3DBase,a6
	lea	-4(a5),a0
	move.l	a7,a1
	jsr	-$1E(a6)
	add.w	#$24,a7
	move.l	d0,_context__sys3DDEVICE
L186
;	if(!context)
	tst.l	_context__sys3DDEVICE
	bne.b	L188
L187
;		return ERR_RSC_UNAVAILABLE;
	move.l	#-$3050005,d0
	movem.l	(a7)+,a2/a6
	unlk	a5
	rts
L188
;		drawSurface = s;
	move.l	a2,_drawSurface__x3D
;		drawRegion.width	= s->Width();
	move.l	a2,a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$2C(a1),d0
	move.l	d0,-(a7)
	move.l	$28(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	move.l	d0,_drawRegion__x3D+$8
;		drawRegion.height	= s->Height();
	move.l	a2,a0
	move.l	$8(a0),a1
	move.l	a0,d0
	add.l	$24(a1),d0
	move.l	d0,-(a7)
	move.l	$20(a1),a1
	jsr	(a1)
	addq.w	#4,a7
	move.l	d0,_drawRegion__x3D+$C
;		W3D_SetDrawRegion(context, s->Handle(), 0, &drawRegion);
	move.l	a2,a0
	tst.l	$C(a0)
	beq.b	L190
L189
	move.l	$C(a0),a0
	move.l	4(a0),a1
	bra.b	L191
L190
	sub.l	a1,a1
L191
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	moveq	#0,d1
	move.l	#_drawRegion__x3D,a2
	jsr	-$C0(a6)
;		W3D_SetScissor(context, &drawRegion);
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	move.l	#_drawRegion__x3D,a1
	jsr	-$1AA(a6)
;		W3D_SetState(context, W3D_SCISSOR, W3D_ENABLE);
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	move.l	#$2000000,d0
	moveq	#1,d1
	jsr	-$30(a6)
;		W3D_SetState(context, W3D_DITHERING, W3D_ENABLE);
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	move.l	#$80000,d0
	moveq	#1,d1
	jsr	-$30(a6)
;		W3D_SetState(context, W3D_GOURAUD, W3D_DISABLE);
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	move.l	#$400,d0
	moveq	#2,d1
	jsr	-$30(a6)
;		W3D_SetState(context, W3D_TEXMAPPING, W3D_DISABLE);
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	move.l	#$100,d0
	moveq	#2,d1
	jsr	-$30(a6)
;		W3D_SetState(context, W3D_ZBUFFER, W3D_DISABLE);
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	move.l	#$800,d0
	moveq	#2,d1
	jsr	-$30(a6)
;		W3D_SetState(context, W3D_GLOBALTEXENV, W3D_DISABLE);
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	moveq	#$10,d0
	moveq	#2,d1
	jsr	-$30(a6)
;		W3D_SetBlendMode(context, W3D_SRC_ALPHA, W3D_ONE_MINUS_SRC_ALPHA)
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	moveq	#7,d0
	moveq	#$8,d1
	jsr	-$BA(a6)
;		W3D_SetState(context, W3D_BLENDING, W3D_DISABLE);
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	move.l	#$2000,d0
	moveq	#2,d1
	jsr	-$30(a6)
;	SetDrMd(drawSurface->LHandle(), JAM1);
	move.l	_drawSurface__x3D,a0
	move.l	_GfxBase,a6
	moveq	#0,d0
	move.l	$C(a0),a1
	jsr	-$162(a6)
;	return OK;
	moveq	#0,d0
	movem.l	(a7)+,a2/a6
	unlk	a5
	rts

	SECTION "FreeContext__x3D_:0",CODE


;sint32 x3D::FreeContext()
	XDEF	FreeContext__x3D_
FreeContext__x3D_
	move.l	a6,-(a7)
L193
;	if (context)
	tst.l	_context__sys3DDEVICE
	beq	L195
L194
;		W3D_BindTexture(context, 0, 0);
	clr.l	-(a7)
	clr.l	-(a7)
	move.l	_context__sys3DDEVICE,-(a7)
	jsr	_W3D_BindTexture
	add.w	#$C,a7
;		W3D_VertexPointer(context, 0, 0, W3D_VERTEX_F_F_F, 0);
	clr.l	-(a7)
	clr.l	-(a7)
	clr.l	-(a7)
	clr.l	-(a7)
	move.l	_context__sys3DDEVICE,-(a7)
	jsr	_W3D_VertexPointer
	add.w	#$14,a7
;		W3D_TexCoordPointer(context, 0, 0, 0, 0, 0, 0);
	clr.l	-(a7)
	clr.l	-(a7)
	clr.l	-(a7)
	clr.l	-(a7)
	clr.l	-(a7)
	clr.l	-(a7)
	move.l	_context__sys3DDEVICE,-(a7)
	jsr	_W3D_TexCoordPointer
	add.w	#$1C,a7
;		W3D_ColorPointer(context, 0, 0, W3D_COLOR_UBYTE, W3D_CMODE_ARGB,
	clr.l	-(a7)
	pea	$8.w
	move.l	#$80000000,-(a7)
	clr.l	-(a7)
	clr.l	-(a7)
	move.l	_context__sys3DDEVICE,-(a7)
	jsr	_W3D_ColorPointer
	add.w	#$18,a7
;		W3D_FlushTextures(context);
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	jsr	-$72(a6)
;		W3D_FreeZBuffer(context);
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	jsr	-$DE(a6)
;		W3D_DestroyContext(context);
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	jsr	-$24(a6)
;		context = 0;
	clr.l	_context__sys3DDEVICE
;		drawSurface = 0;
	clr.l	_drawSurface__x3D
L195
;	return OK;
	moveq	#0,d0
	move.l	(a7)+,a6
	rts

	SECTION "DrawSurface__x3D__P08xSURFACE:0",CODE


;bool x3D::DrawSurface(xSURFACE* s)
	XDEF	DrawSurface__x3D__P08xSURFACE
DrawSurface__x3D__P08xSURFACE
	movem.l	a2/a3/a6,-(a7)
	move.l	$10(a7),a3
L196
;	if (W3D_SetDrawRegion(context, s->Handle(), 0, &drawRegion)==W3D_S
	move.l	a3,a0
	tst.l	$C(a0)
	beq.b	L198
L197
	move.l	$C(a0),a0
	move.l	4(a0),a1
	bra.b	L199
L198
	sub.l	a1,a1
L199
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	moveq	#0,d1
	move.l	#_drawRegion__x3D,a2
	jsr	-$C0(a6)
	tst.l	d0
	bne.b	L201
L200
;		drawSurface = s;
	move.l	a3,_drawSurface__x3D
;		return true;
	moveq	#1,d0
	movem.l	(a7)+,a2/a3/a6
	rts
L201
;	return false;
	moveq	#0,d0
	movem.l	(a7)+,a2/a3/a6
	rts

	SECTION "SetVertexArray__x3D__P07DVERTEX:0",CODE


;bool x3D::SetVertexArray(DVERTEX* v)
	XDEF	SetVertexArray__x3D__P07DVERTEX
SetVertexArray__x3D__P07DVERTEX
	move.l	a2,-(a7)
	move.l	$8(a7),a2
L202
;	if (!context)
	tst.l	_context__sys3DDEVICE
	bne.b	L204
L203
;		return false;
	moveq	#0,d0
	move.l	(a7)+,a2
	rts
L204
;	vertices = v;
	move.l	a2,_vertices__x3D
;	if (v)
	cmp.w	#0,a2
	beq.b	L206
L205
;		W3D_VertexPointer(context, (uint8*)v+DV_OFS_XYZ, DV_STRIDE, W3D_
	clr.l	-(a7)
	clr.l	-(a7)
	pea	$20.w
	move.l	a2,-(a7)
	move.l	_context__sys3DDEVICE,-(a7)
	jsr	_W3D_VertexPointer
	add.w	#$14,a7
;		W3D_TexCoordPointer(context, (uint8*)v+DV_OFS_UV, DV_STRIDE, 0, 
	clr.l	-(a7)
	move.l	#-4,-(a7)
	pea	4.w
	clr.l	-(a7)
	pea	$20.w
	pea	$10(a2)
	move.l	_context__sys3DDEVICE,-(a7)
	jsr	_W3D_TexCoordPointer
	add.w	#$1C,a7
;		W3D_ColorPointer(context, (uint8*)v+DV_OFS_CLR, DV_STRIDE, W3D_C
	clr.l	-(a7)
	pea	$8.w
	move.l	#$80000000,-(a7)
	pea	$20.w
	pea	$18(a2)
	move.l	_context__sys3DDEVICE,-(a7)
	jsr	_W3D_ColorPointer
	add.w	#$18,a7
;		return true;
	moveq	#1,d0
	move.l	(a7)+,a2
	rts
L206
;	W3D_VertexPointer(context, 0, DV_STRIDE, W3D_VERTEX_F_F_F, 0);
	clr.l	-(a7)
	clr.l	-(a7)
	pea	$20.w
	clr.l	-(a7)
	move.l	_context__sys3DDEVICE,-(a7)
	jsr	_W3D_VertexPointer
	add.w	#$14,a7
;	W3D_TexCoordPointer(context, 0, DV_STRIDE, 0, DV_OFS_V, DV_OFS_W, 
	clr.l	-(a7)
	move.l	#-4,-(a7)
	pea	4.w
	clr.l	-(a7)
	pea	$20.w
	clr.l	-(a7)
	move.l	_context__sys3DDEVICE,-(a7)
	jsr	_W3D_TexCoordPointer
	add.w	#$1C,a7
;	W3D_ColorPointer(context, 0, DV_STRIDE, W3D_COLOR_UBYTE, W3D_CMODE
	clr.l	-(a7)
	pea	$8.w
	move.l	#$80000000,-(a7)
	pea	$20.w
	clr.l	-(a7)
	move.l	_context__sys3DDEVICE,-(a7)
	jsr	_W3D_ColorPointer
	add.w	#$18,a7
;	return true;
	moveq	#1,d0
	move.l	(a7)+,a2
	rts

	SECTION "SetDrawArea__x3D__ssss:0",CODE


;bool x3D::SetDrawArea(S_2CRD)
	XDEF	SetDrawArea__x3D__ssss
SetDrawArea__x3D__ssss
	movem.l	d2-d4/a2/a6,-(a7)
	move.w	$18(a7),d1
	move.w	$1A(a7),d2
	move.w	$1E(a7),d3
	move.w	$1C(a7),d4
L207
;	drawRegion.left 	= x1;
	move.w	d1,d0
	ext.l	d0
	move.l	d0,_drawRegion__x3D
;			drawRegion.top = y1;
	move.w	d2,d0
	ext.l	d0
	move.l	d0,_drawRegion__x3D+4
;	drawRegion.width	= x2-x1;
	move.w	d4,d0
	ext.l	d0
	ext.l	d1
	sub.l	d1,d0
	move.l	d0,_drawRegion__x3D+$8
;	drawRegion.height = y2-y1;
	move.w	d3,d0
	ext.l	d0
	move.w	d2,d1
	ext.l	d1
	sub.l	d1,d0
	move.l	d0,_drawRegion__x3D+$C
;	return (W3D_SetDrawRegion(context, drawSurface->Handle(), 0, &draw
	move.l	_drawSurface__x3D,a0
	tst.l	$C(a0)
	beq.b	L209
L208
	move.l	$C(a0),a0
	move.l	4(a0),a1
	bra.b	L210
L209
	sub.l	a1,a1
L210
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	moveq	#0,d1
	move.l	#_drawRegion__x3D,a2
	jsr	-$C0(a6)
	tst.l	d0
	seq	d0
	and.l	#1,d0
	movem.l	(a7)+,d2-d4/a2/a6
	rts

	SECTION "SetDrawArea__x3D__P08xSURFACEssss:0",CODE


;bool x3D::SetDrawArea(xSURFACE* s, S_2CRD)
	XDEF	SetDrawArea__x3D__P08xSURFACEssss
SetDrawArea__x3D__P08xSURFACEssss
L227	EQU	-$10
	link	a5,#L227
	movem.l	d2-d4/a2/a3/a6,-(a7)
	move.w	$C(a5),d1
	move.w	$E(a5),d2
	move.w	$12(a5),d3
	move.w	$10(a5),d4
	move.l	$8(a5),a3
L211
;	if (!s || !s->Handle() || !context)
	cmp.w	#0,a3
	beq.b	L217
L212
	move.l	a3,a0
	tst.l	$C(a0)
	beq.b	L215
L213
	move.l	$C(a0),a0
	tst.l	4(a0)
	beq.b	L217
L214
	bra.b	L216
L215
	bra.b	L217
L216
	tst.l	_context__sys3DDEVICE
	bne.b	L218
L217
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts
L218
;	W3D_Scissor t = { x1, y1, x2-x1, y2-y1 };
	lea	-$10(a5),a0
	move.w	d1,d0
	ext.l	d0
	move.l	d0,(a0)+
	move.w	d2,d0
	ext.l	d0
	move.l	d0,(a0)+
	move.w	d4,d0
	ext.l	d0
	ext.l	d1
	sub.l	d1,d0
	move.l	d0,(a0)+
	move.w	d3,d0
	ext.l	d0
	move.w	d2,d1
	ext.l	d1
	sub.l	d1,d0
	move.l	d0,(a0)
;	if (W3D_SetDrawRegion(context, s->Handle(), 0, &t)==W3D_SUCCESS)
	lea	-$10(a5),a2
	move.l	a3,a0
	tst.l	$C(a0)
	beq.b	L220
L219
	move.l	$C(a0),a0
	move.l	4(a0),a1
	bra.b	L221
L220
	sub.l	a1,a1
L221
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	moveq	#0,d1
	jsr	-$C0(a6)
	tst.l	d0
	bne.b	L223
L222
;		drawSurface	= s;
	move.l	a3,_drawSurface__x3D
;		drawRegion	= t;
	lea	-$10(a5),a1
	lea	_drawRegion__x3D,a0
	move.l	(a1)+,(a0)+
	move.l	(a1)+,(a0)+
	move.l	(a1)+,(a0)+
	move.l	(a1)+,(a0)+
;		return true;
	moveq	#1,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts
L223
;	W3D_SetDrawRegion(context, drawSurface->Handle(), 0, &drawRegion);
	move.l	_drawSurface__x3D,a0
	tst.l	$C(a0)
	beq.b	L225
L224
	move.l	$C(a0),a0
	move.l	4(a0),a1
	bra.b	L226
L225
	sub.l	a1,a1
L226
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	moveq	#0,d1
	move.l	#_drawRegion__x3D,a2
	jsr	-$C0(a6)
;	return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts

	SECTION "SetColour__x3D__Uj:0",CODE


;bool x3D::SetColour(uint32 c)
	XDEF	SetColour__x3D__Uj
SetColour__x3D__Uj
L233	EQU	-$10
	link	a5,#L233
	movem.l	d2/a6,-(a7)
	fmovem.x fp2,-(a7)
	move.l	$8(a5),d2
L228
;	if (c==currCol)
	cmp.l	_currCol__x3D,d2
	bne.b	L230
L229
;		return true;
	moveq	#1,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2/a6
	unlk	a5
	rts
L230
;	rfloat32 f = 1F/256F;
	fmove.s	#$.3B800000,fp0
;	sysCOLOUR4C rgba = {	f*((c&0x00FF0000)>>16),
	lea	-$10(a5),a0
	move.l	d2,d0
	and.l	#$FF0000,d0
	moveq	#$10,d1
	lsr.l	d1,d0
	fmove.l	d0,fp1
	fmul.x	fp0,fp1
	fmove.s	fp1,(a0)+
	move.l	d2,d0
	and.l	#$FF00,d0
	moveq	#$8,d1
	lsr.l	d1,d0
	fmove.l	d0,fp1
	fmul.x	fp0,fp1
	fmove.s	fp1,(a0)+
	move.l	d2,d0
	and.l	#$FF,d0
	fmove.l	d0,fp1
	fmul.x	fp0,fp1
	fmove.s	fp1,(a0)+
	move.l	d2,d0
	and.l	#-$1000000,d0
	moveq	#$18,d1
	lsr.l	d1,d0
	fmove.l	d0,fp1
	fmul.x	fp1,fp0
	fmove.s	fp0,(a0)
;	if (W3D_SetCurrentColor(context, &rgba)==W3D_SUCCESS)
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	lea	-$10(a5),a1
	jsr	-$168(a6)
	tst.l	d0
	bne.b	L232
L231
;		currCol = c;
	move.l	d2,_currCol__x3D
;		return true;
	moveq	#1,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2/a6
	unlk	a5
	rts
L232
;	return false;
	moveq	#0,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2/a6
	unlk	a5
	rts

	SECTION "SetFogProperties__x3D__EUjfff:0",CODE


;bool x3D::SetFogProperties(x3D::FMODE m, uint32 c, float32 s, float3
	XDEF	SetFogProperties__x3D__EUjfff
SetFogProperties__x3D__EUjfff
	movem.l	d2/d3/a6,-(a7)
	fmovem.x fp2,-(a7)
	move.l	$20(a7),d0
	move.l	$1C(a7),d1
	fmove.s	$2C(a7),fp0
	fmove.s	$28(a7),fp1
	fmove.s	$24(a7),fp2
L234
;	fogData.fog_start = s;
	fmove.s	fp2,_fogData__x3D
;	fogData.fog_end = e;
	fmove.s	fp1,_fogData__x3D+4
;	fogData.fog_density = d;
	fmove.s	fp0,_fogData__x3D+$8
;		rfloat32 f = 1F/256F;
	fmove.s	#$.3B800000,fp0
;		fogData.fog_color.r = f*((c&0x00FF0000)>>16);
	move.l	d0,d2
	and.l	#$FF0000,d2
	moveq	#$10,d3
	lsr.l	d3,d2
	fmove.l	d2,fp1
	fmul.x	fp0,fp1
	fmove.s	fp1,_fogData__x3D+$C
;		fogData.fog_color.g = f*((c&0x0000FF00)>>8);
	move.l	d0,d2
	and.l	#$FF00,d2
	moveq	#$8,d3
	lsr.l	d3,d2
	fmove.l	d2,fp1
	fmul.x	fp0,fp1
	fmove.s	fp1,_fogData__x3D+$10
;		fogData.fog_color.b = f*(c&0x000000FF);
	and.l	#$FF,d0
	fmove.l	d0,fp1
	fmul.x	fp1,fp0
	fmove.s	fp0,_fogData__x3D+$14
;	return (W3D_SetFogParams(context, &fogData, m)==W3D_SUCCESS);
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	move.l	#_fogData__x3D,a1
	jsr	-$C6(a6)
	tst.l	d0
	seq	d0
	and.l	#1,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2/d3/a6
	rts

	SECTION "DownloadZBuffer__x3D__ssssPd:0",CODE


;bool x3D::DownloadZBuffer(S_2CRD, float64* p)
	XDEF	DownloadZBuffer__x3D__ssssPd
DownloadZBuffer__x3D__ssssPd
	movem.l	d2-d5/a2/a6,-(a7)
	move.w	$22(a7),d1
	move.w	$20(a7),d2
	move.w	$1E(a7),d4
	move.w	$1C(a7),d5
	move.l	$24(a7),a2
L235
;	if (!p)	
	cmp.w	#0,a2
	bne.b	L237
L236
;	if (!p)	return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d5/a2/a6
	rts
L237
;	uint32 span = x2-x1;
	ext.l	d2
	move.w	d5,d0
	ext.l	d0
	sub.l	d0,d2
;	uint32 h		= 1+y2-y1;
	move.w	d1,d0
	ext.l	d0
	move.l	d0,d3
	addq.l	#1,d3
	move.w	d4,d0
	ext.l	d0
	sub.l	d0,d3
;	while(--h)
	bra.b	L241
L238
;		if (W3D_ReadZSpan(context, x1, y1++, span, p)!=W3D_SUCCESS)
	move.w	d4,d1
	addq.w	#1,d4
	ext.l	d1
	move.w	d5,d0
	ext.l	d0
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	move.l	a2,a1
	jsr	-$F0(a6)
	tst.l	d0
	beq.b	L240
L239
;			return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d5/a2/a6
	rts
L240
;		p+=span;
	move.l	d2,d0
	moveq	#3,d1
	asl.l	d1,d0
	add.l	a2,d0
	move.l	d0,a2
L241
	subq.l	#1,d3
	tst.l	d3
	bne.b	L238
L242
;	return true;
	moveq	#1,d0
	movem.l	(a7)+,d2-d5/a2/a6
	rts

	SECTION "UploadZBuffer__x3D__ssssPd:0",CODE


;bool x3D::UploadZBuffer(S_2CRD, float64* p)
	XDEF	UploadZBuffer__x3D__ssssPd
UploadZBuffer__x3D__ssssPd
	movem.l	d2-d5/a2/a3/a6,-(a7)
	move.w	$26(a7),d1
	move.w	$24(a7),d2
	move.w	$22(a7),d4
	move.w	$20(a7),d5
	move.l	$28(a7),a3
L243
;	if (!p)	
	cmp.w	#0,a3
	bne.b	L245
L244
;	if (!p)	return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d5/a2/a3/a6
	rts
L245
;	uint32 span = x2-x1;
	ext.l	d2
	move.w	d5,d0
	ext.l	d0
	sub.l	d0,d2
;	uint32 h		= 1+y2-y1;
	move.w	d1,d0
	ext.l	d0
	move.l	d0,d3
	addq.l	#1,d3
	move.w	d4,d0
	ext.l	d0
	sub.l	d0,d3
;	while(--h)
	bra.b	L247
L246
;		W3D_WriteZSpan(context, x1, y1++, span, p, 0);
	move.w	d4,d1
	addq.w	#1,d4
	ext.l	d1
	move.w	d5,d0
	ext.l	d0
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	move.l	a3,a1
	sub.l	a2,a2
	jsr	-$162(a6)
;		p+=span;
	move.l	d2,d0
	moveq	#3,d1
	asl.l	d1,d0
	add.l	a3,d0
	move.l	d0,a3
L247
	subq.l	#1,d3
	tst.l	d3
	bne.b	L246
L248
;	return true;
	moveq	#1,d0
	movem.l	(a7)+,d2-d5/a2/a3/a6
	rts

	SECTION "DownloadStencil__x3D__ssssPUj:0",CODE


;bool x3D::DownloadStencil(S_2CRD, uint32* p)
	XDEF	DownloadStencil__x3D__ssssPUj
DownloadStencil__x3D__ssssPUj
	movem.l	d2-d5/a2/a6,-(a7)
	move.w	$22(a7),d1
	move.w	$20(a7),d2
	move.w	$1E(a7),d4
	move.w	$1C(a7),d5
	move.l	$24(a7),a2
L249
;	if (!p)	
	cmp.w	#0,a2
	bne.b	L251
L250
;	if (!p)	return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d5/a2/a6
	rts
L251
;	uint32 span = x2-x1;
	ext.l	d2
	move.w	d5,d0
	ext.l	d0
	sub.l	d0,d2
;	uint32 h		= 1+y2-y1;
	move.w	d1,d0
	ext.l	d0
	move.l	d0,d3
	addq.l	#1,d3
	move.w	d4,d0
	ext.l	d0
	sub.l	d0,d3
;	while(--h)
	bra.b	L255
L252
;		if (W3D_ReadStencilSpan(context, x1, y1++, span, p)!=W3D_SUCCESS)
	move.w	d4,d1
	addq.w	#1,d4
	ext.l	d1
	move.w	d5,d0
	ext.l	d0
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	move.l	a2,a1
	jsr	-$11A(a6)
	tst.l	d0
	beq.b	L254
L253
;			return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d5/a2/a6
	rts
L254
;		p+=span;
	move.l	d2,d0
	moveq	#2,d1
	asl.l	d1,d0
	add.l	a2,d0
	move.l	d0,a2
L255
	subq.l	#1,d3
	tst.l	d3
	bne.b	L252
L256
;	return true;
	moveq	#1,d0
	movem.l	(a7)+,d2-d5/a2/a6
	rts

	SECTION "v3DrawLines__x3D__jj:0",CODE


;bool x3D::v3DrawLines(sint32 ofst, sint32 vCnt)
	XDEF	v3DrawLines__x3D__jj
v3DrawLines__x3D__jj
L271	EQU	-$98
	link	a5,#L271
	movem.l	d2/d3/a2/a6,-(a7)
	fmovem.x fp2,-(a7)
	move.l	$C(a5),d2
	move.l	$8(a5),d3
L257
;	if (vertices==0 || vCnt < 2)
	move.l	_vertices__x3D,a0
	cmp.w	#0,a0
	beq.b	L259
L258
	cmp.l	#2,d2
	bge.b	L260
L259
;		return false;
	moveq	#0,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2/d3/a2/a6
	unlk	a5
	rts
L260
;	line.tex = currTex;
	move.l	_currTex__x3D,-$10(a5)
;	if (Enabled(GOURAUD)) // shaded vertices need more work
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	move.l	#$400,d1
	jsr	-$2A(a6)
	cmp.l	#1,d0
	seq	d0
	and.l	#1,d0
	tst.w	d0
	beq	L266
L261
;		register DVERTEX* d = vertices+ofst;
	move.l	d3,d0
	asl.l	#5,d0
	add.l	_vertices__x3D,d0
	move.l	d0,a2
;		rsint32 cnt2 = 1+(vCnt>>1);
	moveq	#1,d0
	asr.l	d0,d2
	addq.l	#1,d2
;		rfloat32 colFac = 1F/256F;
	fmove.s	#$.3B800000,fp2
;		while (--cnt2)
	bra	L264
L262
;			line.v1.x				= d->x;
	move.l	a2,a0
	move.l	(a0),-$90(a5)
;	line.v1.y	= d->y;
	move.l	a2,a0
	move.l	4(a0),-$8C(a5)
;	line.v1.z	= d->z;
	move.l	a2,a0
	fmove.s	$8(a0),fp0
	fmove.d	fp0,-$88(a5)
; line.v1.w = d->w;
	move.l	a2,a0
	move.l	$C(a0),-$80(a5)
;			line.v1.u				= d->u;
	move.l	a2,a0
	move.l	$10(a0),-$7C(a5)
;	line.v1.v	= d->v;
	move.l	a2,a0
	move.l	$14(a0),-$78(a5)
;			ruint32 clr			= (d++)->colour;
	move.l	a2,a0
	moveq	#$20,d0
	add.l	a2,d0
	move.l	d0,a2
	move.l	$18(a0),d0
;			line.v1.color.r	= colFac*((clr & 0x00FF0000)>>16);
	move.l	d0,d1
	and.l	#$FF0000,d1
	moveq	#$10,d3
	lsr.l	d3,d1
	fmove.l	d1,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,-$70(a5)
;			line.v1.color.g	= colFac*((clr & 0x0000FF00)>>8);
	move.l	d0,d1
	and.l	#$FF00,d1
	moveq	#$8,d3
	lsr.l	d3,d1
	fmove.l	d1,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,-$6C(a5)
;			line.v1.color.b	= colFac*( clr & 0x000000FF);
	move.l	d0,d1
	and.l	#$FF,d1
	fmove.l	d1,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,-$68(a5)
;			line.v1.color.a	= colFac*((clr & 0xFF000000)>>24);
	and.l	#-$1000000,d0
	moveq	#$18,d1
	lsr.l	d1,d0
	fmove.l	d0,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,-$64(a5)
;			line.v2.x				= d->x;
	move.l	a2,a0
	fmove.s	(a0),fp0
	fmove.s	fp0,-$50(a5)
;	line.v2.y	= d->y;
	move.l	a2,a0
	move.l	4(a0),-$4C(a5)
;	line.v2.z	= d->z;
	move.l	a2,a0
	fmove.s	$8(a0),fp0
	fmove.d	fp0,-$48(a5)
; line.v1.w = d->w;
	move.l	a2,a0
	move.l	$C(a0),-$80(a5)
;			line.v2.u				= d->u;
	move.l	a2,a0
	move.l	$10(a0),-$3C(a5)
;	line.v2.v	= d->v;
	move.l	a2,a0
	move.l	$14(a0),-$38(a5)
;			clr							= (d++)->colour;
	move.l	a2,a0
	moveq	#$20,d0
	add.l	a2,d0
	move.l	d0,a2
	move.l	$18(a0),d0
;			line.v2.color.r	= colFac*((clr & 0x00FF0000)>>16);
	move.l	d0,d1
	and.l	#$FF0000,d1
	moveq	#$10,d3
	lsr.l	d3,d1
	fmove.l	d1,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,-$30(a5)
;			line.v2.color.g	= colFac*((clr & 0x0000FF00)>>8);
	move.l	d0,d1
	and.l	#$FF00,d1
	moveq	#$8,d3
	lsr.l	d3,d1
	fmove.l	d1,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,-$2C(a5)
;			line.v2.color.b	= colFac*( clr & 0x000000FF);
	move.l	d0,d1
	and.l	#$FF,d1
	fmove.l	d1,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,-$28(a5)
;			line.v2.color.a	= colFac*((clr & 0xFF000000)>>24);
	and.l	#-$1000000,d0
	moveq	#$18,d1
	lsr.l	d1,d0
	fmove.l	d0,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,-$24(a5)
;			if (W3D_DrawLine(context, &line)!=W3D_SUCCESS)
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	lea	-$90(a5),a1
	jsr	-$96(a6)
	tst.l	d0
	beq.b	L264
L263
;				return false;
	moveq	#0,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2/d3/a2/a6
	unlk	a5
	rts
L264
	subq.l	#1,d2
	tst.l	d2
	bne	L262
L265
;		return true;
	moveq	#1,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2/d3/a2/a6
	unlk	a5
	rts
L266
;		register DVERTEX* d = vertices+ofst;
	move.l	d3,d0
	asl.l	#5,d0
	add.l	_vertices__x3D,d0
	move.l	d0,a2
;		rsint32 cnt2 = 1+(vCnt>>1);
	moveq	#1,d0
	asr.l	d0,d2
	addq.l	#1,d2
;		while (--cnt2)
	bra	L269
L267
;			line.v1.x				= d->x;
	move.l	a2,a0
	move.l	(a0),-$90(a5)
;	line.v1.y	= d->y;
	move.l	a2,a0
	move.l	4(a0),-$8C(a5)
;	line.v1.z	= d->z;
	move.l	a2,a0
	fmove.s	$8(a0),fp0
	fmove.d	fp0,-$88(a5)
; line.v1.w = d->w;
	move.l	a2,a0
	move.l	$C(a0),-$80(a5)
;			line.v1.u				= d->u;
	move.l	a2,a0
	move.l	$10(a0),-$7C(a5)
;	line.v1.v	= (d++)->v;
	move.l	a2,a0
	moveq	#$20,d0
	add.l	a2,d0
	move.l	d0,a2
	move.l	$14(a0),-$78(a5)
;			line.v2.x				= d->x;
	move.l	a2,a0
	fmove.s	(a0),fp0
	fmove.s	fp0,-$50(a5)
;	line.v2.y	= d->y;
	move.l	a2,a0
	move.l	4(a0),-$4C(a5)
;	line.v2.z	= d->z;
	move.l	a2,a0
	fmove.s	$8(a0),fp0
	fmove.d	fp0,-$48(a5)
; line.v2.w = d->w;
	move.l	a2,a0
	move.l	$C(a0),-$40(a5)
;			line.v2.u				= d->u;
	move.l	a2,a0
	move.l	$10(a0),-$3C(a5)
;	line.v2.v	= (d++)->v;
	move.l	a2,a0
	moveq	#$20,d0
	add.l	a2,d0
	move.l	d0,a2
	move.l	$14(a0),-$38(a5)
;			if (W3D_DrawLine(context, &line)!=W3D_SUCCESS)
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	lea	-$90(a5),a1
	jsr	-$96(a6)
	tst.l	d0
	beq.b	L269
L268
;				return false;
	moveq	#0,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2/d3/a2/a6
	unlk	a5
	rts
L269
	subq.l	#1,d2
	tst.l	d2
	bne	L267
L270
;		return true;
	moveq	#1,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2/d3/a2/a6
	unlk	a5
	rts

	SECTION "v3DrawLineStrip__x3D__jj:0",CODE


;bool x3D::v3DrawLineStrip(sint32 ofst, sint32 vCnt)
	XDEF	v3DrawLineStrip__x3D__jj
v3DrawLineStrip__x3D__jj
L310	EQU	-$8B0
	link	a5,#L310
	movem.l	d2-d5/a2/a6,-(a7)
	fmovem.x fp2,-(a7)
	movem.l	$8(a5),d0/d4
L272
;	if (vertices==0 || vCnt < 2)
	move.l	_vertices__x3D,a0
	cmp.w	#0,a0
	beq.b	L274
L273
	cmp.l	#2,d4
	bge.b	L275
L274
;		return false;
	moveq	#0,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2-d5/a2/a6
	unlk	a5
	rts
L275
;	W3D_Lines lines = {0,sysVerts,currTex};
	lea	-$898(a5),a0
	clr.l	(a0)+
	lea	-$880(a5),a1
	move.l	a1,(a0)+
	move.l	_currTex__x3D,(a0)+
	clr.l	(a0)+
	clr.l	(a0)+
	clr.l	(a0)+
;	register DVERTEX* d = vertices+ofst;
	asl.l	#5,d0
	add.l	_vertices__x3D,d0
	move.l	d0,a2
;	if (Enabled(GOURAUD)) // shaded vertices require more work
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	move.l	#$400,d1
	jsr	-$2A(a6)
	cmp.l	#1,d0
	seq	d0
	and.l	#1,d0
	tst.w	d0
	beq	L293
L276
;		rsint32 c = --vCnt;
	subq.l	#1,d4
	move.l	d4,d3
	move.l	d3,d4
;		rfloat32 colFac = 1F/256F;
	fmove.s	#$.3B800000,fp2
; lines.vertexcount = OLD_STRIP_SEGS+1;
	move.l	#$21,-$898(a5)
;		while (c>OLD_STRIP_SEGS)
	bra	L283
L277
;			register W3D_Vertex* v = sysVerts;
	lea	-$880(a5),a0
; rsint32 i = OLD_STRIP_SEGS+2;
	moveq	#$22,d2
;			while(--i)
	bra	L279
L278
;				v->x = d->x;
	move.l	a2,a1
	move.l	(a1),(a0)
; v->y = d->y;
	move.l	a2,a1
	move.l	4(a1),4(a0)
; v->z = d->z;
	move.l	a2,a1
	fmove.s	$8(a1),fp0
	fmove.d	fp0,$8(a0)
; v->w = d->w;
	move.l	a2,a1
	move.l	$C(a1),$10(a0)
; v->u = d->u;
	move.l	a2,a1
	move.l	$10(a1),$14(a0)
; v->v = d->v;
	move.l	a2,a1
	move.l	$14(a1),$18(a0)
;				ruint32 clr			= (d++)->colour;
	move.l	a2,a1
	moveq	#$20,d0
	add.l	a2,d0
	move.l	d0,a2
	move.l	$18(a1),d0
;				v->color.r			= colFac*((clr & 0x00FF0000)>>16);
	move.l	d0,d1
	and.l	#$FF0000,d1
	moveq	#$10,d5
	lsr.l	d5,d1
	fmove.l	d1,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,$20(a0)
;	v->color.g			= colFac*((clr & 0x0000FF00)>>8);
	move.l	d0,d1
	and.l	#$FF00,d1
	moveq	#$8,d5
	lsr.l	d5,d1
	fmove.l	d1,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,$24(a0)
;				v->color.b			= colFac*( clr & 0x000000FF);
	move.l	d0,d1
	and.l	#$FF,d1
	fmove.l	d1,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,$28(a0)
;				(v++)->color.a	= colFac*((clr & 0xFF000000)>>24);
	and.l	#-$1000000,d0
	moveq	#$18,d1
	lsr.l	d1,d0
	fmove.l	d0,fp0
	fmul.x	fp2,fp0
	move.l	a0,a1
	add.w	#$40,a0
	fmove.s	fp0,$2C(a1)
L279
	subq.l	#1,d2
	tst.l	d2
	bne	L278
L280
;			if (W3D_DrawLineStrip(context, &lines)!=W3D_SUCCESS)
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	lea	-$898(a5),a1
	jsr	-$186(a6)
	tst.l	d0
	beq.b	L282
L281
;				return false;
	moveq	#0,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2-d5/a2/a6
	unlk	a5
	rts
L282
;			d--;
	moveq	#-$20,d0
	add.l	a2,d0
	move.l	d0,a2
;			c-=OLD_STRIP_SEGS;
	sub.l	#$20,d3
L283
	cmp.l	#$20,d3
	bgt	L277
L284
;		if (c>0)
	cmp.l	#0,d3
	ble	L292
L285
;			if (c<vCnt) // end of existing series of line segments
	cmp.l	d4,d3
	bge.b	L287
L286
;				d--;
	moveq	#-$20,d0
	add.l	a2,d0
	move.l	d0,a2
; c++;
	addq.l	#1,d3
L287
;			register W3D_Vertex* v = sysVerts;
	lea	-$880(a5),a0
;	lines.vertexcount = ++c;
	addq.l	#1,d3
	move.l	d3,-$898(a5)
;	rsint32 i = ++c;
	move.l	-$898(a5),d2
	addq.l	#1,d2
;			while(--i)
	bra	L289
L288
;				v->x = d->x;
	move.l	a2,a1
	move.l	(a1),(a0)
; v->y = d->y;
	move.l	a2,a1
	move.l	4(a1),4(a0)
; v->z = d->z;
	move.l	a2,a1
	fmove.s	$8(a1),fp0
	fmove.d	fp0,$8(a0)
; v->w = d->w;
	move.l	a2,a1
	move.l	$C(a1),$10(a0)
; v->u = d->u;
	move.l	a2,a1
	move.l	$10(a1),$14(a0)
; v->v = d->v;
	move.l	a2,a1
	move.l	$14(a1),$18(a0)
;				ruint32 clr			= (d++)->colour;
	move.l	a2,a1
	moveq	#$20,d0
	add.l	a2,d0
	move.l	d0,a2
	move.l	$18(a1),d0
;				v->color.r			= colFac*((clr & 0x00FF0000)>>16);
	move.l	d0,d1
	and.l	#$FF0000,d1
	moveq	#$10,d3
	lsr.l	d3,d1
	fmove.l	d1,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,$20(a0)
;	v->color.g			= colFac*((clr & 0x0000FF00)>>8);
	move.l	d0,d1
	and.l	#$FF00,d1
	moveq	#$8,d3
	lsr.l	d3,d1
	fmove.l	d1,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,$24(a0)
;				v->color.b			= colFac*( clr & 0x000000FF);
	move.l	d0,d1
	and.l	#$FF,d1
	fmove.l	d1,fp0
	fmul.x	fp2,fp0
	fmove.s	fp0,$28(a0)
;				(v++)->color.a	= colFac*((clr & 0xFF000000)>>24);
	and.l	#-$1000000,d0
	moveq	#$18,d1
	lsr.l	d1,d0
	fmove.l	d0,fp0
	fmul.x	fp2,fp0
	move.l	a0,a1
	add.w	#$40,a0
	fmove.s	fp0,$2C(a1)
L289
	subq.l	#1,d2
	tst.l	d2
	bne	L288
L290
;			if (W3D_DrawLineStrip(context, &lines)!=W3D_SUCCESS)
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	lea	-$898(a5),a1
	jsr	-$186(a6)
	tst.l	d0
	beq.b	L292
L291
;				return false;
	moveq	#0,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2-d5/a2/a6
	unlk	a5
	rts
L292
;		return true;
	moveq	#1,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2-d5/a2/a6
	unlk	a5
	rts
L293
;		rsint32 c = --vCnt;
	subq.l	#1,d4
	move.l	d4,d2
	move.l	d2,d4
;		lines.vertexcount = OLD_STRIP_SEGS+1;
	move.l	#$21,-$898(a5)
;		while (c>OLD_STRIP_SEGS)
	bra	L300
L294
;			register W3D_Vertex* v = sysVerts;
	lea	-$880(a5),a0
;			rsint32 i = OLD_STRIP_SEGS+2;
	moveq	#$22,d0
;			while(--i)
	bra.b	L296
L295
;				v->x = d->x;
	move.l	a2,a1
	move.l	(a1),(a0)
; v->y = d->y;
	move.l	a2,a1
	move.l	4(a1),4(a0)
; v->z = d->z;
	move.l	a2,a1
	fmove.s	$8(a1),fp0
	fmove.d	fp0,$8(a0)
; v->w = d->w;
	move.l	a2,a1
	move.l	$C(a1),$10(a0)
; v->u = d->u;
	move.l	a2,a1
	move.l	$10(a1),$14(a0)
; (v++)->v = (d++)->v;
	move.l	a2,a1
	moveq	#$20,d1
	add.l	a2,d1
	move.l	d1,a2
	fmove.s	$14(a1),fp0
	move.l	a0,a1
	add.w	#$40,a0
	fmove.s	fp0,$18(a1)
L296
	subq.l	#1,d0
	tst.l	d0
	bne.b	L295
L297
;			if (W3D_DrawLineStrip(context, &lines)!=W3D_SUCCESS)
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	lea	-$898(a5),a1
	jsr	-$186(a6)
	tst.l	d0
	beq.b	L299
L298
;				return false;
	moveq	#0,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2-d5/a2/a6
	unlk	a5
	rts
L299
;			d--;
	moveq	#-$20,d0
	add.l	a2,d0
	move.l	d0,a2
;			c-=OLD_STRIP_SEGS;
	sub.l	#$20,d2
L300
	cmp.l	#$20,d2
	bgt	L294
L301
;		if (c>0)
	cmp.l	#0,d2
	ble	L309
L302
;			if (c<vCnt) // end of existing series of line segments
	cmp.l	d4,d2
	bge.b	L304
L303
;				d--;
	moveq	#-$20,d0
	add.l	a2,d0
	move.l	d0,a2
; c++;
	addq.l	#1,d2
L304
;			register W3D_Vertex* v = sysVerts;
	lea	-$880(a5),a0
; lines.vertexcount = ++c;
	addq.l	#1,d2
	move.l	d2,-$898(a5)
; rsint32 i = ++c;
	move.l	-$898(a5),d0
	addq.l	#1,d0
;			while (--i)
	bra.b	L306
L305
;				v->x = d->x;
	move.l	a2,a1
	move.l	(a1),(a0)
; v->y = d->y;
	move.l	a2,a1
	move.l	4(a1),4(a0)
; v->z = d->z;
	move.l	a2,a1
	fmove.s	$8(a1),fp0
	fmove.d	fp0,$8(a0)
; v->w = d->w;
	move.l	a2,a1
	move.l	$C(a1),$10(a0)
; v->u = d->u;
	move.l	a2,a1
	move.l	$10(a1),$14(a0)
; (v++)->v = (d++)->v;
	move.l	a2,a1
	moveq	#$20,d1
	add.l	a2,d1
	move.l	d1,a2
	fmove.s	$14(a1),fp0
	move.l	a0,a1
	add.w	#$40,a0
	fmove.s	fp0,$18(a1)
L306
	subq.l	#1,d0
	tst.l	d0
	bne.b	L305
L307
;			if (W3D_DrawLineStrip(context, &lines)!=W3D_SUCCESS)
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	lea	-$898(a5),a1
	jsr	-$186(a6)
	tst.l	d0
	beq.b	L309
L308
;				return false;
	moveq	#0,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2-d5/a2/a6
	unlk	a5
	rts
L309
;		return true;
	moveq	#1,d0
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2-d5/a2/a6
	unlk	a5
	rts

	END
