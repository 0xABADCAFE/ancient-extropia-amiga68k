
; Storm C Compiler
; extropialib:lib/Platforms/Amiga68k/GraphicsLib/Util.cpp
	mc68030
	mc68881
	XREF	_0dt__DRAWLIST__T
	XREF	Delete__xTEXFONT__T
	XREF	_0ct__xTEXSURF__T
	XREF	Delete__xTEXSURF__T
	XREF	Create__xTEXSURF__TssEP06ARGB32
	XREF	Bind__xTEXSURF__T
	XREF	ReadBody__xTEXSURF__TR05XSFIO
	XREF	WriteBody__xTEXSURF__TR05XSFIO
	XREF	ReadyForRead__xTEXSURF__T
	XREF	ReadyForWrite__xTEXSURF__T
	XREF	_0ct__XSFOBJ__T
	XREF	Set__XSFHEAD__TPCcUcUcUcUc
	XREF	op__equal__XSFHEAD__TR05XSFIO
	XREF	op__equal__XSFHEAD__TR07XSFHEAD
	XREF	op__notEqual__XSFHEAD__TR07XSFHEAD
	XREF	Value__XDATAID__TPCc
	XREF	Refresh__xDBSCREEN__T
	XREF	Close__xDBSCREEN__T
	XREF	Open__xDBSCREEN__T
	XREF	Close__xSCREEN__T
	XREF	Open__xSCREEN__T
	XREF	Set__xSCREEN__TP06xDMODEPCc
	XREF	Close__xDBWIN__T
	XREF	Open__xDBWIN__T
	XREF	Set__xDBWIN__TsssssPCc
	XREF	MoveEvent__xDISPLAYIO__T
	XREF	ResizeEvent__xDISPLAYIO__T
	XREF	Idle__xDISPLAYIO__T
	XREF	HandleEvent__xDISPLAYIO__T
	XREF	ApplyInputModification__xDISPLAYIO__T
	XREF	ViewSurface__xDISPLAY__T
	XREF	DrawSurface__xDISPLAY__T
	XREF	Refresh__xDISPLAY__T
	XREF	Close__xDISPLAY__T
	XREF	Open__xDISPLAY__T
	XREF	_0dt__LOCK__T
	XREF	_0dt__THREAD__T
	XREF	Run__THREAD__T
	XREF	_0dt__DELAY__T
	XREF	_0ct__DELAY__T
	XREF	Pause__DELAY__TUj
	XREF	Pause__DELAY__TUjUj
	XREF	Abort__DELAY__T
	XREF	UnLink__xCHAINABLE__T
	XREF	Close__xFILEIO__T
	XREF	Flush__xFILEIO__T
	XREF	Write64Swap__xFILEIO__TPvUi
	XREF	Write32Swap__xFILEIO__TPvUi
	XREF	Write16Swap__xFILEIO__TPvUi
	XREF	Write__xFILEIO__TPvUiUi
	XREF	ReadText__xFILEIO__TPcjcj
	XREF	Read64Swap__xFILEIO__TPvUi
	XREF	Read32Swap__xFILEIO__TPvUi
	XREF	Read16Swap__xFILEIO__TPvUi
	XREF	Read__xFILEIO__TPvUiUi
	XREF	Tell__xFILEIO__T
	XREF	Seek__xFILEIO__Tjj
	XREF	Open__xFILEIO__TPCcjj
	XREF	SendPacket__xFILEIO__TPv
	XREF	WaitPacket__xFILEIO__T
	XREF	InputQueued__xINPUT__T
	XREF	Idle__xINPUT__T
	XREF	ExitEvent__xINPUT__T
	XREF	MouseEvent__xINPUT__Tjjj
	XREF	ApplyInputModification__xINPUT__T
	XREF	_0dt__xKEY__T
	XREF	_0ct__xKEY__T
	XREF	KeyEvent__xKEY__Tjsj
	XREF	_0dt__xSURFACE__T
	XREF	_0dt__POOL_ST__T
	XREF	_0ct__POOL_ST__TUsUj
	XREF	FreeT__POOL_ST__TPv
	XREF	NewT__POOL_ST__TPvUs
	XREF	NewT__POOL_ST__TPv
	XREF	Create__POOL_ST__TUsUj
	XREF	_0dt__POOL_LT__T
	XREF	DrawSurface__x3D__P08xSURFACE
	XREF	v3DrawLineStrip__x3D__jj
	XREF	v3DrawLines__x3D__jj
	XREF	_W3D_DrawArray
	XREF	_W3D_BindTexture
	XREF	_system
	XREF	_sscanf
	XREF	_std__in
	XREF	_std__out
	XREF	_std__err
	XREF	_st
	XREF	_gxSt
	XREF	_numStartArgs__xBASELIB
	XREF	_startArgs__xBASELIB
	XREF	_SysBase
	XREF	_IntuitionBase
	XREF	_TimerBase
	XREF	_DOSBase
	XREF	_PowerPCBase
	XREF	_sysData__sysBASELIB
	XREF	_msgbuff__sysBASELIB
	XREF	_main__sysBASELIB
	XREF	_allocated__MEM
	XREF	_totSize__MEM
	XREF	_nextFree__MEM
	XREF	_cnt__MEM
	XREF	_maxAllocs__MEM
	XREF	_fpuPrecision__CPU
	XREF	_cpuNames__CPU
	XREF	_GfxBase
	XREF	_CyberGfxBase
	XREF	_surfaceTypes__x2D
	XREF	_Warp3DBase
	XREF	_hw3D__sys3DDEVICE
	XREF	_context__sys3DDEVICE
	XREF	_drawRegion__x3D
	XREF	_fogData__x3D
	XREF	_flags__x3D
	XREF	_vertices__x3D
	XREF	_currTex__x3D
	XREF	_drawSurface__x3D
	XREF	_currCol__x3D
	XREF	_useV4__x3D
	XREF	_flags__xGFX
	XREF	_mode__xGFX
	XREF	_numModes__xGFX
	XREF	_rPool__xSURFACE
	XREF	_KeymapBase
	XREF	_useCount__xKEY
	XREF	_TimerBase__MILLICLOCK
	XREF	_current__MILLICLOCK
	XREF	_clockFreq__MILLICLOCK
	XREF	_threadCnt__THREAD
	XREF	_threadsIdle__THREAD
	XREF	_rootThread__THREAD
	XREF	_sigXSF__XSFHEAD
	XREF	_fileMarker__XSFOBJ
	XREF	_DiskfontBase
	XREF	_flags__DRAW
	XREF	_stack__VGPU
	XREF	_stackPos__VGPU
	XREF	_vertexBase__VGPU
	XREF	_vertexTop__VGPU
	XREF	_dataPos__VGPU
	XREF	_instPos__VGPU
	XREF	_exe_flags__VGPU
	XREF	_exe_stateReg__VGPU
	XREF	_exe_colourReg__VGPU
	XREF	_exe_texReg__VGPU
	XREF	_exe_fogReg__VGPU
	XREF	_exe_errReg__VGPU
	XREF	_funcTab__VGPU
	XREF	_qTrigTab__DRAWLIST

	SECTION "Round16__r23d:0",CODE

	rts

	SECTION "ValidatePPM__xTEXSURF_LOADER__P07xFILEIOPjPj:0",CODE


;bool xTEXSURF_LOADER::ValidatePPM(xFILEIO* f, sint32* width, sint32*
	XDEF	ValidatePPM__xTEXSURF_LOADER__P07xFILEIOPjPj
ValidatePPM__xTEXSURF_LOADER__P07xFILEIOPjPj
L156	EQU	-$28
	link	a5,#L156
	movem.l	d2/a2/a3/a6,-(a7)
	movem.l	$8(a5),a2/a6
	move.l	$10(a5),a3
L145
;	if (f->Valid()==false || !width || !height)
	move.l	$96(a2),d0
	and.l	#$40,d0
	tst.w	d0
	beq.b	L148
L146
	cmp.w	#0,a6
	beq.b	L148
L147
	cmp.w	#0,a3
	bne.b	L149
L148
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2/a3/a6
	unlk	a5
	rts
L149
;	char sig[32] = {0};
	lea	-$28(a5),a0
	clr.b	(a0)+
	moveq	#$1E,d0
L157
	clr.b	(a0)+
	dbra	d0,L157
;	f->ReadText(sig, 32, '\n', 4);
	pea	4.w
	move.b	#$A,-(a7)
	pea	$20.w
	pea	-$28(a5)
	move.l	a2,-(a7)
	jsr	ReadText__xFILEIO__TPcjcj
	add.w	#$12,a7
;	if (sscanf(sig, "P6\n%ld\n%ld\n255\n", &w, &h)!=2 || (f->Size() - 
	pea	-$8(a5)
	pea	-4(a5)
	move.l	#L144,-(a7)
	pea	-$28(a5)
	jsr	_sscanf
	add.w	#$10,a7
	cmp.l	#2,d0
	bne.b	L154
L150
	move.l	a2,a0
	move.l	$96(a0),d0
	and.l	#5,d0
	beq.b	L152
L151
	move.l	4(a0),d2
	bra.b	L153
L152
	move.l	#-$3040000,d2
L153
	move.l	a2,-(a7)
	jsr	Tell__xFILEIO__T
	addq.w	#4,a7
	sub.l	d0,d2
	move.l	-4(a5),d0
	muls.l	-$8(a5),d0
	muls.l	#3,d0
	cmp.l	d0,d2
	beq.b	L155
L154
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2/a3/a6
	unlk	a5
	rts
L155
;	*width = w;
	move.l	a6,a0
	move.l	-4(a5),(a0)
;	*height = h;
	move.l	a3,a0
	move.l	-$8(a5),(a0)
;	return true;
	moveq	#1,d0
	movem.l	(a7)+,d2/a2/a3/a6
	unlk	a5
	rts

L144
	dc.b	'P6',$A,'%ld',$A,'%ld',$A,'255',$A,0

	SECTION "ValidatePGM__xTEXSURF_LOADER__P07xFILEIOPjPj:0",CODE


;bool xTEXSURF_LOADER::ValidatePGM(xFILEIO* f, sint32* width, sint32*
	XDEF	ValidatePGM__xTEXSURF_LOADER__P07xFILEIOPjPj
ValidatePGM__xTEXSURF_LOADER__P07xFILEIOPjPj
L170	EQU	-$28
	link	a5,#L170
	movem.l	d2/a2/a3/a6,-(a7)
	movem.l	$8(a5),a2/a6
	move.l	$10(a5),a3
L159
;	if (f->Valid()==false || !width || !height)
	move.l	$96(a2),d0
	and.l	#$40,d0
	tst.w	d0
	beq.b	L162
L160
	cmp.w	#0,a6
	beq.b	L162
L161
	cmp.w	#0,a3
	bne.b	L163
L162
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2/a3/a6
	unlk	a5
	rts
L163
;	char sig[32] = {0};
	lea	-$28(a5),a0
	clr.b	(a0)+
	moveq	#$1E,d0
L171
	clr.b	(a0)+
	dbra	d0,L171
;	f->ReadText(sig, 32, '\n', 4);
	pea	4.w
	move.b	#$A,-(a7)
	pea	$20.w
	pea	-$28(a5)
	move.l	a2,-(a7)
	jsr	ReadText__xFILEIO__TPcjcj
	add.w	#$12,a7
;	if (sscanf(sig, "P5\n%ld\n%ld\n255\n", &w, &h)!=2 || (f->Size() - 
	pea	-$8(a5)
	pea	-4(a5)
	move.l	#L158,-(a7)
	pea	-$28(a5)
	jsr	_sscanf
	add.w	#$10,a7
	cmp.l	#2,d0
	bne.b	L168
L164
	move.l	a2,a0
	move.l	$96(a0),d0
	and.l	#5,d0
	beq.b	L166
L165
	move.l	4(a0),d2
	bra.b	L167
L166
	move.l	#-$3040000,d2
L167
	move.l	a2,-(a7)
	jsr	Tell__xFILEIO__T
	addq.w	#4,a7
	sub.l	d0,d2
	move.l	-4(a5),d0
	muls.l	-$8(a5),d0
	cmp.l	d0,d2
	beq.b	L169
L168
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2/a3/a6
	unlk	a5
	rts
L169
;	*width = w;
	move.l	a6,a0
	move.l	-4(a5),(a0)
;	*height = h;
	move.l	a3,a0
	move.l	-$8(a5),(a0)
;	return true;
	moveq	#1,d0
	movem.l	(a7)+,d2/a2/a3/a6
	unlk	a5
	rts

L158
	dc.b	'P5',$A,'%ld',$A,'%ld',$A,'255',$A,0

	SECTION "LoadPPMFixedAlphaWide__xTEXSURF_LOADER__P08xTEXSURFPCcUc:0",CODE


;bool xTEXSURF_LOADER::LoadPPMFixedAlphaWide(xTEXSURF* t, const char*
	XDEF	LoadPPMFixedAlphaWide__xTEXSURF_LOADER__P08xTEXSURFPCcUc
LoadPPMFixedAlphaWide__xTEXSURF_LOADER__P08xTEXSURFPCcUc
L210	EQU	-$B4
	link	a5,#L210
	movem.l	d2-d5/a2/a3/a6,-(a7)
	move.b	$10(a5),d2
	move.l	$C(a5),a1
	move.l	$8(a5),a3
L172
;	if (!t || !ppmName || t->Data())
	cmp.w	#0,a3
	beq.b	L175
L173
	cmp.w	#0,a1
	beq.b	L175
L174
	tst.l	$16(a3)
	beq.b	L176
L175
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d5/a2/a3/a6
	unlk	a5
	rts
L176
;	xFILEIO file(ppmName, xFILEIO::READ);
	lea	-$9A(a5),a0
	clr.l	(a0)
	clr.l	$96(a0)
	pea	$400.w
	pea	1.w
	move.l	a1,-(a7)
	move.l	a0,-(a7)
	jsr	Open__xFILEIO__TPCcjj
	add.w	#$10,a7
;	sint32 w=0
	clr.l	-$9E(a5)
;	sint32 w=0, h=0;
	clr.l	-$A2(a5)
;	if (ValidatePPM(&file, &w, &h)==false || t->Create(w, h, xTEXSURF:
	pea	-$A2(a5)
	pea	-$9E(a5)
	pea	-$9A(a5)
	jsr	ValidatePPM__xTEXSURF_LOADER__P07xFILEIOPjPj
	add.w	#$C,a7
	tst.w	d0
	beq.b	L178
L177
	clr.l	-(a7)
	pea	5.w
	move.w	-$A0(a5),-(a7)
	move.w	-$9C(a5),-(a7)
	move.l	a3,-(a7)
	jsr	Create__xTEXSURF__TssEP06ARGB32
	add.w	#$10,a7
	tst.l	d0
	beq.b	L179
L178
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d5/a2/a3/a6
	unlk	a5
	rts
L179
;		ruint32 a = (uint32)alphaVal<<24;
	moveq	#0,d5
	move.b	d2,d5
	moveq	#$18,d0
	asl.l	d0,d5
;		rsint32 n = (w*h)+1;
	move.l	-$9E(a5),d4
	muls.l	-$A2(a5),d4
	addq.l	#1,d4
;		ruint32* dest = (uint32*)t->Data();
	move.l	$16(a3),a2
;		while (--n)
	bra	L208
L180
;			ruint32 t = a | ((uint8)file.GetChar())<<16;
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L188
L181
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L185
L182
	tst.l	d2
	bne.b	L184
L183
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L189
L184
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L189
L185
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L187
L186
	move.l	d2,$92(a6)
L187
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L188
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L189
	and.l	#$FF,d0
	moveq	#$10,d1
	asl.l	d1,d0
	move.l	d5,d3
	or.l	d0,d3
;			t |= ((uint8)file.GetChar())<<8;
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L197
L190
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L194
L191
	tst.l	d2
	bne.b	L193
L192
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L198
L193
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L198
L194
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L196
L195
	move.l	d2,$92(a6)
L196
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L197
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L198
	and.l	#$FF,d0
	moveq	#$8,d1
	asl.l	d1,d0
	or.l	d0,d3
;			t |= ((uint8)file.GetChar());
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L206
L199
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L203
L200
	tst.l	d2
	bne.b	L202
L201
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L207
L202
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L207
L203
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L205
L204
	move.l	d2,$92(a6)
L205
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L206
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L207
	and.l	#$FF,d0
	or.l	d0,d3
;			*(dest++) = t;
	move.l	d3,(a2)+
L208
	subq.l	#1,d4
	tst.l	d4
	bne	L180
L209
;	file.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
;	t->Bind();
	move.l	a3,-(a7)
	jsr	Bind__xTEXSURF__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#1,d0
	movem.l	(a7)+,d2-d5/a2/a3/a6
	unlk	a5
	rts

	SECTION "LoadPPMFixedAlphaNarrow__xTEXSURF_LOADER__P08xTEXSURFPCcUc:0",CODE


;bool xTEXSURF_LOADER::LoadPPMFixedAlphaNarrow(xTEXSURF* t, const cha
	XDEF	LoadPPMFixedAlphaNarrow__xTEXSURF_LOADER__P08xTEXSURFPCcUc
LoadPPMFixedAlphaNarrow__xTEXSURF_LOADER__P08xTEXSURFPCcUc
L251	EQU	-$AC
	link	a5,#L251
	movem.l	d2-d5/a2/a3/a6,-(a7)
	move.b	$10(a5),d2
	move.l	$C(a5),a1
	move.l	$8(a5),a3
L211
;	if (!t || !ppmName || t->Data())
	cmp.w	#0,a3
	beq.b	L214
L212
	cmp.w	#0,a1
	beq.b	L214
L213
	tst.l	$16(a3)
	beq.b	L215
L214
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d5/a2/a3/a6
	unlk	a5
	rts
L215
;	else if ((alphaVal&0xF0) == 0xF0)
	moveq	#0,d0
	move.b	d2,d0
	and.l	#$F0,d0
	cmp.l	#$F0,d0
	bne.b	L217
L216
;		return LoadPPMOpaqueNarrow(t, ppmName);
	move.l	a1,-(a7)
	move.l	a3,-(a7)
	jsr	LoadPPMOpaqueNarrow__xTEXSURF_LOADER__P08xTEXSURFPCc
	addq.w	#$8,a7
	movem.l	(a7)+,d2-d5/a2/a3/a6
	unlk	a5
	rts
L217
;	xFILEIO file(ppmName, xFILEIO::READ);
	lea	-$9A(a5),a0
	clr.l	(a0)
	clr.l	$96(a0)
	pea	$400.w
	pea	1.w
	move.l	a1,-(a7)
	move.l	a0,-(a7)
	jsr	Open__xFILEIO__TPCcjj
	add.w	#$10,a7
;	sint32 w=0
	clr.l	-$9E(a5)
;	sint32 w=0, h=0;
	clr.l	-$A2(a5)
;	if (ValidatePPM(&file, &w, &h)==false || t->Create(w, h, xTEXSURF:
	pea	-$A2(a5)
	pea	-$9E(a5)
	pea	-$9A(a5)
	jsr	ValidatePPM__xTEXSURF_LOADER__P07xFILEIOPjPj
	add.w	#$C,a7
	tst.w	d0
	beq.b	L219
L218
	clr.l	-(a7)
	pea	4.w
	move.w	-$A0(a5),-(a7)
	move.w	-$9C(a5),-(a7)
	move.l	a3,-(a7)
	jsr	Create__xTEXSURF__TssEP06ARGB32
	add.w	#$10,a7
	tst.l	d0
	beq.b	L220
L219
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d5/a2/a3/a6
	unlk	a5
	rts
L220
;		ruint16 a = (alphaVal&0xF0)<<8;
	moveq	#0,d0
	move.b	d2,d0
	and.l	#$F0,d0
	moveq	#$8,d1
	asl.l	d1,d0
	move.w	d0,d5
;		rsint32 n = (w*h)+1;
	move.l	-$9E(a5),d4
	muls.l	-$A2(a5),d4
	addq.l	#1,d4
;		ruint16* dest = (uint16*)t->Data();
	move.l	$16(a3),a2
;		while (--n)
	bra	L249
L221
;			ruint16 t = a | (((uint8)file.GetChar())&0xF0)<<4;
	moveq	#0,d3
	move.w	d5,d3
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L229
L222
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L226
L223
	tst.l	d2
	bne.b	L225
L224
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L230
L225
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L230
L226
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L228
L227
	move.l	d2,$92(a6)
L228
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L229
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L230
	and.l	#$FF,d0
	and.l	#$F0,d0
	moveq	#4,d1
	asl.l	d1,d0
	or.l	d0,d3
;			t |= (((uint8)file.GetChar())&0xF0);
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L238
L231
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L235
L232
	tst.l	d2
	bne.b	L234
L233
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L239
L234
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L239
L235
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L237
L236
	move.l	d2,$92(a6)
L237
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L238
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L239
	and.l	#$FF,d0
	and.l	#$F0,d0
	or.w	d0,d3
;			t |= (((uint8)file.GetChar())&0xF0)>>4;
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L247
L240
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L244
L241
	tst.l	d2
	bne.b	L243
L242
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L248
L243
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L248
L244
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L246
L245
	move.l	d2,$92(a6)
L246
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L247
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L248
	and.l	#$FF,d0
	and.l	#$F0,d0
	moveq	#4,d1
	asr.l	d1,d0
	or.w	d0,d3
;			*(dest++) = t;
	move.w	d3,(a2)+
L249
	subq.l	#1,d4
	tst.l	d4
	bne	L221
L250
;	file.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
;	t->Bind();
	move.l	a3,-(a7)
	jsr	Bind__xTEXSURF__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#1,d0
	movem.l	(a7)+,d2-d5/a2/a3/a6
	unlk	a5
	rts

	SECTION "LoadPPMOpaqueNarrow__xTEXSURF_LOADER__P08xTEXSURFPCc:0",CODE


;bool xTEXSURF_LOADER::LoadPPMOpaqueNarrow(xTEXSURF* t, const char* p
	XDEF	LoadPPMOpaqueNarrow__xTEXSURF_LOADER__P08xTEXSURFPCc
LoadPPMOpaqueNarrow__xTEXSURF_LOADER__P08xTEXSURFPCc
L290	EQU	-$AC
	link	a5,#L290
	movem.l	d2-d4/a2/a3/a6,-(a7)
	move.l	$C(a5),a1
	move.l	$8(a5),a3
L252
;	if (!t || !ppmName || t->Data())
	cmp.w	#0,a3
	beq.b	L255
L253
	cmp.w	#0,a1
	beq.b	L255
L254
	tst.l	$16(a3)
	beq.b	L256
L255
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts
L256
;	xFILEIO file(ppmName, xFILEIO::READ);
	lea	-$9A(a5),a0
	clr.l	(a0)
	clr.l	$96(a0)
	pea	$400.w
	pea	1.w
	move.l	a1,-(a7)
	move.l	a0,-(a7)
	jsr	Open__xFILEIO__TPCcjj
	add.w	#$10,a7
;	sint32 w=0
	clr.l	-$9E(a5)
;	sint32 w=0, h=0;
	clr.l	-$A2(a5)
;	if (ValidatePPM(&file, &w, &h)==false || t->Create(w, h, xTEXSURF:
	pea	-$A2(a5)
	pea	-$9E(a5)
	pea	-$9A(a5)
	jsr	ValidatePPM__xTEXSURF_LOADER__P07xFILEIOPjPj
	add.w	#$C,a7
	tst.w	d0
	beq.b	L258
L257
	clr.l	-(a7)
	pea	1.w
	move.w	-$A0(a5),-(a7)
	move.w	-$9C(a5),-(a7)
	move.l	a3,-(a7)
	jsr	Create__xTEXSURF__TssEP06ARGB32
	add.w	#$10,a7
	tst.l	d0
	beq.b	L259
L258
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts
L259
;		rsint32 n = (w*h)+1;
	move.l	-$9E(a5),d4
	muls.l	-$A2(a5),d4
	addq.l	#1,d4
;		ruint16* dest = (uint16*)t->Data();
	move.l	$16(a3),a2
;		while (--n)
	bra	L288
L260
;			ruint16 t = 0x8000 | (((uint8)file.GetChar())&0xF8)<<7;
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L268
L261
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L265
L262
	tst.l	d2
	bne.b	L264
L263
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L269
L264
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L269
L265
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L267
L266
	move.l	d2,$92(a6)
L267
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L268
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L269
	and.l	#$FF,d0
	and.l	#$F8,d0
	moveq	#7,d1
	asl.l	d1,d0
	or.l	#$8000,d0
	move.w	d0,d3
;			t |= (((uint8)file.GetChar())&0xF8)<<2;
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L277
L270
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L274
L271
	tst.l	d2
	bne.b	L273
L272
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L278
L273
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L278
L274
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L276
L275
	move.l	d2,$92(a6)
L276
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L277
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L278
	and.l	#$FF,d0
	and.l	#$F8,d0
	moveq	#2,d1
	asl.l	d1,d0
	or.w	d0,d3
;			t |= (((uint8)file.GetChar())&0xF8)>>3;
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L286
L279
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L283
L280
	tst.l	d2
	bne.b	L282
L281
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L287
L282
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L287
L283
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L285
L284
	move.l	d2,$92(a6)
L285
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L286
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L287
	and.l	#$FF,d0
	and.l	#$F8,d0
	moveq	#3,d1
	asr.l	d1,d0
	or.w	d0,d3
;			*(dest++) = t;
	move.w	d3,(a2)+
L288
	subq.l	#1,d4
	tst.l	d4
	bne	L260
L289
;	file.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
;	t->Bind();
	move.l	a3,-(a7)
	jsr	Bind__xTEXSURF__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#1,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts

	SECTION "LoadPPMScaledAlphaWide__xTEXSURF_LOADER__P08xTEXSURFPCc06ARGB32:0",CODE


;bool xTEXSURF_LOADER::LoadPPMScaledAlphaWide(xTEXSURF* t, const char
	XDEF	LoadPPMScaledAlphaWide__xTEXSURF_LOADER__P08xTEXSURFPCc06ARGB32
LoadPPMScaledAlphaWide__xTEXSURF_LOADER__P08xTEXSURFPCc06ARGB32
L329	EQU	-$BC
	link	a5,#L329
	movem.l	d2-d6/a2/a3/a6,-(a7)
	move.l	$C(a5),a1
	move.l	$8(a5),a3
L291
;	if (!t || !ppmName || t->Data())
	cmp.w	#0,a3
	beq.b	L294
L292
	cmp.w	#0,a1
	beq.b	L294
L293
	tst.l	$16(a3)
	beq.b	L295
L294
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d6/a2/a3/a6
	unlk	a5
	rts
L295
;	xFILEIO file(ppmName, xFILEIO::READ);
	lea	-$9A(a5),a0
	clr.l	(a0)
	clr.l	$96(a0)
	pea	$400.w
	pea	1.w
	move.l	a1,-(a7)
	move.l	a0,-(a7)
	jsr	Open__xFILEIO__TPCcjj
	add.w	#$10,a7
;	sint32 w=0
	clr.l	-$9E(a5)
;	sint32 w=0, h=0;
	clr.l	-$A2(a5)
;	if (ValidatePPM(&file, &w, &h)==false || t->Create(w, h, xTEXSURF:
	pea	-$A2(a5)
	pea	-$9E(a5)
	pea	-$9A(a5)
	jsr	ValidatePPM__xTEXSURF_LOADER__P07xFILEIOPjPj
	add.w	#$C,a7
	tst.w	d0
	beq.b	L297
L296
	clr.l	-(a7)
	pea	5.w
	move.w	-$A0(a5),-(a7)
	move.w	-$9C(a5),-(a7)
	move.l	a3,-(a7)
	jsr	Create__xTEXSURF__TssEP06ARGB32
	add.w	#$10,a7
	tst.l	d0
	beq.b	L298
L297
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d6/a2/a3/a6
	unlk	a5
	rts
L298
;		uint32 dvz = (alphaGen.Red()<<8) + (alphaGen.Green()<<8) + (alph
	lea	$10(a5),a0
	moveq	#0,d6
	move.b	1(a0),d6
	move.l	d6,d0
	moveq	#$8,d1
	asl.l	d1,d0
	move.l	d0,d6
	lea	$10(a5),a0
	moveq	#0,d0
	move.b	2(a0),d0
	moveq	#$8,d1
	asl.l	d1,d0
	move.l	d6,d1
	add.l	d0,d1
	move.l	d1,d6
	lea	$10(a5),a0
	moveq	#0,d0
	move.b	3(a0),d0
	moveq	#$8,d1
	asl.l	d1,d0
	move.l	d6,d1
	add.l	d0,d1
	move.l	d1,d6
;		rsint32 n = (w*h)+1;
	move.l	-$9E(a5),d5
	muls.l	-$A2(a5),d5
	addq.l	#1,d5
;		ruint32* dest	= (uint32*)t->Data();
	move.l	$16(a3),a2
;		while (--n)
	bra	L327
L299
;			ruint32	v = (uint8)file.GetChar();
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L307
L300
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L304
L301
	tst.l	d2
	bne.b	L303
L302
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L308
L303
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L308
L304
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L306
L305
	move.l	d2,$92(a6)
L306
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L307
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L308
	and.l	#$FF,d0
;			ruint32	t = v<<16;
	move.l	d0,d4
	moveq	#$10,d1
	asl.l	d1,d4
;			ruint32 a = v*alphaGen.Red();
	lea	$10(a5),a0
	moveq	#0,d1
	move.b	1(a0),d1
	move.l	d0,d2
	mulu.l	d1,d2
;			v = (uint8)file.GetChar();
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L316
L309
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d3
	cmp.l	#0,d3
	bgt.b	L313
L310
	tst.l	d3
	bne.b	L312
L311
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L317
L312
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L317
L313
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d3,d0
	bls.b	L315
L314
	move.l	d3,$92(a6)
L315
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d3
	move.l	d3,$18(a6)
	clr.l	$92(a6)
L316
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L317
	and.l	#$FF,d0
;	t |= v<<8;
	move.l	d0,d1
	moveq	#$8,d3
	asl.l	d3,d1
	or.l	d1,d4
;	a += v*alphaGen.Green();
	lea	$10(a5),a0
	moveq	#0,d1
	move.b	2(a0),d1
	mulu.l	d1,d0
	add.l	d0,d2
;			v = (uint8)file.GetChar();
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L325
L318
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d3
	cmp.l	#0,d3
	bgt.b	L322
L319
	tst.l	d3
	bne.b	L321
L320
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L326
L321
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L326
L322
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d3,d0
	bls.b	L324
L323
	move.l	d3,$92(a6)
L324
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d3
	move.l	d3,$18(a6)
	clr.l	$92(a6)
L325
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L326
	and.l	#$FF,d0
;	t |= v;
	or.l	d0,d4
;			a += v*alphaGen.Blue();
	lea	$10(a5),a0
	moveq	#0,d1
	move.b	3(a0),d1
	mulu.l	d1,d0
	add.l	d0,d2
;			a = (a*alphaGen.Alpha())/dvz;
	moveq	#0,d0
	move.b	$10(a5),d0
	mulu.l	d0,d2
	divul.l	d6,d2
;			*(dest++) = a<<24 | t;
	moveq	#$18,d0
	asl.l	d0,d2
	or.l	d4,d2
	move.l	d2,(a2)+
L327
	subq.l	#1,d5
	tst.l	d5
	bne	L299
L328
;	file.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
;	t->Bind();
	move.l	a3,-(a7)
	jsr	Bind__xTEXSURF__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#1,d0
	movem.l	(a7)+,d2-d6/a2/a3/a6
	unlk	a5
	rts

	SECTION "LoadPPMScaledAlphaNarrow__xTEXSURF_LOADER__P08xTEXSURFPCc06ARGB32:0",CODE


;bool xTEXSURF_LOADER::LoadPPMScaledAlphaNarrow(xTEXSURF* t, const ch
	XDEF	LoadPPMScaledAlphaNarrow__xTEXSURF_LOADER__P08xTEXSURFPCc06ARGB32
LoadPPMScaledAlphaNarrow__xTEXSURF_LOADER__P08xTEXSURFPCc06ARGB32
L368	EQU	-$B8
	link	a5,#L368
	movem.l	d2-d6/a2/a3/a6,-(a7)
	move.l	$C(a5),a1
	move.l	$8(a5),a3
L330
;	if (!t || !ppmName || t->Data())
	cmp.w	#0,a3
	beq.b	L333
L331
	cmp.w	#0,a1
	beq.b	L333
L332
	tst.l	$16(a3)
	beq.b	L334
L333
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d6/a2/a3/a6
	unlk	a5
	rts
L334
;	xFILEIO file(ppmName, xFILEIO::READ);
	lea	-$9A(a5),a0
	clr.l	(a0)
	clr.l	$96(a0)
	pea	$400.w
	pea	1.w
	move.l	a1,-(a7)
	move.l	a0,-(a7)
	jsr	Open__xFILEIO__TPCcjj
	add.w	#$10,a7
;	sint32 w=0
	clr.l	-$9E(a5)
;	sint32 w=0, h=0;
	clr.l	-$A2(a5)
;	if (ValidatePPM(&file, &w, &h)==false || t->Create(w, h, xTEXSURF:
	pea	-$A2(a5)
	pea	-$9E(a5)
	pea	-$9A(a5)
	jsr	ValidatePPM__xTEXSURF_LOADER__P07xFILEIOPjPj
	add.w	#$C,a7
	tst.w	d0
	beq.b	L336
L335
	clr.l	-(a7)
	pea	4.w
	move.w	-$A0(a5),-(a7)
	move.w	-$9C(a5),-(a7)
	move.l	a3,-(a7)
	jsr	Create__xTEXSURF__TssEP06ARGB32
	add.w	#$10,a7
	tst.l	d0
	beq.b	L337
L336
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d6/a2/a3/a6
	unlk	a5
	rts
L337
;		uint32 dvz = ((alphaGen.Red()<<8) + (alphaGen.Green()<<8) + (alp
	lea	$10(a5),a0
	moveq	#0,d6
	move.b	1(a0),d6
	move.l	d6,d0
	moveq	#$8,d1
	asl.l	d1,d0
	move.l	d0,d6
	lea	$10(a5),a0
	moveq	#0,d0
	move.b	2(a0),d0
	moveq	#$8,d1
	asl.l	d1,d0
	move.l	d6,d1
	add.l	d0,d1
	move.l	d1,d6
	lea	$10(a5),a0
	moveq	#0,d0
	move.b	3(a0),d0
	moveq	#$8,d1
	asl.l	d1,d0
	move.l	d6,d1
	add.l	d0,d1
	move.l	d1,d0
	moveq	#4,d1
	asl.l	d1,d0
	move.l	d0,d6
;		rsint32 n = (w*h)+1;
	move.l	-$9E(a5),d5
	muls.l	-$A2(a5),d5
	addq.l	#1,d5
;		ruint16* dest	= (uint16*)t->Data();
	move.l	$16(a3),a2
;		while (--n)
	bra	L366
L338
;			ruint32 v = (uint8)file.GetChar();
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L346
L339
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L343
L340
	tst.l	d2
	bne.b	L342
L341
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L347
L342
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L347
L343
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L345
L344
	move.l	d2,$92(a6)
L345
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L346
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L347
	and.l	#$FF,d0
;			ruint16 t = (v&0xF0)<<4;
	move.l	d0,d1
	and.l	#$F0,d1
	moveq	#4,d2
	asl.l	d2,d1
	move.w	d1,d4
;			ruint32 a = v*alphaGen.Red();
	lea	$10(a5),a0
	moveq	#0,d1
	move.b	1(a0),d1
	move.l	d0,d2
	mulu.l	d1,d2
;			v = (uint8)file.GetChar();
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L355
L348
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d3
	cmp.l	#0,d3
	bgt.b	L352
L349
	tst.l	d3
	bne.b	L351
L350
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L356
L351
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L356
L352
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d3,d0
	bls.b	L354
L353
	move.l	d3,$92(a6)
L354
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d3
	move.l	d3,$18(a6)
	clr.l	$92(a6)
L355
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L356
	and.l	#$FF,d0
; t |= v&0xF0;
	move.l	d0,d1
	and.l	#$F0,d1
	or.w	d1,d4
;	a += v*alphaGen.Green();
	lea	$10(a5),a0
	moveq	#0,d1
	move.b	2(a0),d1
	mulu.l	d1,d0
	add.l	d0,d2
;			v = (uint8)file.GetChar();
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L364
L357
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d3
	cmp.l	#0,d3
	bgt.b	L361
L358
	tst.l	d3
	bne.b	L360
L359
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L365
L360
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L365
L361
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d3,d0
	bls.b	L363
L362
	move.l	d3,$92(a6)
L363
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d3
	move.l	d3,$18(a6)
	clr.l	$92(a6)
L364
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L365
	and.l	#$FF,d0
; t |= (v>>4);
	move.l	d0,d1
	moveq	#4,d3
	lsr.l	d3,d1
	or.w	d1,d4
;	a += v*alphaGen.Blue();
	lea	$10(a5),a0
	moveq	#0,d1
	move.b	3(a0),d1
	mulu.l	d1,d0
	add.l	d0,d2
;			a = (a*alphaGen.Alpha())/dvz;
	moveq	#0,d0
	move.b	$10(a5),d0
	mulu.l	d0,d2
	divul.l	d6,d2
;			*(dest++) = a<<12 | t;
	moveq	#$C,d0
	asl.l	d0,d2
	moveq	#0,d0
	move.w	d4,d0
	or.l	d0,d2
	move.w	d2,d0
	move.w	d0,(a2)+
L366
	subq.l	#1,d5
	tst.l	d5
	bne	L338
L367
;	file.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
;	t->Bind();
	move.l	a3,-(a7)
	jsr	Bind__xTEXSURF__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#1,d0
	movem.l	(a7)+,d2-d6/a2/a3/a6
	unlk	a5
	rts

	SECTION "LoadPPMAlphaPGMWide__xTEXSURF_LOADER__P08xTEXSURFPCcPCc:0",CODE


;bool xTEXSURF_LOADER::LoadPPMAlphaPGMWide(xTEXSURF* t, const char* p
	XDEF	LoadPPMAlphaPGMWide__xTEXSURF_LOADER__P08xTEXSURFPCcPCc
LoadPPMAlphaPGMWide__xTEXSURF_LOADER__P08xTEXSURFPCcPCc
L424	EQU	-$C0
	link	a5,#L424
	movem.l	d2-d4/a2/a3/a6,-(a7)
	move.l	$C(a5),a1
	move.l	$8(a5),a3
L369
;	if (!t || !ppmName || t->Data())
	cmp.w	#0,a3
	beq.b	L372
L370
	cmp.w	#0,a1
	beq.b	L372
L371
	tst.l	$16(a3)
	beq.b	L373
L372
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts
L373
;	xFILEIO file(ppmName, xFILEIO::READ);
	lea	-$9A(a5),a0
	clr.l	(a0)
	clr.l	$96(a0)
	pea	$400.w
	pea	1.w
	move.l	a1,-(a7)
	move.l	a0,-(a7)
	jsr	Open__xFILEIO__TPCcjj
	add.w	#$10,a7
;	sint32 w=0
	clr.l	-$9E(a5)
;	sint32 w=0, h=0
	clr.l	-$A2(a5)
;	sint32 w=0, h=0, aw=0
	clr.l	-$A6(a5)
;	sint32 w=0, h=0, aw=0, ah=0;
	clr.l	-$AA(a5)
;	if (ValidatePPM(&file, &w, &h)==false || t->Create(w, h, xTEXSURF:
	pea	-$A2(a5)
	pea	-$9E(a5)
	pea	-$9A(a5)
	jsr	ValidatePPM__xTEXSURF_LOADER__P07xFILEIOPjPj
	add.w	#$C,a7
	tst.w	d0
	beq.b	L375
L374
	clr.l	-(a7)
	pea	5.w
	move.w	-$A0(a5),-(a7)
	move.w	-$9C(a5),-(a7)
	move.l	a3,-(a7)
	jsr	Create__xTEXSURF__TssEP06ARGB32
	add.w	#$10,a7
	tst.l	d0
	beq.b	L376
L375
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts
L376
;		rsint32 n = (w*h)+1;
	move.l	-$9E(a5),d4
	muls.l	-$A2(a5),d4
	addq.l	#1,d4
;		ruint32* dest = (uint32*)t->Data();
	move.l	$16(a3),a2
;		while (--n)
	bra	L405
L377
;			ruint32 t = ((uint8)file.GetChar())<<16;
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L385
L378
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L382
L379
	tst.l	d2
	bne.b	L381
L380
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L386
L381
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L386
L382
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L384
L383
	move.l	d2,$92(a6)
L384
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L385
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L386
	moveq	#0,d3
	move.b	d0,d3
	moveq	#$10,d0
	asl.l	d0,d3
;			t |= ((uint8)file.GetChar())<<8;
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L394
L387
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L391
L388
	tst.l	d2
	bne.b	L390
L389
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L395
L390
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L395
L391
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L393
L392
	move.l	d2,$92(a6)
L393
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L394
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L395
	and.l	#$FF,d0
	moveq	#$8,d1
	asl.l	d1,d0
	or.l	d0,d3
;			t |= ((uint8)file.GetChar());
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L403
L396
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L400
L397
	tst.l	d2
	bne.b	L399
L398
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L404
L399
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L404
L400
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L402
L401
	move.l	d2,$92(a6)
L402
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L403
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L404
	and.l	#$FF,d0
	or.l	d0,d3
;			*(dest++) = t;
	move.l	d3,(a2)+
L405
	subq.l	#1,d4
	tst.l	d4
	bne	L377
L406
;	file.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
;	file.Open(pgmName, xFILEIO::READ);
	pea	$400.w
	pea	1.w
	move.l	$10(a5),-(a7)
	pea	-$9A(a5)
	jsr	Open__xFILEIO__TPCcjj
	add.w	#$10,a7
;	if (ValidatePGM(&file, &aw, &ah)==false)
	pea	-$AA(a5)
	pea	-$A6(a5)
	pea	-$9A(a5)
	jsr	ValidatePGM__xTEXSURF_LOADER__P07xFILEIOPjPj
	add.w	#$C,a7
	tst.w	d0
	bne.b	L408
L407
;		t->Delete();
	move.l	a3,-(a7)
	jsr	Delete__xTEXSURF__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts
L408
;	else if (aw!=w || ah!=h)
	move.l	-$A6(a5),d0
	cmp.l	-$9E(a5),d0
	bne.b	L410
L409
	move.l	-$AA(a5),d0
	cmp.l	-$A2(a5),d0
	beq.b	L411
L410
;		t->Delete();
	move.l	a3,-(a7)
	jsr	Delete__xTEXSURF__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts
L411
;		rsint32 n = 1+(w*h);
	move.l	-$9E(a5),d0
	muls.l	-$A2(a5),d0
	move.l	d0,d3
	addq.l	#1,d3
;		ruint32* dest	= (uint32*)t->Data();
	move.l	$16(a3),a2
;		while (--n)
	bra	L422
L412
;			ruint32 argb = ((uint8)file.GetChar())<<24;
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L420
L413
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L417
L414
	tst.l	d2
	bne.b	L416
L415
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra	L421
L416
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L421
L417
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L419
L418
	move.l	d2,$92(a6)
L419
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L420
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L421
	and.l	#$FF,d0
	moveq	#$18,d1
	asl.l	d1,d0
;			argb |= (*dest & 0x00FFFFFF);
	move.l	a2,a0
	move.l	(a0),d1
	and.l	#$FFFFFF,d1
	or.l	d1,d0
;			*(dest++) = argb ;
	move.l	d0,(a2)+
L422
	subq.l	#1,d3
	tst.l	d3
	bne	L412
L423
;	file.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
;	t->Bind();
	move.l	a3,-(a7)
	jsr	Bind__xTEXSURF__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#1,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts

	SECTION "LoadPPMAlphaPGMNarrow__xTEXSURF_LOADER__P08xTEXSURFPCcPCc:0",CODE


;bool xTEXSURF_LOADER::LoadPPMAlphaPGMNarrow(xTEXSURF* t, const char*
	XDEF	LoadPPMAlphaPGMNarrow__xTEXSURF_LOADER__P08xTEXSURFPCcPCc
LoadPPMAlphaPGMNarrow__xTEXSURF_LOADER__P08xTEXSURFPCcPCc
L480	EQU	-$B8
	link	a5,#L480
	movem.l	d2-d4/a2/a3/a6,-(a7)
	move.l	$C(a5),a1
	move.l	$8(a5),a3
L425
;	if (!t || !ppmName || t->Data())
	cmp.w	#0,a3
	beq.b	L428
L426
	cmp.w	#0,a1
	beq.b	L428
L427
	tst.l	$16(a3)
	beq.b	L429
L428
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts
L429
;	xFILEIO file(ppmName, xFILEIO::READ);
	lea	-$9A(a5),a0
	clr.l	(a0)
	clr.l	$96(a0)
	pea	$400.w
	pea	1.w
	move.l	a1,-(a7)
	move.l	a0,-(a7)
	jsr	Open__xFILEIO__TPCcjj
	add.w	#$10,a7
;	sint32 w=0
	clr.l	-$9E(a5)
;	sint32 w=0, h=0
	clr.l	-$A2(a5)
;	sint32 w=0, h=0, aw=0
	clr.l	-$A6(a5)
;	sint32 w=0, h=0, aw=0, ah=0;
	clr.l	-$AA(a5)
;	if (ValidatePPM(&file, &w, &h)==false || t->Create(w, h, xTEXSURF:
	pea	-$A2(a5)
	pea	-$9E(a5)
	pea	-$9A(a5)
	jsr	ValidatePPM__xTEXSURF_LOADER__P07xFILEIOPjPj
	add.w	#$C,a7
	tst.w	d0
	beq.b	L431
L430
	clr.l	-(a7)
	pea	5.w
	move.w	-$A0(a5),-(a7)
	move.w	-$9C(a5),-(a7)
	move.l	a3,-(a7)
	jsr	Create__xTEXSURF__TssEP06ARGB32
	add.w	#$10,a7
	tst.l	d0
	beq.b	L432
L431
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts
L432
;		rsint32 n = (w*h)+1;
	move.l	-$9E(a5),d4
	muls.l	-$A2(a5),d4
	addq.l	#1,d4
;		ruint16* dest = (uint16*)t->Data();
	move.l	$16(a3),a2
;		while (--n)
	bra	L461
L433
;			ruint16 t = (((uint8)file.GetChar())&0xF0)<<4;
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L441
L434
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L438
L435
	tst.l	d2
	bne.b	L437
L436
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L442
L437
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L442
L438
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L440
L439
	move.l	d2,$92(a6)
L440
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L441
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L442
	and.l	#$FF,d0
	and.l	#$F0,d0
	moveq	#4,d1
	asl.l	d1,d0
	move.w	d0,d3
;			t |= (((uint8)file.GetChar())&0xF0);
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L450
L443
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L447
L444
	tst.l	d2
	bne.b	L446
L445
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L451
L446
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L451
L447
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L449
L448
	move.l	d2,$92(a6)
L449
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L450
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L451
	and.l	#$FF,d0
	and.l	#$F0,d0
	or.w	d0,d3
;			t |= (((uint8)file.GetChar())&0xF0)>>4;
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L459
L452
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L456
L453
	tst.l	d2
	bne.b	L455
L454
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L460
L455
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L460
L456
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L458
L457
	move.l	d2,$92(a6)
L458
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L459
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L460
	and.l	#$FF,d0
	and.l	#$F0,d0
	moveq	#4,d1
	asr.l	d1,d0
	or.w	d0,d3
;			*(dest++) = t;
	move.w	d3,(a2)+
L461
	subq.l	#1,d4
	tst.l	d4
	bne	L433
L462
;	file.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
;	file.Open(pgmName, xFILEIO::READ);
	pea	$400.w
	pea	1.w
	move.l	$10(a5),-(a7)
	pea	-$9A(a5)
	jsr	Open__xFILEIO__TPCcjj
	add.w	#$10,a7
;	if (ValidatePGM(&file, &aw, &ah)==false)
	pea	-$AA(a5)
	pea	-$A6(a5)
	pea	-$9A(a5)
	jsr	ValidatePGM__xTEXSURF_LOADER__P07xFILEIOPjPj
	add.w	#$C,a7
	tst.w	d0
	bne.b	L464
L463
;		t->Delete();
	move.l	a3,-(a7)
	jsr	Delete__xTEXSURF__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts
L464
;	else if (aw!=w || ah!=h)
	move.l	-$A6(a5),d0
	cmp.l	-$9E(a5),d0
	bne.b	L466
L465
	move.l	-$AA(a5),d0
	cmp.l	-$A2(a5),d0
	beq.b	L467
L466
;		t->Delete();
	move.l	a3,-(a7)
	jsr	Delete__xTEXSURF__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts
L467
;		rsint32 n = (w*h)+1;
	move.l	-$9E(a5),d3
	muls.l	-$A2(a5),d3
	addq.l	#1,d3
;		ruint16* dest	= (uint16*)t->Data();
	move.l	$16(a3),a2
;		while (--n)
	bra	L478
L468
;			ruint16 argb = (((uint8)file.GetChar())&0xF0)<<8;
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L476
L469
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L473
L470
	tst.l	d2
	bne.b	L472
L471
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra	L477
L472
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L477
L473
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L475
L474
	move.l	d2,$92(a6)
L475
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L476
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L477
	and.l	#$FF,d0
	and.l	#$F0,d0
	moveq	#$8,d1
	asl.l	d1,d0
	move.w	d0,d1
;			argb |= (*dest & 0x0FFF);
	move.l	a2,a0
	moveq	#0,d0
	move.w	(a0),d0
	and.l	#$FFF,d0
	or.w	d0,d1
;			*(dest++) = argb;
	move.w	d1,(a2)+
L478
	subq.l	#1,d3
	tst.l	d3
	bne	L468
L479
;	file.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
;	t->Bind();
	move.l	a3,-(a7)
	jsr	Bind__xTEXSURF__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#1,d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts

	END
