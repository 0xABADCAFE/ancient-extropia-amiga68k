
; Storm C Compiler
; extropialib:lib/Platforms/Amiga68k/GraphicsLib/TextureSurface.cpp
	mc68030
	mc68881
	XREF	_0dt__DRAWLIST__T
	XREF	Disable__DRAWLIST__TE
	XREF	Enable__DRAWLIST__TE
	XREF	AlphaCompareMode__DRAWLIST__TEf
	XREF	Tris__DRAWLIST__Tj
	XREF	GetVertices__DRAWLIST__Tjs
	XREF	SetTexture__DRAWLIST__TP08xTEXSURF
	XREF	SetColour__DRAWLIST__TUj
	XREF	_0ct__XSFOBJ__TPCcUsUsUcUc
	XREF	_0ct__XSFOBJ__T
	XREF	Set__XSFHEAD__TPCcUcUcUcUc
	XREF	op__equal__XSFHEAD__TR05XSFIO
	XREF	op__equal__XSFHEAD__TR07XSFHEAD
	XREF	op__notEqual__XSFHEAD__TR07XSFHEAD
	XREF	Value__XDATAID__TPCc
	XREF	Refresh__xDBSCREEN__T
	XREF	Close__xDBSCREEN__T
	XREF	Open__xDBSCREEN__T
	XREF	Close__xSCREEN__T
	XREF	Open__xSCREEN__T
	XREF	Set__xSCREEN__TP06xDMODEPCc
	XREF	Close__xDBWIN__T
	XREF	Open__xDBWIN__T
	XREF	Set__xDBWIN__TsssssPCc
	XREF	MoveEvent__xDISPLAYIO__T
	XREF	ResizeEvent__xDISPLAYIO__T
	XREF	Idle__xDISPLAYIO__T
	XREF	HandleEvent__xDISPLAYIO__T
	XREF	ApplyInputModification__xDISPLAYIO__T
	XREF	ViewSurface__xDISPLAY__T
	XREF	DrawSurface__xDISPLAY__T
	XREF	Refresh__xDISPLAY__T
	XREF	Close__xDISPLAY__T
	XREF	Open__xDISPLAY__T
	XREF	_0dt__LOCK__T
	XREF	_0dt__THREAD__T
	XREF	Run__THREAD__T
	XREF	_0dt__DELAY__T
	XREF	_0ct__DELAY__T
	XREF	Pause__DELAY__TUj
	XREF	Pause__DELAY__TUjUj
	XREF	Abort__DELAY__T
	XREF	UnLink__xCHAINABLE__T
	XREF	Close__xFILEIO__T
	XREF	Flush__xFILEIO__T
	XREF	Write64Swap__xFILEIO__TPvUi
	XREF	Write32Swap__xFILEIO__TPvUi
	XREF	Write16Swap__xFILEIO__TPvUi
	XREF	Write__xFILEIO__TPvUiUi
	XREF	ReadText__xFILEIO__TPcjcj
	XREF	Read64Swap__xFILEIO__TPvUi
	XREF	Read32Swap__xFILEIO__TPvUi
	XREF	Read16Swap__xFILEIO__TPvUi
	XREF	Read__xFILEIO__TPvUiUi
	XREF	Tell__xFILEIO__T
	XREF	Seek__xFILEIO__Tjj
	XREF	Open__xFILEIO__TPCcjj
	XREF	SendPacket__xFILEIO__TPv
	XREF	WaitPacket__xFILEIO__T
	XREF	InputQueued__xINPUT__T
	XREF	Idle__xINPUT__T
	XREF	ExitEvent__xINPUT__T
	XREF	MouseEvent__xINPUT__Tjjj
	XREF	ApplyInputModification__xINPUT__T
	XREF	_0dt__xKEY__T
	XREF	_0ct__xKEY__T
	XREF	KeyEvent__xKEY__Tjsj
	XREF	_0dt__xSURFACE__T
	XREF	_0dt__POOL_ST__T
	XREF	_0ct__POOL_ST__TUsUj
	XREF	FreeT__POOL_ST__TPv
	XREF	NewT__POOL_ST__TPvUs
	XREF	NewT__POOL_ST__TPv
	XREF	Create__POOL_ST__TUsUj
	XREF	_0dt__POOL_LT__T
	XREF	DrawSurface__x3D__P08xSURFACE
	XREF	v3DrawLineStrip__x3D__jj
	XREF	v3DrawLines__x3D__jj
	XREF	_W3D_DrawArray
	XREF	_W3D_BindTexture
	XREF	Free__MEM__Pv
	XREF	Alloc__MEM__UisE
	XREF	_strlen
	XREF	_system
	XREF	_sscanf
	XREF	_vsprintf
	XREF	_std__in
	XREF	_std__out
	XREF	_std__err
	XREF	_st
	XREF	_gxSt
	XREF	_numStartArgs__xBASELIB
	XREF	_startArgs__xBASELIB
	XREF	_SysBase
	XREF	_IntuitionBase
	XREF	_TimerBase
	XREF	_DOSBase
	XREF	_PowerPCBase
	XREF	_sysData__sysBASELIB
	XREF	_msgbuff__sysBASELIB
	XREF	_main__sysBASELIB
	XREF	_allocated__MEM
	XREF	_totSize__MEM
	XREF	_nextFree__MEM
	XREF	_cnt__MEM
	XREF	_maxAllocs__MEM
	XREF	_fpuPrecision__CPU
	XREF	_cpuNames__CPU
	XREF	_GfxBase
	XREF	_CyberGfxBase
	XREF	_surfaceTypes__x2D
	XREF	_Warp3DBase
	XREF	_hw3D__sys3DDEVICE
	XREF	_context__sys3DDEVICE
	XREF	_drawRegion__x3D
	XREF	_fogData__x3D
	XREF	_flags__x3D
	XREF	_vertices__x3D
	XREF	_currTex__x3D
	XREF	_drawSurface__x3D
	XREF	_currCol__x3D
	XREF	_useV4__x3D
	XREF	_flags__xGFX
	XREF	_mode__xGFX
	XREF	_numModes__xGFX
	XREF	_rPool__xSURFACE
	XREF	_KeymapBase
	XREF	_useCount__xKEY
	XREF	_TimerBase__MILLICLOCK
	XREF	_current__MILLICLOCK
	XREF	_clockFreq__MILLICLOCK
	XREF	_threadCnt__THREAD
	XREF	_threadsIdle__THREAD
	XREF	_rootThread__THREAD
	XREF	_sigXSF__XSFHEAD
	XREF	_fileMarker__XSFOBJ
	XREF	_DiskfontBase
	XREF	_flags__DRAW
	XREF	_stack__VGPU
	XREF	_stackPos__VGPU
	XREF	_vertexBase__VGPU
	XREF	_vertexTop__VGPU
	XREF	_dataPos__VGPU
	XREF	_instPos__VGPU
	XREF	_exe_flags__VGPU
	XREF	_exe_stateReg__VGPU
	XREF	_exe_colourReg__VGPU
	XREF	_exe_texReg__VGPU
	XREF	_exe_fogReg__VGPU
	XREF	_exe_errReg__VGPU
	XREF	_funcTab__VGPU
	XREF	_qTrigTab__DRAWLIST

	SECTION "Round16__r23d:0",CODE

	rts

	SECTION "Bind__xTEXSURF__T:0",CODE


;bool xTEXSURF::Bind()
	XDEF	Bind__xTEXSURF__T
Bind__xTEXSURF__T
L221	EQU	-$34
	link	a5,#L221
	movem.l	a2/a3/a6,-(a7)
	move.l	$8(a5),a3
L196
;	if (!context || !data)
	tst.l	_context__sys3DDEVICE
	beq.b	L198
L197
	move.l	a3,a1
	tst.l	$16(a1)
	bne.b	L199
L198
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,a2/a3/a6
	unlk	a5
	rts
L199
;	if (tex)
	move.l	a3,a1
	tst.l	$12(a1)
	beq.b	L201
L200
;		return true;
	moveq	#1,d0
	movem.l	(a7)+,a2/a3/a6
	unlk	a5
	rts
L201
;	uint32 result = 0;
	clr.l	-4(a5)
;	if (pal && (format == TXL_LUT_8))
	move.l	a3,a1
	tst.l	$1A(a1)
	beq	L212
L202
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L204
L203
	addq.w	#4,a0
L204
	tst.w	6(a0)
	bne	L212
L205
;		TagItem tTags[] = {
	lea	-$34(a5),a0
	move.l	#$80201000,(a0)+
	move.l	a3,a2
	move.l	$16(a2),(a0)+
	move.l	#$80201001,(a0)+
	move.l	#1,(a0)+
	move.l	#$80201002,(a0)+
	move.l	a3,a1
	cmp.w	#0,a1
	beq.b	L207
L206
	addq.w	#4,a1
L207
	move.w	(a1),d0
	ext.l	d0
	move.l	d0,(a0)+
	move.l	#$80201003,(a0)+
	move.l	a3,a1
	cmp.w	#0,a1
	beq.b	L209
L208
	addq.w	#4,a1
L209
	move.w	2(a1),d0
	ext.l	d0
	move.l	d0,(a0)+
	move.l	#$80201005,(a0)+
	move.l	a3,a2
	move.l	$1A(a2),(a0)+
	clr.l	(a0)+
	clr.l	(a0)
;		if (!(tex = W3D_AllocTexObj(context, &result, tTags)))
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	lea	-4(a5),a1
	lea	-$34(a5),a2
	jsr	-$60(a6)
	move.l	a3,a1
	move.l	d0,$12(a1)
	bne.b	L211
L210
;			return false;
	moveq	#0,d0
	movem.l	(a7)+,a2/a3/a6
	unlk	a5
	rts
L211
	bra	L220
L212
;		TagItem tTags[] = {
	lea	-$2C(a5),a0
	move.l	#$80201000,(a0)+
	move.l	a3,a2
	move.l	$16(a2),(a0)+
	move.l	#$80201001,(a0)+
	move.l	a3,a1
	cmp.w	#0,a1
	beq.b	L214
L213
	addq.w	#4,a1
L214
	move.w	6(a1),d0
	ext.l	d0
	addq.l	#1,d0
	move.l	d0,(a0)+
	move.l	#$80201002,(a0)+
	move.l	a3,a1
	cmp.w	#0,a1
	beq.b	L216
L215
	addq.w	#4,a1
L216
	move.w	(a1),d0
	ext.l	d0
	move.l	d0,(a0)+
	move.l	#$80201003,(a0)+
	move.l	a3,a1
	cmp.w	#0,a1
	beq.b	L218
L217
	addq.w	#4,a1
L218
	move.w	2(a1),d0
	ext.l	d0
	move.l	d0,(a0)+
	clr.l	(a0)+
	clr.l	(a0)
;		if (!(tex = W3D_AllocTexObj(context, &result, tTags)))
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	lea	-4(a5),a1
	lea	-$2C(a5),a2
	jsr	-$60(a6)
	move.l	a3,a1
	move.l	d0,$12(a1)
	bne.b	L220
L219
;			return false;
	moveq	#0,d0
	movem.l	(a7)+,a2/a3/a6
	unlk	a5
	rts
L220
;	return true;
	moveq	#1,d0
	movem.l	(a7)+,a2/a3/a6
	unlk	a5
	rts

	SECTION "UnBind__xTEXSURF__T:0",CODE


;void xTEXSURF::UnBind()
	XDEF	UnBind__xTEXSURF__T
UnBind__xTEXSURF__T
	movem.l	a2/a6,-(a7)
	move.l	$C(a7),a2
L222
;	if (!context || !tex)
	tst.l	_context__sys3DDEVICE
	beq.b	L224
L223
	move.l	a2,a1
	tst.l	$12(a1)
	bne.b	L225
L224
;		return;
	movem.l	(a7)+,a2/a6
	rts
L225
;	W3D_FreeTexObj(context, tex);
	move.l	a2,a0
	move.l	$12(a0),a1
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	jsr	-$66(a6)
;	tex	= 0;
	move.l	a2,a1
	clr.l	$12(a1)
	movem.l	(a7)+,a2/a6
	rts

	SECTION "Create__xTEXSURF__TssEP06ARGB32:0",CODE


;sint32 xTEXSURF::Create(S_WH, xTEXSURF::TEXELTYPE fmt, ARGB32* extPa
	XDEF	Create__xTEXSURF__TssEP06ARGB32
Create__xTEXSURF__TssEP06ARGB32
	movem.l	d2-d6/a2/a3,-(a7)
	movem.l	$28(a7),d6/a3
	move.w	$26(a7),d0
	move.w	$24(a7),d1
	move.l	$20(a7),a2
L226
;	if (tex || data)
	tst.l	$12(a2)
	bne.b	L228
L227
	tst.l	$16(a2)
	beq.b	L229
L228
;		return ERR_RSC_LOCKED;
	move.l	#-$3050004,d0
	movem.l	(a7)+,d2-d6/a2/a3
	rts
L229
;	switch (fmt)
	move.l	d6,d2
	cmp.l	#$A,d2
	bhi.b	L234
	move.l	L274(pc,d2.l*4),a0
	jmp	(a0)
L274
	dc.l	L230
	dc.l	L231
	dc.l	L231
	dc.l	L232
	dc.l	L231
	dc.l	L233
	dc.l	L230
	dc.l	L230
	dc.l	L231
	dc.l	L230
	dc.l	L233
;		
L230
;		case TXL_INTSY_8:		bytesPerTexel = 1;
	moveq	#1,d5
; 
	bra.b	L234
L231
;		case TXL_GA_88:			bytesPerTexel = 2;
	moveq	#2,d5
; 
	bra.b	L234
L232
;		case TXL_RGB_888:		bytesPerTexel = 3;
	moveq	#3,d5
; 
	bra.b	L234
L233
;		case TXL_RGBA_8888: bytesPerTexel = 4;
	moveq	#4,d5
; 
L234
;	w = Clamp(w, 2, 1024);
	move.l	#$400,d2
	moveq	#2,d3
	move.w	d1,d4
	ext.l	d4
	cmp.l	d3,d4
	bge.b	L236
L235
	move.l	d3,d2
	bra.b	L240
L236
	move.w	d1,d3
	ext.l	d3
	cmp.l	d2,d3
	ble.b	L238
L237
	bra.b	L239
L238
	move.w	d1,d2
	ext.l	d2
L239
L240
	move.w	d2,d1
;	h = Clamp(h, 2, 1024);
	move.l	#$400,d2
	moveq	#2,d3
	move.w	d0,d4
	ext.l	d4
	cmp.l	d3,d4
	bge.b	L242
L241
	move.l	d3,d2
	bra.b	L246
L242
	move.w	d0,d3
	ext.l	d3
	cmp.l	d2,d3
	ble.b	L244
L243
	bra.b	L245
L244
	move.w	d0,d2
	ext.l	d2
L245
L246
	move.w	d2,d0
;	sint16 newWidth = 2;
	moveq	#2,d3
;	sint16 newHeight = 2;
	moveq	#2,d2
;	while (newWidth < w)	
	bra.b	L248
L247
;	while (newWidth < w)	newWidth<<=1;
	moveq	#1,d4
	asl.w	d4,d3
L248
	cmp.w	d1,d3
	blt.b	L247
L249
;	while (newHeight < h)	
	bra.b	L251
L250
;	while (newHeight < h)	newHeight<<=1;
	moveq	#1,d1
	asl.w	d1,d2
L251
	cmp.w	d0,d2
	blt.b	L250
L252
;	size_t space = newWidth*newHeight*bytesPerTexel;
	move.w	d3,d4
	muls	d2,d4
	mulu.l	d5,d4
;	if (fmt==TXL_LUT_8)
	tst.l	d6
	bne.b	L260
L253
;		if (extPal)
	cmp.w	#0,a3
	beq.b	L257
L254
;			if (data = MEM::Alloc(space, false))
	clr.l	-(a7)
	clr.w	-(a7)
	move.l	d4,-(a7)
	jsr	Alloc__MEM__UisE
	add.w	#$A,a7
	move.l	d0,$16(a2)
	beq.b	L256
L255
;				pal = extPal;
	move.l	a3,$1A(a2)
;				goto 
	bra.b	L263
L256
;				return ERR_NO_FREE_STORE;
	move.l	#-$3030001,d0
	movem.l	(a7)+,d2-d6/a2/a3
	rts
L257
;			if (data = MEM::Alloc(space+256*sizeof(ARGB32), false))
	clr.l	-(a7)
	clr.w	-(a7)
	move.l	d4,d0
	add.l	#$400,d0
	move.l	d0,-(a7)
	jsr	Alloc__MEM__UisE
	add.w	#$A,a7
	move.l	d0,$16(a2)
	beq.b	L259
L258
;				pal = (ARGB32*)(((uint8*)data)+space);
	move.l	$16(a2),a0
	lea	0(a0,d4.l),a0
	move.l	a0,$1A(a2)
;				goto 
	bra.b	L263
L259
;				return ERR_NO_FREE_STORE;
	move.l	#-$3030001,d0
	movem.l	(a7)+,d2-d6/a2/a3
	rts
L260
;		if (data = MEM::Alloc(space, false))
	clr.l	-(a7)
	clr.w	-(a7)
	move.l	d4,-(a7)
	jsr	Alloc__MEM__UisE
	add.w	#$A,a7
	move.l	d0,$16(a2)
	beq.b	L262
L261
;			pal = 0;
	clr.l	$1A(a2)
;			goto 
	bra.b	L263
L262
;			return ERR_NO_FREE_STORE;
	move.l	#-$3030001,d0
	movem.l	(a7)+,d2-d6/a2/a3
	rts
L263
;	RawSize((4*sizeof(uint16))+space);
	move.l	d4,d0
	addq.l	#$8,d0
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L265
L264
	move.l	(a0),a0
L265
	move.l	d0,$C(a0)
;	width		= newWidth;
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L267
L266
	addq.w	#4,a0
L267
	move.w	d3,(a0)
;	height	= newHeight;
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L269
L268
	addq.w	#4,a0
L269
	move.w	d2,2(a0)
;	depth		= bytesPerTexel*8;
	moveq	#3,d0
	asl.l	d0,d5
	move.w	d5,d0
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L271
L270
	addq.w	#4,a0
L271
	move.w	d0,4(a0)
;	format	= fmt;
	move.w	d6,d0
	cmp.w	#0,a2
	beq.b	L273
L272
	addq.w	#4,a2
L273
	move.w	d0,6(a2)
;	return OK;
	moveq	#0,d0
	movem.l	(a7)+,d2-d6/a2/a3
	rts

	SECTION "Delete__xTEXSURF__T:0",CODE


;void xTEXSURF::Delete()
	XDEF	Delete__xTEXSURF__T
Delete__xTEXSURF__T
	move.l	a2,-(a7)
	move.l	$8(a7),a2
L275
;	UnBind();
	move.l	a2,-(a7)
	jsr	UnBind__xTEXSURF__T
	addq.w	#4,a7
;	if (data)
	tst.l	$16(a2)
	beq.b	L277
L276
;		MEM::Free(data);
	move.l	$16(a2),-(a7)
	jsr	Free__MEM__Pv
	addq.w	#4,a7
L277
;	data = 0;
	clr.l	$16(a2)
;	pal = 0;
	clr.l	$1A(a2)
;	width = 0;
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L279
L278
	addq.w	#4,a0
L279
	clr.w	(a0)
;	height = 0;
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L281
L280
	addq.w	#4,a0
L281
	clr.w	2(a0)
;	format = 0;
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L283
L282
	addq.w	#4,a0
L283
	clr.w	6(a0)
;	RawSize(4*sizeof(uint16));
	moveq	#$8,d0
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L285
L284
	move.l	(a0),a0
L285
	move.l	d0,$C(a0)
	move.l	(a7)+,a2
	rts

	SECTION "ReadyForWrite__xTEXSURF__T:0",CODE


;sint32 xTEXSURF::ReadyForWrite()
	XDEF	ReadyForWrite__xTEXSURF__T
ReadyForWrite__xTEXSURF__T
	move.l	4(a7),a0
L286
;	if (data)
	tst.l	$16(a0)
	beq.b	L288
L287
;		return OK;
	moveq	#0,d0
	rts
L288
;	return ERR_PTR_ZERO;
	move.l	#-$3020002,d0
	rts

	SECTION "ReadyForRead__xTEXSURF__T:0",CODE


;sint32 xTEXSURF::ReadyForRead()
	XDEF	ReadyForRead__xTEXSURF__T
ReadyForRead__xTEXSURF__T
	move.l	4(a7),a0
L289
;	if (data)
	tst.l	$16(a0)
	beq.b	L291
L290
;		return ERR_RSC_LOCKED;
	move.l	#-$3050004,d0
	rts
L291
;	return OK;
	moveq	#0,d0
	rts

	SECTION "WriteBody__xTEXSURF__TR05XSFIO:0",CODE


;sint32 xTEXSURF::WriteBody(XSFIO& f)
	XDEF	WriteBody__xTEXSURF__TR05XSFIO
WriteBody__xTEXSURF__TR05XSFIO
	movem.l	d2/a2/a3,-(a7)
	move.l	$14(a7),a2
	move.l	$10(a7),a3
L292
;	if (f.Write16(&width, 4)!=4)
	pea	4.w
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L294
L293
	addq.w	#4,a0
L294
	move.l	a0,-(a7)
	move.l	(a2),a0
	move.l	a2,d0
	add.l	$64(a0),d0
	move.l	d0,-(a7)
	move.l	$60(a0),a0
	jsr	(a0)
	add.w	#$C,a7
	cmp.l	#4,d0
	beq.b	L296
L295
;		return ERR_FILE_WRITE;
	move.l	#-$3040005,d0
	movem.l	(a7)+,d2/a2/a3
	rts
L296
;	size_t numElements = width*height;
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L298
L297
	addq.w	#4,a0
L298
	move.w	(a0),d1
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L300
L299
	addq.w	#4,a0
L300
	move.w	d1,d2
	muls	2(a0),d2
;	switch (format)
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L302
L301
	addq.w	#4,a0
L302
	move.w	6(a0),d0
	cmp.w	#$A,d0
	bhi	L319
	move.l	L322(pc,d0.w*4),a0
	jmp	(a0)
L322
	dc.l	L303
	dc.l	L310
	dc.l	L310
	dc.l	L313
	dc.l	L310
	dc.l	L316
	dc.l	L303
	dc.l	L303
	dc.l	L310
	dc.l	L303
	dc.l	L316
;		
L303
;			if (f.Write8(data, numElements)!=numElements)
	move.l	d2,-(a7)
	move.l	a3,a1
	move.l	$16(a1),-(a7)
	move.l	(a2),a0
	move.l	a2,d0
	add.l	$6C(a0),d0
	move.l	d0,-(a7)
	move.l	$68(a0),a0
	jsr	(a0)
	add.w	#$C,a7
	cmp.l	d2,d0
	beq.b	L305
L304
;				return ERR_FILE_WRITE;
	move.l	#-$3040005,d0
	movem.l	(a7)+,d2/a2/a3
	rts
L305
;			if ((flags & OWNPALETTE) && pal!=0)
	move.l	a3,a0
	move.l	$1E(a0),d0
	and.l	#1,d0
	beq.b	L309
L306
	move.l	a3,a1
	move.l	$1A(a1),a0
	cmp.w	#0,a0
	beq.b	L309
L307
;				if (f.Write32(pal, 256)!=256)
	pea	$100.w
	move.l	a3,a1
	move.l	$1A(a1),-(a7)
	move.l	(a2),a0
	move.l	a2,d0
	add.l	$5C(a0),d0
	move.l	d0,-(a7)
	move.l	$58(a0),a0
	jsr	(a0)
	add.w	#$C,a7
	cmp.l	#$100,d0
	beq.b	L309
L308
;					return ERR_FILE_WRITE;
	move.l	#-$3040005,d0
	movem.l	(a7)+,d2/a2/a3
	rts
L309
;			
	bra	L319
L310
;			if (f.Write16(data, numElements)!=numElements)
	move.l	d2,-(a7)
	move.l	a3,a1
	move.l	$16(a1),-(a7)
	move.l	(a2),a0
	move.l	a2,d0
	add.l	$64(a0),d0
	move.l	d0,-(a7)
	move.l	$60(a0),a0
	jsr	(a0)
	add.w	#$C,a7
	cmp.l	d2,d0
	beq.b	L312
L311
;				return ERR_FILE_WRITE;
	move.l	#-$3040005,d0
	movem.l	(a7)+,d2/a2/a3
	rts
L312
;			
	bra.b	L319
L313
;			if (f.Write8(data, numElements*3)!=numElements*3)
	move.l	d2,d0
	mulu.l	#3,d0
	move.l	d0,-(a7)
	move.l	a3,a1
	move.l	$16(a1),-(a7)
	move.l	(a2),a0
	move.l	a2,d0
	add.l	$6C(a0),d0
	move.l	d0,-(a7)
	move.l	$68(a0),a0
	jsr	(a0)
	add.w	#$C,a7
	mulu.l	#3,d2
	cmp.l	d2,d0
	beq.b	L315
L314
;				return ERR_FILE_WRITE;
	move.l	#-$3040005,d0
	movem.l	(a7)+,d2/a2/a3
	rts
L315
;			
	bra.b	L319
L316
;			if (f.Write32(data, numElements)!=numElements)
	move.l	d2,-(a7)
	move.l	a3,a1
	move.l	$16(a1),-(a7)
	move.l	(a2),a0
	move.l	a2,d0
	add.l	$5C(a0),d0
	move.l	d0,-(a7)
	move.l	$58(a0),a0
	jsr	(a0)
	add.w	#$C,a7
	cmp.l	d2,d0
	beq.b	L318
L317
;				return ERR_FILE_WRITE;
	move.l	#-$3040005,d0
	movem.l	(a7)+,d2/a2/a3
	rts
L318
;			
L319
;	return RawSize();
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L321
L320
	move.l	(a0),a0
L321
	move.l	$C(a0),d0
	movem.l	(a7)+,d2/a2/a3
	rts

	SECTION "ReadBody__xTEXSURF__TR05XSFIO:0",CODE


;sint32 xTEXSURF::ReadBody(XSFIO& f)
	XDEF	ReadBody__xTEXSURF__TR05XSFIO
ReadBody__xTEXSURF__TR05XSFIO
	movem.l	d2/d3/a2/a3,-(a7)
	move.l	$18(a7),a2
	move.l	$14(a7),a3
L323
;	if (f.Read16(&width, 4)!=4)
	pea	4.w
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L325
L324
	addq.w	#4,a0
L325
	move.l	a0,-(a7)
	move.l	(a2),a0
	move.l	a2,d0
	add.l	$84(a0),d0
	move.l	d0,-(a7)
	move.l	$80(a0),a0
	jsr	(a0)
	add.w	#$C,a7
	cmp.l	#4,d0
	beq.b	L327
L326
;		return ERR_FILE_WRITE;
	move.l	#-$3040005,d0
	movem.l	(a7)+,d2/d3/a2/a3
	rts
L327
;	size_t numElements = width*height;
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L329
L328
	addq.w	#4,a0
L329
	move.w	(a0),d1
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L331
L330
	addq.w	#4,a0
L331
	move.w	d1,d2
	muls	2(a0),d2
;	size_t dataSize = RawSize()-(4*sizeof(uint16));
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L333
L332
	move.l	(a0),a0
L333
	move.l	$C(a0),d3
	subq.l	#$8,d3
;	data = MEM::Alloc(dataSize, false);
	clr.l	-(a7)
	clr.w	-(a7)
	move.l	d3,-(a7)
	jsr	Alloc__MEM__UisE
	add.w	#$A,a7
	move.l	a3,a1
	move.l	d0,$16(a1)
;	if (!data)
	move.l	a3,a1
	tst.l	$16(a1)
	bne.b	L335
L334
;		return ERR_NO_FREE_STORE;
	move.l	#-$3030001,d0
	movem.l	(a7)+,d2/d3/a2/a3
	rts
L335
;	switch (format)
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L337
L336
	addq.w	#4,a0
L337
	move.w	6(a0),d0
	cmp.w	#$A,d0
	bhi	L355
	move.l	L360(pc,d0.w*4),a0
	jmp	(a0)
L360
	dc.l	L338
	dc.l	L346
	dc.l	L346
	dc.l	L349
	dc.l	L346
	dc.l	L352
	dc.l	L340
	dc.l	L340
	dc.l	L346
	dc.l	L340
	dc.l	L352
;		
L338
;				if ((dataSize - numElements)==256*sizeof(ARGB32))
	sub.l	d2,d3
	cmp.l	#$400,d3
	bne.b	L340
L339
;					pal = (ARGB32*)(((uint8*)data)+numElements);
	move.l	a3,a1
	move.l	$16(a1),a0
	lea	0(a0,d2.l),a0
	move.l	a3,a1
	move.l	a0,$1A(a1)
;					flags |= OWNPALETTE;
	move.l	a3,a0
	move.l	$1E(a0),d0
	or.l	#1,d0
	move.l	a3,a0
	move.l	d0,$1E(a0)
L340
;			if (f.Read8(data, numElements)!=numElements)
	move.l	d2,-(a7)
	move.l	a3,a1
	move.l	$16(a1),-(a7)
	move.l	(a2),a0
	move.l	a2,d0
	add.l	$8C(a0),d0
	move.l	d0,-(a7)
	move.l	$88(a0),a0
	jsr	(a0)
	add.w	#$C,a7
	cmp.l	d2,d0
	beq.b	L342
L341
;				return ERR_FILE_READ;
	move.l	#-$3040004,d0
	movem.l	(a7)+,d2/d3/a2/a3
	rts
L342
;			if (flags & OWNPALETTE)
	move.l	a3,a0
	move.l	$1E(a0),d0
	and.l	#1,d0
	beq.b	L345
L343
;				if (f.Read32(pal, 256)!=256)
	pea	$100.w
	move.l	a3,a1
	move.l	$1A(a1),-(a7)
	move.l	(a2),a0
	move.l	a2,d0
	add.l	$7C(a0),d0
	move.l	d0,-(a7)
	move.l	$78(a0),a0
	jsr	(a0)
	add.w	#$C,a7
	cmp.l	#$100,d0
	beq.b	L345
L344
;					return ERR_FILE_READ;
	move.l	#-$3040004,d0
	movem.l	(a7)+,d2/d3/a2/a3
	rts
L345
;			
	bra	L355
L346
;			if (f.Read16(data, numElements)!=numElements)
	move.l	d2,-(a7)
	move.l	a3,a1
	move.l	$16(a1),-(a7)
	move.l	(a2),a0
	move.l	a2,d0
	add.l	$84(a0),d0
	move.l	d0,-(a7)
	move.l	$80(a0),a0
	jsr	(a0)
	add.w	#$C,a7
	cmp.l	d2,d0
	beq.b	L348
L347
;				return ERR_FILE_READ;
	move.l	#-$3040004,d0
	movem.l	(a7)+,d2/d3/a2/a3
	rts
L348
;			
	bra.b	L355
L349
;			if (f.Read8(data, numElements*3)!=numElements*3)
	move.l	d2,d0
	mulu.l	#3,d0
	move.l	d0,-(a7)
	move.l	a3,a1
	move.l	$16(a1),-(a7)
	move.l	(a2),a0
	move.l	a2,d0
	add.l	$8C(a0),d0
	move.l	d0,-(a7)
	move.l	$88(a0),a0
	jsr	(a0)
	add.w	#$C,a7
	mulu.l	#3,d2
	cmp.l	d2,d0
	beq.b	L351
L350
;				return ERR_FILE_READ;
	move.l	#-$3040004,d0
	movem.l	(a7)+,d2/d3/a2/a3
	rts
L351
;			
	bra.b	L355
L352
;			if (f.Read32(data, numElements)!=numElements)
	move.l	d2,-(a7)
	move.l	a3,a1
	move.l	$16(a1),-(a7)
	move.l	(a2),a0
	move.l	a2,d0
	add.l	$7C(a0),d0
	move.l	d0,-(a7)
	move.l	$78(a0),a0
	jsr	(a0)
	add.w	#$C,a7
	cmp.l	d2,d0
	beq.b	L354
L353
;				return ERR_FILE_READ;
	move.l	#-$3040004,d0
	movem.l	(a7)+,d2/d3/a2/a3
	rts
L354
;			
L355
;	if (context) 
	tst.l	_context__sys3DDEVICE
	beq.b	L357
L356
;	if (context) Bind();
	move.l	a3,-(a7)
	jsr	Bind__xTEXSURF__T
	addq.w	#4,a7
L357
;	return RawSize();
	move.l	a3,a0
	cmp.w	#0,a0
	beq.b	L359
L358
	move.l	(a0),a0
L359
	move.l	$C(a0),d0
	movem.l	(a7)+,d2/d3/a2/a3
	rts

	SECTION "_0ct__xTEXSURF__T:0",CODE


;xTEXSURF::xTEXSURF() 
	XDEF	_0ct__xTEXSURF__T
_0ct__xTEXSURF__T
	movem.l	d2/d3/a2,-(a7)
	move.l	$10(a7),a2
L362
	btst	#0,$10(a2)
	beq.b	L364
L363
	clr.b	-(a7)
	move.b	#1,-(a7)
	move.w	#6,-(a7)
	move.w	#$300,-(a7)
	move.l	#L361,-(a7)
	move.l	(a2),-(a7)
	jsr	_0ct__XSFOBJ__TPCcUsUsUcUc
	add.w	#$10,a7
L364
	lea	4(a2),a0
	clr.w	(a0)
	clr.w	2(a0)
	clr.w	4(a0)
	clr.w	6(a0)
	clr.l	$12(a2)
	clr.l	$16(a2)
	clr.l	$1A(a2)
	clr.l	$1E(a2)
;	RawSize(4*sizeof(sint16));
	moveq	#$8,d0
	move.l	a2,a0
	cmp.w	#0,a0
	beq.b	L366
L365
	move.l	(a0),a0
L366
	move.l	d0,$C(a0)
	movem.l	(a7)+,d2/d3/a2
	rts

L361
	dc.b	'xTEXSURF Image',0

	SECTION "SetFixed__xTEXFONT__Tsssss:0",CODE


;sint32 xTEXFONT::SetFixed(sint16 W, sint16 H, sint16 glW, sint16 glH
	XDEF	SetFixed__xTEXFONT__Tsssss
SetFixed__xTEXFONT__Tsssss
	movem.l	d2-d6,-(a7)
	move.w	$24(a7),d1
	move.w	$1C(a7),d2
	move.w	$22(a7),d3
	move.w	$20(a7),d4
	move.w	$1E(a7),d5
	move.l	$18(a7),a0
L367
;	if (flags & XF_FIXED)
	move.l	$26(a0),d0
	and.l	#1,d0
	beq.b	L369
L368
;		size = H;
	move.w	d5,d0
	ext.l	d0
	move.l	d0,$2A(a0)
;		fixed.glyphW	= glW;
	move.w	d4,$2E(a0)
;		fixed.glyphH	= glH;
	move.w	d3,$30(a0)
;		fixed.printW	= W;
	move.w	d2,$32(a0)
;		fixed.cps			= glSpan;
	move.w	d1,$34(a0)
;		return OK;
	moveq	#0,d0
	movem.l	(a7)+,d2-d6
	rts
L369
;	return ERR_RSC_INVALID;
	move.l	#-$3050008,d0
	movem.l	(a7)+,d2-d6
	rts

	SECTION "LoadFixedPGM__xTEXFONT__TPCc:0",CODE


;sint32 xTEXFONT::LoadFixedPGM(const char* name)
	XDEF	LoadFixedPGM__xTEXFONT__TPCc
LoadFixedPGM__xTEXFONT__TPCc
L399	EQU	-$E8
	link	a5,#L399
	movem.l	d2/d3/a2/a3/a6,-(a7)
	move.l	$C(a5),a1
	move.l	$8(a5),a3
L371
;	if (Data())
	tst.l	$16(a3)
	beq.b	L373
L372
;		return ERR_RSC_LOCKED;
	move.l	#-$3050004,d0
	movem.l	(a7)+,d2/d3/a2/a3/a6
	unlk	a5
	rts
L373
;	xFILEIO pgmFile(name, xFILEIO::READ);
	lea	-$9A(a5),a0
	clr.l	(a0)
	clr.l	$96(a0)
	pea	$400.w
	pea	1.w
	move.l	a1,-(a7)
	move.l	a0,-(a7)
	jsr	Open__xFILEIO__TPCcjj
	add.w	#$10,a7
;	if (pgmFile.Valid()==false)
	move.l	-4(a5),d0
	and.l	#$40,d0
	tst.w	d0
	bne.b	L375
L374
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	move.l	#-$304000B,d0
	movem.l	(a7)+,d2/d3/a2/a3/a6
	unlk	a5
	rts
L375
;	uint32 w=0
	clr.l	-$9E(a5)
;	uint32 w=0, h=0;
	clr.l	-$A2(a5)
;		char fileHead[64] = {0};
	lea	-$E2(a5),a0
	clr.b	(a0)+
	moveq	#$3E,d0
L400
	clr.b	(a0)+
	dbra	d0,L400
;		pgmFile.ReadText(fileHead, 64, '\n', 4);
	pea	4.w
	move.b	#$A,-(a7)
	pea	$40.w
	pea	-$E2(a5)
	pea	-$9A(a5)
	jsr	ReadText__xFILEIO__TPcjcj
	add.w	#$12,a7
;		if (sscanf(fileHead, "P5\n%ld\n%ld\n255\n", &w, &h)!=2)
	pea	-$A2(a5)
	pea	-$9E(a5)
	move.l	#L370,-(a7)
	pea	-$E2(a5)
	jsr	_sscanf
	add.w	#$10,a7
	cmp.l	#2,d0
	beq.b	L377
L376
;			pgmFile.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	move.l	#-$3040004,d0
	movem.l	(a7)+,d2/d3/a2/a3/a6
	unlk	a5
	rts
L377
;		if ( (pgmFile.Size()-pgmFile.Tell())!=(w*h) )
	lea	-$9A(a5),a0
	move.l	$96(a0),d0
	and.l	#5,d0
	beq.b	L379
L378
	move.l	4(a0),d2
	bra.b	L380
L379
	move.l	#-$3040000,d2
L380
	pea	-$9A(a5)
	jsr	Tell__xFILEIO__T
	addq.w	#4,a7
	sub.l	d0,d2
	move.l	-$9E(a5),d0
	mulu.l	-$A2(a5),d0
	cmp.l	d0,d2
	beq.b	L382
L381
;			pgmFile.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	move.l	#-$3040004,d0
	movem.l	(a7)+,d2/d3/a2/a3/a6
	unlk	a5
	rts
L382
;	sint32 r = Create(w, h, TXL_ARGB_4444);
	clr.l	-(a7)
	pea	4.w
	move.w	-$A0(a5),-(a7)
	move.w	-$9C(a5),-(a7)
	move.l	a3,-(a7)
	jsr	Create__xTEXSURF__TssEP06ARGB32
	add.w	#$10,a7
	move.l	d0,d2
;	if (r!=OK)
	beq.b	L384
L383
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	move.l	d2,d0
	movem.l	(a7)+,d2/d3/a2/a3/a6
	unlk	a5
	rts
L384
;		ruint16* dest	= (uint16*)Data();
	move.l	$16(a3),a2
;		rsint32 n = 1+(w*h);
	move.l	-$9E(a5),d0
	mulu.l	-$A2(a5),d0
	move.l	d0,d3
	addq.l	#1,d3
;		while (--n)
	bra	L395
L385
;			*(dest++) = ((pgmFile.GetChar()&0xF0)<<8) | 0x0FFF;
	lea	-$9A(a5),a6
	tst.l	$18(a6)
	bne	L393
L386
	move.l	a6,-(a7)
	jsr	WaitPacket__xFILEIO__T
	addq.w	#4,a7
	move.l	d0,d2
	cmp.l	#0,d2
	bgt.b	L390
L387
	tst.l	d2
	bne.b	L389
L388
	or.l	#$10,$96(a6)
	move.l	_DOSBase,a6
	moveq	#0,d1
	jsr	-$1CE(a6)
	moveq	#-1,d0
	bra.b	L394
L389
	and.l	#-$41,$96(a6)
	move.l	#-$3040004,d0
	bra.b	L394
L390
	moveq	#1,d0
	sub.l	$8E(a6),d0
	lea	$20(a6),a0
	move.l	0(a0,d0.l*4),-(a7)
	move.l	a6,-(a7)
	jsr	SendPacket__xFILEIO__TPv
	addq.w	#$8,a7
	move.l	$92(a6),d0
	cmp.l	d2,d0
	bls.b	L392
L391
	move.l	d2,$92(a6)
L392
	lea	$20(a6),a0
	move.l	$8E(a6),d0
	move.l	0(a0,d0.l*4),d0
	add.l	$92(a6),d0
	move.l	d0,$14(a6)
	moveq	#1,d0
	sub.l	$8E(a6),d0
	move.l	d0,$8E(a6)
	sub.l	$92(a6),d2
	move.l	d2,$18(a6)
	clr.l	$92(a6)
L393
	move.l	$14(a6),a0
	move.b	(a0),d1
	subq.l	#1,$18(a6)
	addq.l	#1,$14(a6)
	move.b	d1,d0
	extb.l	d0
L394
	and.l	#$F0,d0
	moveq	#$8,d1
	asl.l	d1,d0
	or.l	#$FFF,d0
	move.w	d0,(a2)+
L395
	subq.l	#1,d3
	tst.l	d3
	bne	L385
L396
;	pgmFile.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
;	if (Bind())
	move.l	a3,-(a7)
	jsr	Bind__xTEXSURF__T
	addq.w	#4,a7
	tst.w	d0
	beq.b	L398
L397
;		Environment(MODULATE);
	move.l	_context__sys3DDEVICE,a0
	move.l	_Warp3DBase,a6
	moveq	#3,d1
	move.l	$12(a3),a1
	sub.l	a2,a2
	jsr	-$7E(a6)
L398
;	flags = XF_FIXED|XF_MONO;
	move.l	a3,a0
	move.l	#5,$26(a0)
;	size = h/16;
	move.l	-$A2(a5),d0
	moveq	#4,d1
	lsr.l	d1,d0
	move.l	a3,a0
	move.l	d0,$2A(a0)
;	fixed.glyphW = w/16;
	move.l	-$9E(a5),d0
	moveq	#4,d1
	lsr.l	d1,d0
	move.l	a3,a0
	move.w	d0,$2E(a0)
;	fixed.glyphH = h/16;
	move.l	-$A2(a5),d0
	moveq	#4,d1
	lsr.l	d1,d0
	move.l	a3,a0
	move.w	d0,$30(a0)
;	fixed.printW = w/16;
	move.l	-$9E(a5),d0
	moveq	#4,d1
	lsr.l	d1,d0
	move.l	a3,a0
	move.w	d0,$32(a0)
;	fixed.cps = 16;
	move.l	a3,a0
	move.w	#$10,$34(a0)
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2/d3/a2/a3/a6
	unlk	a5
	rts

L370
	dc.b	'P5',$A,'%ld',$A,'%ld',$A,'255',$A,0

	SECTION "Delete__xTEXFONT__T:0",CODE


;void xTEXFONT::Delete()
	XDEF	Delete__xTEXFONT__T
Delete__xTEXFONT__T
	move.l	a2,-(a7)
	move.l	$8(a7),a2
L401
;	xTEXSURF::Delete();
	move.l	a2,-(a7)
	jsr	Delete__xTEXSURF__T
	addq.w	#4,a7
;	prop.glyphs	= 0;
	clr.l	$2E(a2)
;	prop.spacing = 0;
	clr.l	$32(a2)
	move.l	(a7)+,a2
	rts

	SECTION "WriteTextF__xTEXFONT__TP08DRAWLISTUjssPce:0",CODE


;void xTEXFONT::WriteTextF(DRAWLIST* draw, uint32 col, S_XY, char* te
	XDEF	WriteTextF__xTEXFONT__TP08DRAWLISTUjssPce
WriteTextF__xTEXFONT__TP08DRAWLISTUjssPce
L408	EQU	-$108
	link	a5,#L408
	movem.l	d2-d4/a2/a3,-(a7)
	move.l	$10(a5),d2
	move.w	$14(a5),d3
	move.w	$16(a5),d4
	move.l	$C(a5),a2
	move.l	$8(a5),a3
L402
;	if (!draw || draw->Flag(DRAWLIST::MAKELIST)==0)
	cmp.w	#0,a2
	beq.b	L404
L403
	move.l	$A(a2),d0
	and.l	#2,d0
	bne.b	L405
L404
;		return;
	movem.l	(a7)+,d2-d4/a2/a3
	unlk	a5
	rts
L405
;	va_start(arglist,text)
	lea	$18(a5),a0
	move.l	a0,d0
	addq.l	#4,d0
;	sint32 n = vsprintf(textBuffer,text,arglist);
	move.l	d0,-(a7)
	move.l	$18(a5),-(a7)
	pea	-$100(a5)
	jsr	_vsprintf
	add.w	#$C,a7
;	if (n<0) 
	tst.l	d0
	bpl.b	L407
L406
;	if (n<0) return;
	movem.l	(a7)+,d2-d4/a2/a3
	unlk	a5
	rts
L407
;	WriteText(draw, col, x, y, textBuffer);
	pea	-$100(a5)
	move.w	d4,-(a7)
	move.w	d3,-(a7)
	move.l	d2,-(a7)
	move.l	a2,-(a7)
	move.l	a3,-(a7)
	jsr	WriteText__xTEXFONT__TP08DRAWLISTUjssPc
	add.w	#$14,a7
	movem.l	(a7)+,d2-d4/a2/a3
	unlk	a5
	rts

	SECTION "WriteText__xTEXFONT__TP08DRAWLISTUjssPc:0",CODE


;void xTEXFONT::WriteText(DRAWLIST* draw, uint32 col, S_XY, char* tex
	XDEF	WriteText__xTEXFONT__TP08DRAWLISTUjssPc
WriteText__xTEXFONT__TP08DRAWLISTUjssPc
L453	EQU	-$2E
	link	a5,#L453
	movem.l	d2-d7/a2/a3/a6,-(a7)
	fmovem.x fp2,-(a7)
	move.w	$16(a5),d3
	move.l	$8(a5),a2
	move.l	$18(a5),a3
L409
;	if (!draw || draw->Flag(DRAWLIST::MAKELIST)==0)
	tst.l	$C(a5)
	beq.b	L411
L410
	move.l	$C(a5),a0
	move.l	$A(a0),d0
	and.l	#2,d0
	bne.b	L412
L411
;		return;
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2-d7/a2/a3/a6
	unlk	a5
	rts
L412
;	draw->flags |= DRAWLIST::ENFORCESTATE;
	move.l	$C(a5),a0
	move.l	$A(a0),d0
	or.l	#$10000000,d0
	move.l	$C(a5),a0
	move.l	d0,$A(a0)
;	sint32 n = strlen(text);
	move.l	a3,-(a7)
	jsr	_strlen
	addq.w	#4,a7
	move.l	d0,d2
;	if (n==0)
	bne.b	L414
L413
;		return;
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2-d7/a2/a3/a6
	unlk	a5
	rts
L414
;	DVERTEX* v = draw->GetVertices((n*6), true);
	move.w	#1,-(a7)
	move.l	d2,d0
	muls.l	#6,d0
	move.l	d0,-(a7)
	move.l	$C(a5),-(a7)
	jsr	GetVertices__DRAWLIST__Tjs
	add.w	#$A,a7
	move.l	d0,a0
;	if (v)
	cmp.w	#0,a0
	beq	L452
L415
;		++v;
	add.w	#$20,a0
;		rsint32 i = n+1;
	move.l	d2,d5
	addq.l	#1,d5
;	ruint8* p = (uint8*)text;
	move.l	a3,a6
;		sint32 cursX = x;
	move.w	$14(a5),d0
	ext.l	d0
; sint32 cursY = y;
	move.w	d3,d1
	ext.l	d1
;		sint32 vUsed = 0;
	moveq	#0,d7
;		if (flags & XF_FIXED)
	move.l	$26(a2),d2
	and.l	#1,d2
	beq	L432
L416
;			while(--i)
	bra	L430
L417
;				uint32 c = *(p++);
	moveq	#0,d4
	move.b	(a6)+,d4
;				if (cursY > x3D::GetDrawBottomLimit())
	move.l	_drawRegion__x3D+4,d2
	move.l	_drawRegion__x3D+$C,d3
	add.l	d3,d2
	cmp.l	d2,d1
	ble.b	L419
L418
;					
	bra	L431
L419
;				else if (c == (uint32)('\n')) // always handle newlines
	cmp.l	#$A,d4
	bne.b	L421
L420
;					cursY	+= size;
	add.l	$2A(a2),d1
;	cursX = x;
	move.w	$14(a5),d0
	ext.l	d0
	bra	L430
L421
;				else if (c == (uint32)(' '))
	cmp.l	#$20,d4
	bne.b	L423
L422
;					cursX += fixed.printW;
	move.w	$32(a2),d2
	ext.l	d2
	add.l	d2,d0
	bra	L430
L423
;				else if (c == (uint32)('\t'))
	cmp.l	#$9,d4
	bne.b	L425
L424
;					cursX += 3*fixed.printW;
	move.w	$32(a2),d2
	muls	#3,d2
	add.l	d2,d0
	bra	L430
L425
;				else if (cursX > x3D::GetDrawRightLimit() || (cursY+siz
	move.l	_drawRegion__x3D,d2
	move.l	_drawRegion__x3D+$8,d3
	add.l	d3,d2
	cmp.l	d2,d0
	bgt.b	L428
L426
	move.l	d1,d3
	add.l	$2A(a2),d3
	move.l	_drawRegion__x3D+4,d2
	cmp.l	d2,d3
	blt.b	L428
L427
	move.w	$32(a2),d2
	ext.l	d2
	move.l	d0,d3
	add.l	d2,d3
	move.l	_drawRegion__x3D,d2
	cmp.l	d2,d3
	bge.b	L429
L428
;					
	bra	L430
L429
;					vUsed++;
	move.l	d7,d2
	addq.l	#1,d2
	move.l	d2,d7
;					uint32 x1 = fixed.glyphW*(c%fixed.cps);
	move.w	$2E(a2),d3
	ext.l	d3
	move.w	$34(a2),d2
	ext.l	d2
	move.l	d4,d6
	divul.l	d2,d2:d6
	mulu.l	d2,d3
;					uint32 y1 = fixed.glyphH*(c/fixed.cps);
	move.w	$30(a2),d2
	ext.l	d2
	move.w	$34(a2),d6
	ext.l	d6
	divul.l	d6,d4
	mulu.l	d4,d2
;					v->x			= cursX;
	fmove.l	d0,fp0
	fmove.s	fp0,(a0)
;							v->y = cursY;
	fmove.l	d1,fp0
	fmove.s	fp0,4(a0)
;										v->z = 0;
	clr.l	$8(a0)
;*/						v->u = x1;
	fmove.l	d3,fp0
	fmove.s	fp0,$10(a0)
;									(v++)->v = y1;
	fmove.l	d2,fp0
	move.l	a0,a1
	add.w	#$20,a0
	fmove.s	fp0,$14(a1)
;					v->x			= cursX+fixed.glyphW;
	move.w	$2E(a2),d4
	ext.l	d4
	add.l	d0,d4
	fmove.l	d4,fp0
	fmove.s	fp0,(a0)
;	v->y = cursY;
	fmove.l	d1,fp0
	fmove.s	fp0,4(a0)
;										v->z = 0;
	clr.l	$8(a0)
;*/						v->u = x1+fixed.glyphW;
	move.w	$2E(a2),d4
	ext.l	d4
	add.l	d3,d4
	fmove.l	d4,fp0
	fmove.s	fp0,$10(a0)
;			(v++)->v = y1;
	fmove.l	d2,fp0
	move.l	a0,a1
	add.w	#$20,a0
	fmove.s	fp0,$14(a1)
;					v->x			= cursX;
	fmove.l	d0,fp0
	fmove.s	fp0,(a0)
;							v->y = cursY+fixed.glyphH;
	move.w	$30(a2),d4
	ext.l	d4
	add.l	d1,d4
	fmove.l	d4,fp0
	fmove.s	fp0,4(a0)
;			v->z = 0;
	clr.l	$8(a0)
;*/						v->u = x1;
	fmove.l	d3,fp0
	fmove.s	fp0,$10(a0)
;									(v++)->v = y1+fixed.glyphH;
	move.w	$30(a2),d4
	ext.l	d4
	add.l	d2,d4
	fmove.l	d4,fp0
	move.l	a0,a1
	add.w	#$20,a0
	fmove.s	fp0,$14(a1)
;					v->x			= cursX;
	fmove.l	d0,fp0
	fmove.s	fp0,(a0)
;							v->y = cursY+fixed.glyphH;
	move.w	$30(a2),d4
	ext.l	d4
	add.l	d1,d4
	fmove.l	d4,fp0
	fmove.s	fp0,4(a0)
;			v->z = 0;
	clr.l	$8(a0)
;*/						v->u = x1;
	fmove.l	d3,fp0
	fmove.s	fp0,$10(a0)
;									(v++)->v = y1+fixed.glyphH;
	move.w	$30(a2),d4
	ext.l	d4
	add.l	d2,d4
	fmove.l	d4,fp0
	move.l	a0,a1
	add.w	#$20,a0
	fmove.s	fp0,$14(a1)
;					v->x			= cursX+fixed.glyphW;
	move.w	$2E(a2),d4
	ext.l	d4
	add.l	d0,d4
	fmove.l	d4,fp0
	fmove.s	fp0,(a0)
;	v->y = cursY;
	fmove.l	d1,fp0
	fmove.s	fp0,4(a0)
;										v->z = 0;
	clr.l	$8(a0)
;*/						v->u = x1+fixed.glyphW;
	move.w	$2E(a2),d4
	ext.l	d4
	add.l	d3,d4
	fmove.l	d4,fp0
	fmove.s	fp0,$10(a0)
;			(v++)->v = y1;
	fmove.l	d2,fp0
	move.l	a0,a1
	add.w	#$20,a0
	fmove.s	fp0,$14(a1)
;					v->x			= cursX+fixed.glyphW;
	move.w	$2E(a2),d4
	ext.l	d4
	add.l	d0,d4
	fmove.l	d4,fp0
	fmove.s	fp0,(a0)
;	v->y = cursY+fixed.glyphH;
	move.w	$30(a2),d4
	ext.l	d4
	add.l	d1,d4
	fmove.l	d4,fp0
	fmove.s	fp0,4(a0)
;			v->z = 0;
	clr.l	$8(a0)
;*/						v->u = x1+fixed.glyphW;
	move.w	$2E(a2),d4
	ext.l	d4
	add.l	d4,d3
	fmove.l	d3,fp0
	fmove.s	fp0,$10(a0)
;			(v++)->v = y1+fixed.glyphH;
	move.w	$30(a2),d3
	ext.l	d3
	add.l	d3,d2
	fmove.l	d2,fp0
	move.l	a0,a1
	add.w	#$20,a0
	fmove.s	fp0,$14(a1)
;					cursX += fixed.printW;
	move.w	$32(a2),d2
	ext.l	d2
	add.l	d2,d0
L430
	subq.l	#1,d5
	tst.l	d5
	bne	L417
L431
	bra	L447
L432
;			while(--i)
	bra	L446
L433
;				ruint32 c = *(p++);
	moveq	#0,d2
	move.b	(a6)+,d2
;				if (cursY > x3D::GetDrawBottomLimit())
	move.l	_drawRegion__x3D+4,d3
	move.l	_drawRegion__x3D+$C,d4
	add.l	d4,d3
	cmp.l	d3,d1
	ble.b	L435
L434
;					
	bra	L447
L435
;				else if (c == (uint32)('\n'))
	cmp.l	#$A,d2
	bne.b	L437
L436
;					cursY += size;
	add.l	$2A(a2),d1
;	cursX = x;
	move.w	$14(a5),d0
	ext.l	d0
	bra	L446
L437
;				else if (cursX > x3D::GetDrawRightLimit() || (cursY + s
	move.l	_drawRegion__x3D,d3
	move.l	_drawRegion__x3D+$8,d4
	add.l	d4,d3
	cmp.l	d3,d0
	bgt.b	L440
L438
	move.l	d1,d4
	add.l	$2A(a2),d4
	move.l	_drawRegion__x3D+4,d3
	cmp.l	d3,d4
	blt.b	L440
L439
	move.l	$32(a2),a1
	move.w	0(a1,d2.l*2),d3
	ext.l	d3
	move.l	d0,d4
	add.l	d3,d4
	move.l	_drawRegion__x3D,d3
	cmp.l	d3,d4
	bge.b	L441
L440
;					
	bra	L446
L441
;				else if (c == (uint32)(' '))
	cmp.l	#$20,d2
	bne.b	L443
L442
;					cursX += prop.spacing[(' ')];
	move.l	$32(a2),a1
	move.w	$40(a1),d2
	ext.l	d2
	add.l	d2,d0
	bra	L446
L443
;				else if (c == (uint32)('\t'))
	cmp.l	#$9,d2
	bne.b	L445
L444
;					cursX += 3*prop.spacing[(' ')];
	move.l	$32(a2),a1
	move.w	$40(a1),d2
	muls	#3,d2
	add.l	d2,d0
	bra	L446
L445
;					vUsed++;
	move.l	d7,d3
	addq.l	#1,d3
	move.l	d3,d7
;					register xRECT16* g = prop.glyphs + c;
	move.l	$2E(a2),a1
	lea	0(a1,d2.l*8),a1
;					ruint32 space = (g->x2) - (g->x1);
	move.w	4(a1),d3
	ext.l	d3
	move.w	(a1),d4
	ext.l	d4
	sub.l	d4,d3
;					v->x			= cursX;
	fmove.l	d0,fp0
	fmove.s	fp0,(a0)
;					v->y = cursY;
	fmove.l	d1,fp0
	fmove.s	fp0,4(a0)
;							v->z = 0;
	clr.l	$8(a0)
;*/				v->u = g->x1;
	move.w	(a1),d4
	ext.l	d4
	fmove.l	d4,fp0
	fmove.s	fp0,$10(a0)
;					(v++)->v = g->y1;
	move.w	2(a1),d4
	ext.l	d4
	fmove.l	d4,fp0
	move.l	a0,a3
	add.w	#$20,a0
	fmove.s	fp0,$14(a3)
;					v->x			= cursX+space;
	move.l	d0,d4
	add.l	d3,d4
	fmove.l	d4,fp0
	fmove.s	fp0,(a0)
;		v->y = cursY;
	fmove.l	d1,fp0
	fmove.s	fp0,4(a0)
;							v->z = 0;
	clr.l	$8(a0)
;*/				v->u = g->x2;
	move.w	4(a1),d4
	ext.l	d4
	fmove.l	d4,fp0
	fmove.s	fp0,$10(a0)
;					(v++)->v = g->y1;
	move.w	2(a1),d4
	ext.l	d4
	fmove.l	d4,fp0
	move.l	a0,a3
	add.w	#$20,a0
	fmove.s	fp0,$14(a3)
;					v->x			= cursX;
	fmove.l	d0,fp0
	fmove.s	fp0,(a0)
;					v->y = cursY+size;
	move.l	$2A(a2),d4
	add.l	d1,d4
	fmove.l	d4,fp0
	fmove.s	fp0,4(a0)
;			v->z = 0;
	clr.l	$8(a0)
;*/				v->u = g->x1;
	move.w	(a1),d4
	ext.l	d4
	fmove.l	d4,fp0
	fmove.s	fp0,$10(a0)
;					(v++)->v = g->y2;
	move.w	6(a1),d4
	ext.l	d4
	fmove.l	d4,fp0
	move.l	a0,a3
	add.w	#$20,a0
	fmove.s	fp0,$14(a3)
;					v->x			= cursX;
	fmove.l	d0,fp0
	fmove.s	fp0,(a0)
;					v->y = cursY+size;
	move.l	$2A(a2),d4
	add.l	d1,d4
	fmove.l	d4,fp0
	fmove.s	fp0,4(a0)
;			v->z = 0;
	clr.l	$8(a0)
;*/				v->u = g->x1;
	move.w	(a1),d4
	ext.l	d4
	fmove.l	d4,fp0
	fmove.s	fp0,$10(a0)
;					(v++)->v = g->y2;
	move.w	6(a1),d4
	ext.l	d4
	fmove.l	d4,fp0
	move.l	a0,a3
	add.w	#$20,a0
	fmove.s	fp0,$14(a3)
;					v->x			= cursX+space;
	move.l	d0,d4
	add.l	d3,d4
	fmove.l	d4,fp0
	fmove.s	fp0,(a0)
;		v->y = cursY;
	fmove.l	d1,fp0
	fmove.s	fp0,4(a0)
;							v->z = 0;
	clr.l	$8(a0)
;*/				v->u = g->x2;
	move.w	4(a1),d4
	ext.l	d4
	fmove.l	d4,fp0
	fmove.s	fp0,$10(a0)
;					(v++)->v = g->y1;
	move.w	2(a1),d4
	ext.l	d4
	fmove.l	d4,fp0
	move.l	a0,a3
	add.w	#$20,a0
	fmove.s	fp0,$14(a3)
;					v->x			= cursX+space;
	add.l	d0,d3
	fmove.l	d3,fp0
	fmove.s	fp0,(a0)
;		v->y = cursY+size;
	move.l	$2A(a2),d3
	add.l	d1,d3
	fmove.l	d3,fp0
	fmove.s	fp0,4(a0)
;			v->z = 0;
	clr.l	$8(a0)
;*/				v->u = g->x2;
	move.w	4(a1),d3
	ext.l	d3
	fmove.l	d3,fp0
	fmove.s	fp0,$10(a0)
;					(v++)->v = g->y2;
	move.w	6(a1),d3
	ext.l	d3
	fmove.l	d3,fp0
	move.l	a0,a1
	add.w	#$20,a0
	fmove.s	fp0,$14(a1)
;					cursX += prop.spacing[c];
	move.l	$32(a2),a1
	move.w	0(a1,d2.l*2),d2
	ext.l	d2
	add.l	d2,d0
L446
	subq.l	#1,d5
	tst.l	d5
	bne	L433
L447
;		if (vUsed)
	tst.l	d7
	beq	L452
L448
;			bool aTest = draw->Enabled(x3D::ALPHA_TEST);
	move.l	$C(a5),a0
	move.l	$3E(a0),d0
	and.l	#$400000,d0
	sne	d0
	and.l	#1,d0
	move.w	d0,d2
;			if (!aTest)
	bne.b	L450
L449
;				draw->Enable(x3D::ALPHA_TEST);
	move.l	#$400000,-(a7)
	move.l	$C(a5),-(a7)
	jsr	Enable__DRAWLIST__TE
	addq.w	#$8,a7
L450
;			x3D::AMODE	aMode = draw->GetACompareMode();
	move.l	$C(a5),a0
	move.l	$5E(a0),d3
;			float32			aRef = draw->GetAlphaRefValue();
	move.l	$C(a5),a0
	fmove.s	$4A(a0),fp2
;			draw->Enable(x3D::ALPHA_BLEND);
	pea	$2000.w
	move.l	$C(a5),-(a7)
	jsr	Enable__DRAWLIST__TE
	addq.w	#$8,a7
;			draw->Enable(x3D::TEXTURE);
	pea	$100.w
	move.l	$C(a5),-(a7)
	jsr	Enable__DRAWLIST__TE
	addq.w	#$8,a7
;			draw->Disable(x3D::GOURAUD);
	pea	$400.w
	move.l	$C(a5),-(a7)
	jsr	Disable__DRAWLIST__TE
	addq.w	#$8,a7
;			draw->SetColour(col);
	move.l	$10(a5),-(a7)
	move.l	$C(a5),-(a7)
	jsr	SetColour__DRAWLIST__TUj
	addq.w	#$8,a7
;			draw->SetTexture((xTEXSURF*)this);
	move.l	a2,-(a7)
	move.l	$C(a5),-(a7)
	jsr	SetTexture__DRAWLIST__TP08xTEXSURF
	addq.w	#$8,a7
;			draw->AlphaCompareMode(x3D::ALPHA_GT, 0.2);
	move.l	#$3E4CCCCD,-(a7)
	pea	5.w
	move.l	$C(a5),-(a7)
	jsr	AlphaCompareMode__DRAWLIST__TEf
	add.w	#$C,a7
;			draw->Tris(vUsed*6);
	move.l	d7,d0
	muls.l	#6,d0
	move.l	d0,-(a7)
	move.l	$C(a5),-(a7)
	jsr	Tris__DRAWLIST__Tj
	addq.w	#$8,a7
;			draw->AlphaCompareMode(aMode, aRef);
	fmove.s	fp2,-(a7)
	move.l	d3,-(a7)
	move.l	$C(a5),-(a7)
	jsr	AlphaCompareMode__DRAWLIST__TEf
	add.w	#$C,a7
;			if (!aTest)
	tst.w	d2
	bne.b	L452
L451
;				draw->Disable(x3D::ALPHA_TEST);
	move.l	#$400000,-(a7)
	move.l	$C(a5),-(a7)
	jsr	Disable__DRAWLIST__TE
	addq.w	#$8,a7
L452
	fmovem.x (a7)+,fp2
	movem.l	(a7)+,d2-d7/a2/a3/a6
	unlk	a5
	rts

	END
