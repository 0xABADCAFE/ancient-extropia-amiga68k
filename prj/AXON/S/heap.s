
; Storm C Compiler
; Mendoza:Extropia/eXtropia/prj/AXON/heap.cpp
	mc68030
	mc68881
	XREF	_0dt__BUILDING__T
	XREF	Render__BUILDING__TR04VIEW
	XREF	Place__BUILDING__TRC05VEC3Dfsss
	XREF	_0dt__PINETREE__T
	XREF	Render__PINETREE__TR04VIEW
	XREF	Place__PINETREE__TRC05VEC3Dfsss
	XREF	Render__RGBCUBE__TR04VIEW
	XREF	Place__RGBCUBE__TRC05VEC3Dfsss
	XREF	Render__MODEL__TR04VIEW
	XREF	Rotate__MODEL__Tsss
	XREF	Move__MODEL__TRC05VEC3D
	XREF	Place__MODEL__TRC05VEC3Dfsss
	XREF	ClipBox__MODEL__T
	XREF	_0dt__MAPCELL__T
	XREF	Visibility__MAPCELL__TR04VIEW
	XREF	_0dt__VIEW__T
	XREF	Close__VIEW__T
	XREF	Open__VIEW__T
	XREF	MoveEvent__VIEW__T
	XREF	ResizeEvent__VIEW__T
	XREF	ExitEvent__VIEW__T
	XREF	KeyEvent__VIEW__Tjs
	XREF	MouseEvent__VIEW__Tjjj
	XREF	op__multAsgn__TRANSFORM__TRC09TRANSFORM
	XREF	Rotate__TRANSFORM__Tfff
	XREF	Define__PLANE__TP03C3DP03C3DP03C3D
	XREF	Define__PLANE__TP05VEC3DP05VEC3DP05VEC3D
	XREF	_sqrt__r
	XREF	Load__xTEXTURE__TPCcj
	XREF	LoadPPM__xTEXTURE__TPCcUj
	XREF	Delete__xTEXTURE__T
	XREF	Create__xTEXTURE__TsssPvPUj
	XREF	Close__xDBWIN__T
	XREF	Open__xDBWIN__T
	XREF	Set__xDBWIN__TsssssPCc
	XREF	Idle__xDISPLAYIO_ASYNC__T
	XREF	Done__xDISPLAYIO_ASYNC__T
	XREF	Init__xDISPLAYIO_ASYNC__T
	XREF	MoveEvent__xDISPLAYIO__T
	XREF	ResizeEvent__xDISPLAYIO__T
	XREF	Idle__xDISPLAYIO__T
	XREF	HandleEvent__xDISPLAYIO__T
	XREF	ApplyInputModification__xDISPLAYIO__T
	XREF	ViewSurface__xDISPLAY__T
	XREF	DrawSurface__xDISPLAY__T
	XREF	Refresh__xDISPLAY__T
	XREF	Close__xDISPLAY__T
	XREF	Open__xDISPLAY__T
	XREF	_0dt__xSURFACE__T
	XREF	_0dt__POOL_ST__T
	XREF	_0ct__POOL_ST__TUsUj
	XREF	FreeT__POOL_ST__TPv
	XREF	NewT__POOL_ST__TPvUs
	XREF	NewT__POOL_ST__TPv
	XREF	Create__POOL_ST__TUsUj
	XREF	PrintAlloc__POOL_ST__TR07ostreamjj
	XREF	_0dt__POOL_LT__T
	XREF	Close__xFILEIO__T
	XREF	Write__xFILEIO__TPvUiUi
	XREF	Read__xFILEIO__TPvUiUi
	XREF	Open__xFILEIO__TPCcjj
	XREF	SendPacket__xFILEIO__TPv
	XREF	WaitPacket__xFILEIO__T
	XREF	InputQueued__xINPUT__T
	XREF	Idle__xINPUT__T
	XREF	ExitEvent__xINPUT__T
	XREF	KeyEvent__xINPUT__Tjs
	XREF	MouseEvent__xINPUT__Tjjj
	XREF	ApplyInputModification__xINPUT__T
	XREF	UnLink__xCHAINABLE__T
	XREF	_0ct__xTHREADABLE__TPCcUjjs
	XREF	ShutDown__xTHREADABLE__T
	XREF	Done__xTHREADABLE__T
	XREF	Init__xTHREADABLE__T
	XREF	_0dt__xLOCKABLE__T
	XREF	FreeLock__xLOCKABLE__Ts
	XREF	WaitLock__xLOCKABLE__T
	XREF	_0dt__sysRTLIB__T
	XREF	MessageBox__sysBASELIB__PcPcPce
	XREF	_system
	XREF	op__leftshift__ostream__Td
	XREF	op__leftshift__ostream__TUj
	XREF	op__leftshift__ostream__Tj
	XREF	op__leftshift__ostream__TPCc
	XREF	op__leftshift__ostream__Tc
	XREF	opfx__ostream__T
	XREF	read__istream__TPci
	XREF	get__istream__TRc
	XREF	getline__istream__TPcic
	XREF	get__istream__TPcic
	XREF	op__rightshift__istream__TRc
	XREF	op__rightshift__istream__TPc
	XREF	doallocate__streambuf__T
	XREF	xsgetn__streambuf__TPci
	XREF	xsputn__streambuf__TPCci
	XREF	underflow__streambuf__T
	XREF	overflow__streambuf__Ti
	XREF	setbuf__streambuf__TPcUi
	XREF	sputn__streambuf__TPCci
	XREF	_0dt__streambuf__T
	XREF	userword__ios__Ti
	XREF	init__ios__TP09streambuf
	XREF	_ftell
	XREF	_fseek
	XREF	_fwrite
	XREF	_fread
	XREF	_vfprintf
	XREF	_sprintf
	XREF	_fflush
	XREF	_feof
	XREF	_fclose
	XREF	_fopen
	XREF	_fgets
	XREF	_memset
	XREF	_memmove
	XREF	_strncpy
	XREF	op__delete__PvUi
	XREF	_std__in
	XREF	_std__out
	XREF	_std__err
	XREF	_basefield__ios
	XREF	_adjustfield__ios
	XREF	_floatfield__ios
	XREF	_aNextBit__ios
	XREF	_aNextWord__ios
	XREF	_cin
	XREF	_cout
	XREF	_cerr
	XREF	_clog
	XREF	_st
	XREF	_gxSt
	XREF	_errBuff__xBASELIB
	XREF	_errSev__xBASELIB
	XREF	_errTbl__xBASELIB
	XREF	_SysBase
	XREF	_IntuitionBase
	XREF	_DOSBase
	XREF	_sysData__sysBASELIB
	XREF	_msgbuff__sysBASELIB
	XREF	_main__sysBASELIB
	XREF	_allocated__MEM
	XREF	_totSize__MEM
	XREF	_nextFree__MEM
	XREF	_cnt__MEM
	XREF	_maxAllocs__MEM
	XREF	_GfxBase
	XREF	_TimerBase
	XREF	_TimerBase__xTIMABLE
	XREF	_current__xTIMABLE
	XREF	_clockFreq__xTIMABLE
	XREF	_threadCnt__xTHREADABLE
	XREF	_main__xTHREADABLE
	XREF	_CyberGfxBase
	XREF	_Warp3DBase
	XREF	_graphics__x2D
	XREF	_cyberGfx__x2D
	XREF	_formatNames__x2D
	XREF	_surfaceTypes__x2D
	XREF	_warp3D__x3D
	XREF	_hw3D__x3D
	XREF	_pointRender__x3D
	XREF	_lineRender__x3D
	XREF	_triangleRender__x3D
	XREF	_otherPrimitives__x3D
	XREF	_shadingModes__x3D
	XREF	_textureModes__x3D
	XREF	_textureFmts__x3D
	XREF	_alpha__x3D
	XREF	_fogModes__x3D
	XREF	_zBuffer__x3D
	XREF	_stencil__x3D
	XREF	_misc__x3D
	XREF	_primNames__x3D
	XREF	_renderNames__x3D
	XREF	_shadingNames__x3D
	XREF	_texModeNames__x3D
	XREF	_texFormatNames__x3D
	XREF	_alphaNames__x3D
	XREF	_fogNames__x3D
	XREF	_zBufferNames__x3D
	XREF	_stencilNames__x3D
	XREF	_miscNames__x3D
	XREF	_drawSurface__x3D
	XREF	_context__x3D
	XREF	_drawRegion__x3D
	XREF	_fogData__x3D
	XREF	_flags__xGFX
	XREF	_mode__xGFX
	XREF	_numModes__xGFX
	XREF	_rPool__xSURFACE
	XREF	_DiskfontBase
	XREF	_fontInfo__xDRAW
	XREF	_fontData__xDRAW
	XREF	_fonts__xDRAW
	XREF	_flags__xDRAW
	XREF	_flushCnt__xDRAW
	XREF	_cTab__xDRAW
	XREF	_sTab__xDRAW
	XREF	_fault__xDRAW
	XREF	_vBufPos__xDRAW
	XREF	_zDepth__xDRAW
	XREF	_maxVBufPos__xDRAW
	XREF	_vArraySize__xDRAW
	XREF	_vArray__xDRAW
	XREF	_vBuffer__xDRAW
	XREF	_nestCount__xDRAW
	XREF	_currentCol__xDRAW
	XREF	_sineData__QTRIG
	XREF	_gradData__QTRIG
	XREF	_vCachePtr__AXON
	XREF	_vCache__AXON
	XREF	_dimension__WORLDMAP
	XREF	_logDim__WORLDMAP
	XREF	_fracLimit__WORLDMAP
	XREF	_worldGrid__WORLDMAP
	XREF	_minZ__WORLDMAP
	XREF	_maxZ__WORLDMAP
	XREF	_floodLevel__WORLDMAP
	XREF	_scale__WORLDMAP
	XREF	_unitName__WORLDMAP
	XREF	_detailLevel__WORLDMAP
	XREF	_cell__WORLDMAP
	XREF	_visible__WORLDMAP
	XREF	_wet__WORLDMAP
	XREF	_things__WORLDMAP
	XREF	_frames__WORLDMAP
	XREF	_frameTime__WORLDMAP
	XREF	_totalTime__WORLDMAP
	XREF	_stopWatch__WORLDMAP
	XREF	_ground__WORLDMAP
	XREF	_water__WORLDMAP
	XREF	_count__PINETREE
	XREF	_texture__PINETREE
	XREF	_points__PINETREE
	XREF	_count__BUILDING
	XREF	_texture__BUILDING
	XREF	_points__BUILDING

	SECTION "_0ct__streampos__T:0",CODE

	rts

	SECTION "_heap__TEXTUREHEAP:1",DATA

	XDEF	_heap__TEXTUREHEAP
_heap__TEXTUREHEAP
	dc.l	0

	SECTION "_keys__TEXTUREHEAP:1",DATA

	XDEF	_keys__TEXTUREHEAP
_keys__TEXTUREHEAP
	dc.l	0

	SECTION "_index__TEXTUREHEAP:1",DATA

	XDEF	_index__TEXTUREHEAP
_index__TEXTUREHEAP
	dc.l	0

	SECTION "_heapSize__TEXTUREHEAP:1",DATA

	XDEF	_heapSize__TEXTUREHEAP
_heapSize__TEXTUREHEAP
	dc.l	0

	SECTION "_lastTexture__TEXTUREHEAP:1",DATA

	XDEF	_lastTexture__TEXTUREHEAP
_lastTexture__TEXTUREHEAP
	dc.l	0

	SECTION "_lastKey__TEXTUREHEAP:1",DATA

	XDEF	_lastKey__TEXTUREHEAP
_lastKey__TEXTUREHEAP
	dc.l	0

	SECTION "Init__TEXTUREHEAP__j:0",CODE


;sint32 TEXTUREHEAP::Init(sint32 size)
	XDEF	Init__TEXTUREHEAP__j
Init__TEXTUREHEAP__j
	XREF	sym_handlers
L366	EQU	-$24
	link	a5,#L366
	movem.l	d2-d5/a2/a6,-(a7)
	move.l	$8(a5),d5
L313
;	heap = New(heap, (size_t)size);
	move.l	d5,d2
	moveq	#1,d3
	move.l	d2,d0
	mulu.l	#$38,d0
	move.l	d0,d1
	addq.l	#$8,d1
	tst.l	_allocated__MEM
	bne.b	L315
L314
	sub.l	a0,a0
	bra	L329
L315
	move.w	d3,d0
	move.l	d1,d4
	move.l	_cnt__MEM,d1
	cmp.l	#$200,d1
	bne.b	L317
L316
	move.l	#L308,-(a7)
	move.l	#L309,-(a7)
	move.l	#L310,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
	move.l	#-$3010002,d0
	bra	L326
L317
	cmp.w	#1,d0
	bne.b	L319
L318
	move.l	#$10001,d1
	bra.b	L320
L319
	moveq	#1,d1
L320
	move.l	_SysBase,a6
	move.l	d4,d0
	jsr	-$2AC(a6)
	move.l	d0,a0
	cmp.w	#0,a0
	beq	L325
L321
	move.l	_nextFree__MEM,d3
	move.l	d3,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a2
	move.l	a0,0(a2,d0.l)
	move.l	_SysBase,a6
	sub.l	a1,a1
	jsr	-$126(a6)
	move.l	d3,d1
	muls.l	#$C,d1
	move.l	_allocated__MEM,a1
	move.l	d0,4(a1,d1.l)
	move.l	d3,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	d4,$8(a1,d0.l)
	add.l	d4,_totSize__MEM
	addq.l	#1,_cnt__MEM
	bra.b	L323
L322
	addq.l	#1,_nextFree__MEM
L323
	move.l	_nextFree__MEM,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	0(a1,d0.l),a0
	cmp.w	#0,a0
	bne.b	L322
L324
	move.l	d3,d0
	bra.b	L326
L325
	move.l	#-$3030001,d0
L326
	tst.l	d0
	bmi.b	L328
L327
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	0(a1,d0.l),a0
	bra.b	L329
L328
	sub.l	a0,a0
L329
	cmp.w	#0,a0
	beq	L336
L330
	move.l	d2,(a0)
	move.l	#$38,4(a0)
	move.l	a0,d0
	addq.l	#$8,d0
	move.l	d0,a6
	moveq	#0,d0
	bra.b	L334
L331
	move.l	d0,d1
	muls.l	#$38,d1
	lea	0(a6,d1.l),a0
	cmp.w	#0,a0
	beq.b	L333
L332
	move.l	#_0virttab__08xTEXTURE__08xTEXTURE,$8(a0)
	move.l	sym_handlers,a1
	clr.w	(a0)
	clr.w	2(a0)
	clr.w	4(a0)
	move.w	#$F,6(a0)
	lea	-$C(a5),a2
	move.l	a0,-(a2)
	move.l	#_0dt__AREA__T,-(a2)
	move.l	sym_handlers,-(a2)
	move.l	a2,sym_handlers
	clr.l	$C(a0)
	clr.l	$10(a0)
	clr.l	$14(a0)
	clr.l	$18(a0)
	clr.l	$1C(a0)
	clr.l	$20(a0)
	move.l	a1,sym_handlers
L333
	addq.l	#1,d0
L334
	cmp.l	d2,d0
	blo.b	L331
L335
	bra.b	L337
L336
	sub.l	a6,a6
L337
	move.l	a6,_heap__TEXTUREHEAP
;	if (!heap)
	tst.l	_heap__TEXTUREHEAP
	bne.b	L339
L338
;	
;		Done();
	jsr	Done__TEXTUREHEAP_
	move.l	#-$3030001,d0
	movem.l	(a7)+,d2-d5/a2/a6
	unlk	a5
	rts
L339
;	keys = New(keys, size);
	move.l	d5,d2
	moveq	#1,d3
	move.l	d2,d0
	moveq	#2,d1
	asl.l	d1,d0
	move.l	d0,d1
	addq.l	#$8,d1
	tst.l	_allocated__MEM
	bne.b	L341
L340
	sub.l	a0,a0
	bra	L355
L341
	move.w	d3,d0
	move.l	d1,d4
	move.l	_cnt__MEM,d1
	cmp.l	#$200,d1
	bne.b	L343
L342
	move.l	#L308,-(a7)
	move.l	#L309,-(a7)
	move.l	#L310,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
	move.l	#-$3010002,d0
	bra	L352
L343
	cmp.w	#1,d0
	bne.b	L345
L344
	move.l	#$10001,d1
	bra.b	L346
L345
	moveq	#1,d1
L346
	move.l	_SysBase,a6
	move.l	d4,d0
	jsr	-$2AC(a6)
	move.l	d0,a0
	cmp.w	#0,a0
	beq	L351
L347
	move.l	_nextFree__MEM,d3
	move.l	d3,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a2
	move.l	a0,0(a2,d0.l)
	move.l	_SysBase,a6
	sub.l	a1,a1
	jsr	-$126(a6)
	move.l	d3,d1
	muls.l	#$C,d1
	move.l	_allocated__MEM,a1
	move.l	d0,4(a1,d1.l)
	move.l	d3,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	d4,$8(a1,d0.l)
	add.l	d4,_totSize__MEM
	addq.l	#1,_cnt__MEM
	bra.b	L349
L348
	addq.l	#1,_nextFree__MEM
L349
	move.l	_nextFree__MEM,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	0(a1,d0.l),a0
	cmp.w	#0,a0
	bne.b	L348
L350
	move.l	d3,d0
	bra.b	L352
L351
	move.l	#-$3030001,d0
L352
	tst.l	d0
	bmi.b	L354
L353
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	0(a1,d0.l),a0
	bra.b	L355
L354
	sub.l	a0,a0
L355
	cmp.w	#0,a0
	beq.b	L360
L356
	move.l	d2,(a0)
	move.l	#4,4(a0)
	move.l	a0,d0
	addq.l	#$8,d0
	move.l	d0,a0
	moveq	#0,d0
	bra.b	L358
L357
	addq.l	#1,d0
L358
	cmp.l	d2,d0
	blo.b	L357
L359
	bra.b	L361
L360
	sub.l	a0,a0
L361
	move.l	a0,_keys__TEXTUREHEAP
;	if (!keys)
	tst.l	_keys__TEXTUREHEAP
	bne.b	L363
L362
;	
;		Done();
	jsr	Done__TEXTUREHEAP_
	move.l	#-$3030001,d0
	movem.l	(a7)+,d2-d5/a2/a6
	unlk	a5
	rts
L363
;	heapSize = size;
	move.l	d5,_heapSize__TEXTUREHEAP
;	cout << "TEXTUREHEAP::Init(" << size << ") OK\n";
	move.l	#L311,-(a7)
	move.l	d5,-(a7)
	move.l	#L312,-(a7)
	move.l	_cout,a0
	cmp.w	#0,a0
	beq.b	L365
L364
	addq.w	#4,a0
L365
	move.l	a0,-(a7)
	jsr	op__leftshift__ostream__TPCc
	addq.w	#$8,a7
	move.l	d0,-(a7)
	jsr	op__leftshift__ostream__Tj
	addq.w	#$8,a7
	move.l	d0,-(a7)
	jsr	op__leftshift__ostream__TPCc
	addq.w	#$8,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d5/a2/a6
	unlk	a5
	rts

L311
	dc.b	') OK',$A,0
L310
	dc.b	'Debug',0
L308
	dc.b	'MEM::AllocIndex()',$A,'Maximum allocation reached',0
L309
	dc.b	'Proceed',0
L312
	dc.b	'TEXTUREHEAP::Init(',0

	SECTION "Done__TEXTUREHEAP_:0",CODE


;sint32 TEXTUREHEAP::Done()
	XDEF	Done__TEXTUREHEAP_
Done__TEXTUREHEAP_
	movem.l	d2/a2/a3/a6,-(a7)
L374
;	if (keys)
	tst.l	_keys__TEXTUREHEAP
	beq	L399
L375
;	
;		Delete(keys);
	move.l	_keys__TEXTUREHEAP,a6
	cmp.w	#0,a6
	beq	L398
L376
	move.l	a6,d0
	subq.l	#$8,d0
	move.l	d0,a2
	moveq	#0,d2
	bra.b	L380
L377
	lea	0(a6,d2.l*4),a0
	cmp.w	#0,a0
	beq.b	L379
L378
	pea	4.w
	move.l	a0,-(a7)
	jsr	op__delete__PvUi
	addq.w	#$8,a7
L379
	addq.l	#1,d2
L380
	move.l	a2,a0
	cmp.l	(a0),d2
	blo.b	L377
L381
	move.l	a2,a1
	tst.l	_allocated__MEM
	beq	L398
L382
	cmp.w	#0,a1
	beq	L397
L383
	moveq	#0,d0
	moveq	#0,d1
	bra.b	L385
L384
	move.l	d0,d1
	muls.l	#$C,d1
	move.l	_allocated__MEM,a2
	move.l	a1,d2
	cmp.l	0(a2,d1.l),d2
	seq	d2
	and.l	#1,d2
	move.l	d2,d1
	addq.l	#1,d0
L385
	tst.l	d1
	bne.b	L387
L386
	cmp.l	#$200,d0
	blt.b	L384
L387
	tst.l	d1
	bne.b	L389
L388
	move.l	#L367,-(a7)
	move.l	#L368,-(a7)
	move.l	#L369,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
	bra	L398
L389
	move.l	d0,d2
	subq.l	#1,d2
	cmp.l	#$200,d2
	blo.b	L391
L390
	move.l	#L370,-(a7)
	move.l	#L368,-(a7)
	move.l	#L369,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
	bra	L396
L391
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	0(a1,d0.l),a0
	cmp.w	#0,a0
	bne.b	L393
L392
	move.l	#L371,-(a7)
	move.l	#L368,-(a7)
	move.l	#L369,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
	bra	L396
L393
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	_SysBase,a6
	move.l	0(a1,d0.l),a1
	jsr	-$2B2(a6)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	_totSize__MEM,d1
	sub.l	$8(a1,d0.l),d1
	move.l	d1,_totSize__MEM
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	clr.l	0(a1,d0.l)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	clr.l	4(a1,d0.l)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	clr.l	$8(a1,d0.l)
	subq.l	#1,_cnt__MEM
	cmp.l	_nextFree__MEM,d2
	bhs.b	L395
L394
	move.l	d2,_nextFree__MEM
L395
L396
	bra.b	L398
L397
	move.l	#L372,-(a7)
	move.l	#L368,-(a7)
	move.l	#L369,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
L398
;		keys = NOTSET;
	clr.l	_keys__TEXTUREHEAP
L399
;	if (heap)
	tst.l	_heap__TEXTUREHEAP
	beq	L424
L400
;	
;		Delete(heap);
	move.l	_heap__TEXTUREHEAP,a2
	cmp.w	#0,a2
	beq	L423
L401
	move.l	a2,d0
	subq.l	#$8,d0
	move.l	d0,a3
	moveq	#0,d2
	bra.b	L405
L402
	move.l	d2,d0
	muls.l	#$38,d0
	lea	0(a2,d0.l),a6
	cmp.w	#0,a6
	beq.b	L404
L403
	move.l	$8(a6),a0
	move.l	a6,d0
	add.l	$3C(a0),d0
	move.l	d0,-(a7)
	move.l	$38(a0),a0
	jsr	(a0)
	addq.w	#4,a7
	move.l	$8(a6),a0
	move.l	$30(a0),-(a7)
	move.l	$34(a0),d0
	add.l	a6,d0
	move.l	d0,-(a7)
	jsr	op__delete__PvUi
	addq.w	#$8,a7
L404
	addq.l	#1,d2
L405
	move.l	a3,a0
	cmp.l	(a0),d2
	blo.b	L402
L406
	move.l	a3,a1
	tst.l	_allocated__MEM
	beq	L423
L407
	cmp.w	#0,a1
	beq	L422
L408
	moveq	#0,d0
	moveq	#0,d1
	bra.b	L410
L409
	move.l	d0,d1
	muls.l	#$C,d1
	move.l	_allocated__MEM,a2
	move.l	a1,d2
	cmp.l	0(a2,d1.l),d2
	seq	d2
	and.l	#1,d2
	move.l	d2,d1
	addq.l	#1,d0
L410
	tst.l	d1
	bne.b	L412
L411
	cmp.l	#$200,d0
	blt.b	L409
L412
	tst.l	d1
	bne.b	L414
L413
	move.l	#L367,-(a7)
	move.l	#L368,-(a7)
	move.l	#L369,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
	bra	L423
L414
	move.l	d0,d2
	subq.l	#1,d2
	cmp.l	#$200,d2
	blo.b	L416
L415
	move.l	#L370,-(a7)
	move.l	#L368,-(a7)
	move.l	#L369,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
	bra	L421
L416
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	0(a1,d0.l),a0
	cmp.w	#0,a0
	bne.b	L418
L417
	move.l	#L371,-(a7)
	move.l	#L368,-(a7)
	move.l	#L369,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
	bra	L421
L418
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	_SysBase,a6
	move.l	0(a1,d0.l),a1
	jsr	-$2B2(a6)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	_totSize__MEM,d1
	sub.l	$8(a1,d0.l),d1
	move.l	d1,_totSize__MEM
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	clr.l	0(a1,d0.l)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	clr.l	4(a1,d0.l)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	clr.l	$8(a1,d0.l)
	subq.l	#1,_cnt__MEM
	cmp.l	_nextFree__MEM,d2
	bhs.b	L420
L419
	move.l	d2,_nextFree__MEM
L420
L421
	bra.b	L423
L422
	move.l	#L372,-(a7)
	move.l	#L368,-(a7)
	move.l	#L369,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
L423
;		heap = NOTSET;
	clr.l	_heap__TEXTUREHEAP
L424
;	lastTexture = NOTSET;
	clr.l	_lastTexture__TEXTUREHEAP
;	lastKey = 0;
	clr.l	_lastKey__TEXTUREHEAP
;	index = 0;
	clr.l	_index__TEXTUREHEAP
;	heapSize = 0;
	clr.l	_heapSize__TEXTUREHEAP
;	cout << "TEXTUREHEAP::Done() OK\n";
	move.l	#L373,-(a7)
	move.l	_cout,a0
	cmp.w	#0,a0
	beq.b	L426
L425
	addq.w	#4,a0
L426
	move.l	a0,-(a7)
	jsr	op__leftshift__ostream__TPCc
	addq.w	#$8,a7
	moveq	#0,d0
	movem.l	(a7)+,d2/a2/a3/a6
	rts

L369
	dc.b	'Debug',0
L367
	dc.b	'MEM::Free()',$A,'Address not recognised',0
L372
	dc.b	'MEM::Free()',$A,'Attempt to free null address',0
L370
	dc.b	'MEM::FreeIndex()',$A,'Index overflow',0
L371
	dc.b	'MEM::FreeIndex()',$A,'Memory already free',0
L368
	dc.b	'Proceed',0
L373
	dc.b	'TEXTUREHEAP::Done() OK',$A,0

	SECTION "UsePPM__TEXTUREHEAP__PCcUj:0",CODE


;xTEXTURE* TEXTUREHEAP::UsePPM(const char* name, uint32 alpha
	XDEF	UsePPM__TEXTUREHEAP__PCcUj
UsePPM__TEXTUREHEAP__PCcUj
	movem.l	d2-d4/a2,-(a7)
	move.l	$18(a7),d4
	move.l	$14(a7),a2
L427
;	ruint32 key = Key(name);
	move.l	a2,a0
	moveq	#0,d0
	bra.b	L429
L428
	moveq	#1,d1
	asl.l	d1,d0
	moveq	#0,d1
	move.b	(a0)+,d1
	eor.l	d1,d0
L429
	tst.b	(a0)
	bne.b	L428
L430
	move.l	d0,d3
;	xTEXTURE* result = FindByKey(key);
	move.l	d3,d2
	cmp.l	_lastKey__TEXTUREHEAP,d2
	bne.b	L432
L431
	move.l	_lastTexture__TEXTUREHEAP,a0
	bra.b	L438
L432
	moveq	#0,d0
	bra.b	L436
L433
	move.l	_keys__TEXTUREHEAP,a1
	cmp.l	0(a1,d0.l*4),d2
	bne.b	L435
L434
	muls.l	#$38,d0
	move.l	_heap__TEXTUREHEAP,a1
	lea	0(a1,d0.l),a0
	bra.b	L438
L435
	addq.l	#1,d0
L436
	cmp.l	_index__TEXTUREHEAP,d0
	ble.b	L433
L437
	sub.l	a0,a0
L438
;	if (!result)
	cmp.w	#0,a0
	bne.b	L444
L439
;	
;		if (index < heapSize)
	move.l	_index__TEXTUREHEAP,d0
	cmp.l	_heapSize__TEXTUREHEAP,d0
	bge.b	L443
L440
;		
;			if (heap[index].LoadPPM(name, alphagen)!=OK)
	move.l	d4,-(a7)
	move.l	a2,-(a7)
	move.l	_index__TEXTUREHEAP,d0
	muls.l	#$38,d0
	move.l	_heap__TEXTUREHEAP,a1
	pea	0(a1,d0.l)
	jsr	LoadPPM__xTEXTURE__TPCcUj
	add.w	#$C,a7
	tst.l	d0
	beq.b	L442
L441
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2
	rts
L442
;			keys[index] = key;
	move.l	_index__TEXTUREHEAP,d0
	move.l	_keys__TEXTUREHEAP,a1
	move.l	d3,0(a1,d0.l*4)
;			result = &heap[index++];
	move.l	_index__TEXTUREHEAP,d0
	addq.l	#1,_index__TEXTUREHEAP
	muls.l	#$38,d0
	move.l	_heap__TEXTUREHEAP,a1
	lea	0(a1,d0.l),a0
	bra.b	L444
L443
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2
	rts
L444
;	lastKey = key;
	move.l	d3,_lastKey__TEXTUREHEAP
;	lastTexture = result;
	move.l	a0,_lastTexture__TEXTUREHEAP
	move.l	a0,d0
	movem.l	(a7)+,d2-d4/a2
	rts

	SECTION "UseTex__TEXTUREHEAP__PCcj:0",CODE


;xTEXTURE* TEXTUREHEAP::UseTex(const char* name, sint32 force
	XDEF	UseTex__TEXTUREHEAP__PCcj
UseTex__TEXTUREHEAP__PCcj
	movem.l	d2-d4/a2,-(a7)
	move.l	$18(a7),d4
	move.l	$14(a7),a2
L445
;	uint32 key = Key(name);
	move.l	a2,a0
	moveq	#0,d0
	bra.b	L447
L446
	moveq	#1,d1
	asl.l	d1,d0
	moveq	#0,d1
	move.b	(a0)+,d1
	eor.l	d1,d0
L447
	tst.b	(a0)
	bne.b	L446
L448
	move.l	d0,d3
;	xTEXTURE* result = FindByKey(key);
	move.l	d3,d2
	cmp.l	_lastKey__TEXTUREHEAP,d2
	bne.b	L450
L449
	move.l	_lastTexture__TEXTUREHEAP,a0
	bra.b	L456
L450
	moveq	#0,d0
	bra.b	L454
L451
	move.l	_keys__TEXTUREHEAP,a1
	cmp.l	0(a1,d0.l*4),d2
	bne.b	L453
L452
	muls.l	#$38,d0
	move.l	_heap__TEXTUREHEAP,a1
	lea	0(a1,d0.l),a0
	bra.b	L456
L453
	addq.l	#1,d0
L454
	cmp.l	_index__TEXTUREHEAP,d0
	ble.b	L451
L455
	sub.l	a0,a0
L456
;	if (!result)
	cmp.w	#0,a0
	bne	L463
L457
;	
;		if (index < heapSize)
	move.l	_index__TEXTUREHEAP,d0
	cmp.l	_heapSize__TEXTUREHEAP,d0
	bge.b	L461
L458
;		
;			if (heap[index].Load(name, forceFmt)!=OK)
	move.l	d4,-(a7)
	move.l	a2,-(a7)
	move.l	_index__TEXTUREHEAP,d0
	muls.l	#$38,d0
	move.l	_heap__TEXTUREHEAP,a1
	pea	0(a1,d0.l)
	jsr	Load__xTEXTURE__TPCcj
	add.w	#$C,a7
	tst.l	d0
	beq.b	L460
L459
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2
	rts
L460
;			keys[index] = key;
	move.l	_index__TEXTUREHEAP,d0
	move.l	_keys__TEXTUREHEAP,a1
	move.l	d3,0(a1,d0.l*4)
;			result = &heap[index++];
	move.l	_index__TEXTUREHEAP,d0
	addq.l	#1,_index__TEXTUREHEAP
	muls.l	#$38,d0
	move.l	_heap__TEXTUREHEAP,a1
	lea	0(a1,d0.l),a0
	bra.b	L462
L461
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2
	rts
L462
;			return 
	bra.b	L464
L463
;	lastKey = key;
	move.l	d3,_lastKey__TEXTUREHEAP
L464
;	lastTexture = result;
	move.l	a0,_lastTexture__TEXTUREHEAP
	move.l	a0,d0
	movem.l	(a7)+,d2-d4/a2
	rts

	SECTION "Width__AREA__T:0",CODE

	CNOP	0,2

	XDEF	Width__AREA__T
Width__AREA__T
	move.l	4(a7),a0
L465
	move.w	(a0),d0
	ext.l	d0
	rts

	SECTION "Height__AREA__T:0",CODE

	CNOP	0,2

	XDEF	Height__AREA__T
Height__AREA__T
	move.l	4(a7),a0
L466
	move.w	2(a0),d0
	ext.l	d0
	rts

	SECTION "Depth__AREA__T:0",CODE

	CNOP	0,2

	XDEF	Depth__AREA__T
Depth__AREA__T
	move.l	4(a7),a0
L467
	move.w	4(a0),d0
	ext.l	d0
	rts

	SECTION "Format__AREA__T:0",CODE

	CNOP	0,2

	XDEF	Format__AREA__T
Format__AREA__T
	move.l	4(a7),a0
L468
	move.w	6(a0),d0
	ext.l	d0
	rts

	SECTION "_0dt__AREA__T:0",CODE

	CNOP	0,2

	XDEF	_0dt__AREA__T
_0dt__AREA__T
L469
	rts

	SECTION "_0dt__xTEXTURE__T:0",CODE

	CNOP	0,2

	XDEF	_0dt__xTEXTURE__T
_0dt__xTEXTURE__T
	move.l	4(a7),a0
L470
	move.l	a0,-(a7)
	jsr	Delete__xTEXTURE__T
	addq.w	#4,a7
	rts

	SECTION "_0virttab__08xTEXTURE__08xTEXTURE:0",CODE

	XDEF	_0virttab__08xTEXTURE__08xTEXTURE
_0virttab__08xTEXTURE__08xTEXTURE
	dc.l	$38,0
	dc.l	_0dt__xTEXTURE__T,0
	dc.l	Format__AREA__T,0
	dc.l	Depth__AREA__T,0
	dc.l	Height__AREA__T,0
	dc.l	Width__AREA__T,0
	dc.l	$38,0
	dc.l	_0dt__xTEXTURE__T,0

	END
