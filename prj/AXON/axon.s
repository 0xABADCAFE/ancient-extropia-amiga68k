
; Storm C Compiler
; Mendoza:Extropia/eXtropia/prj/AXON/axon.cpp
	mc68030
	mc68881
	XREF	_0dt__BUILDING__T
	XREF	Render__BUILDING__TR04VIEW
	XREF	Place__BUILDING__TRC05VEC3Dfsss
	XREF	_0dt__PINETREE__T
	XREF	Render__PINETREE__TR04VIEW
	XREF	Place__PINETREE__TRC05VEC3Dfsss
	XREF	Render__RGBCUBE__TR04VIEW
	XREF	Place__RGBCUBE__TRC05VEC3Dfsss
	XREF	Render__MODEL__TR04VIEW
	XREF	Rotate__MODEL__Tsss
	XREF	Move__MODEL__TRC05VEC3D
	XREF	Place__MODEL__TRC05VEC3Dfsss
	XREF	ClipBox__MODEL__T
	XREF	_0dt__MAPCELL__T
	XREF	Visibility__MAPCELL__TR04VIEW
	XREF	_0dt__VIEW__T
	XREF	Close__VIEW__T
	XREF	Open__VIEW__T
	XREF	MoveEvent__VIEW__T
	XREF	ResizeEvent__VIEW__T
	XREF	ExitEvent__VIEW__T
	XREF	KeyEvent__VIEW__Tjs
	XREF	MouseEvent__VIEW__Tjjj
	XREF	Done__TEXTUREHEAP_
	XREF	Init__TEXTUREHEAP__j
	XREF	op__multAsgn__TRANSFORM__TRC09TRANSFORM
	XREF	Rotate__TRANSFORM__Tfff
	XREF	Define__PLANE__TP03C3DP03C3DP03C3D
	XREF	Define__PLANE__TP05VEC3DP05VEC3DP05VEC3D
	XREF	_sqrt__r
	XREF	Delete__xTEXTURE__T
	XREF	Create__xTEXTURE__TsssPvPUj
	XREF	Close__xDBWIN__T
	XREF	Open__xDBWIN__T
	XREF	Set__xDBWIN__TsssssPCc
	XREF	Idle__xDISPLAYIO_ASYNC__T
	XREF	Done__xDISPLAYIO_ASYNC__T
	XREF	Init__xDISPLAYIO_ASYNC__T
	XREF	MoveEvent__xDISPLAYIO__T
	XREF	ResizeEvent__xDISPLAYIO__T
	XREF	Idle__xDISPLAYIO__T
	XREF	HandleEvent__xDISPLAYIO__T
	XREF	ApplyInputModification__xDISPLAYIO__T
	XREF	ViewSurface__xDISPLAY__T
	XREF	DrawSurface__xDISPLAY__T
	XREF	Refresh__xDISPLAY__T
	XREF	Close__xDISPLAY__T
	XREF	Open__xDISPLAY__T
	XREF	_0dt__xSURFACE__T
	XREF	_0dt__POOL_ST__T
	XREF	_0ct__POOL_ST__TUsUj
	XREF	FreeT__POOL_ST__TPv
	XREF	NewT__POOL_ST__TPvUs
	XREF	NewT__POOL_ST__TPv
	XREF	Create__POOL_ST__TUsUj
	XREF	PrintAlloc__POOL_ST__TR07ostreamjj
	XREF	_0dt__POOL_LT__T
	XREF	Close__xFILEIO__T
	XREF	Write__xFILEIO__TPvUiUi
	XREF	Read__xFILEIO__TPvUiUi
	XREF	Open__xFILEIO__TPCcjj
	XREF	SendPacket__xFILEIO__TPv
	XREF	WaitPacket__xFILEIO__T
	XREF	InputQueued__xINPUT__T
	XREF	Idle__xINPUT__T
	XREF	ExitEvent__xINPUT__T
	XREF	KeyEvent__xINPUT__Tjs
	XREF	MouseEvent__xINPUT__Tjjj
	XREF	ApplyInputModification__xINPUT__T
	XREF	UnLink__xCHAINABLE__T
	XREF	_0ct__xTHREADABLE__TPCcUjjs
	XREF	ShutDown__xTHREADABLE__T
	XREF	Done__xTHREADABLE__T
	XREF	Init__xTHREADABLE__T
	XREF	_0dt__xLOCKABLE__T
	XREF	FreeLock__xLOCKABLE__Ts
	XREF	WaitLock__xLOCKABLE__T
	XREF	_0dt__sysRTLIB__T
	XREF	MessageBox__sysBASELIB__PcPcPce
	XREF	_system
	XREF	op__leftshift__ostream__Td
	XREF	op__leftshift__ostream__TUj
	XREF	op__leftshift__ostream__Tj
	XREF	op__leftshift__ostream__TPCc
	XREF	op__leftshift__ostream__Tc
	XREF	opfx__ostream__T
	XREF	read__istream__TPci
	XREF	get__istream__TRc
	XREF	getline__istream__TPcic
	XREF	get__istream__TPcic
	XREF	op__rightshift__istream__TRc
	XREF	op__rightshift__istream__TPc
	XREF	doallocate__streambuf__T
	XREF	xsgetn__streambuf__TPci
	XREF	xsputn__streambuf__TPCci
	XREF	underflow__streambuf__T
	XREF	overflow__streambuf__Ti
	XREF	setbuf__streambuf__TPcUi
	XREF	sputn__streambuf__TPCci
	XREF	_0dt__streambuf__T
	XREF	userword__ios__Ti
	XREF	init__ios__TP09streambuf
	XREF	_sprintf
	XREF	_memset
	XREF	_memmove
	XREF	_strncpy
	XREF	op__delete__PvUi
	XREF	_std__in
	XREF	_std__out
	XREF	_std__err
	XREF	_basefield__ios
	XREF	_adjustfield__ios
	XREF	_floatfield__ios
	XREF	_aNextBit__ios
	XREF	_aNextWord__ios
	XREF	_cin
	XREF	_cout
	XREF	_cerr
	XREF	_clog
	XREF	_st
	XREF	_gxSt
	XREF	_errBuff__xBASELIB
	XREF	_errSev__xBASELIB
	XREF	_errTbl__xBASELIB
	XREF	_SysBase
	XREF	_IntuitionBase
	XREF	_DOSBase
	XREF	_sysData__sysBASELIB
	XREF	_msgbuff__sysBASELIB
	XREF	_main__sysBASELIB
	XREF	_allocated__MEM
	XREF	_totSize__MEM
	XREF	_nextFree__MEM
	XREF	_cnt__MEM
	XREF	_maxAllocs__MEM
	XREF	_GfxBase
	XREF	_TimerBase
	XREF	_TimerBase__xTIMABLE
	XREF	_current__xTIMABLE
	XREF	_clockFreq__xTIMABLE
	XREF	_threadCnt__xTHREADABLE
	XREF	_main__xTHREADABLE
	XREF	_CyberGfxBase
	XREF	_Warp3DBase
	XREF	_graphics__x2D
	XREF	_cyberGfx__x2D
	XREF	_formatNames__x2D
	XREF	_surfaceTypes__x2D
	XREF	_warp3D__x3D
	XREF	_hw3D__x3D
	XREF	_pointRender__x3D
	XREF	_lineRender__x3D
	XREF	_triangleRender__x3D
	XREF	_otherPrimitives__x3D
	XREF	_shadingModes__x3D
	XREF	_textureModes__x3D
	XREF	_textureFmts__x3D
	XREF	_alpha__x3D
	XREF	_fogModes__x3D
	XREF	_zBuffer__x3D
	XREF	_stencil__x3D
	XREF	_misc__x3D
	XREF	_primNames__x3D
	XREF	_renderNames__x3D
	XREF	_shadingNames__x3D
	XREF	_texModeNames__x3D
	XREF	_texFormatNames__x3D
	XREF	_alphaNames__x3D
	XREF	_fogNames__x3D
	XREF	_zBufferNames__x3D
	XREF	_stencilNames__x3D
	XREF	_miscNames__x3D
	XREF	_drawSurface__x3D
	XREF	_context__x3D
	XREF	_drawRegion__x3D
	XREF	_fogData__x3D
	XREF	_flags__xGFX
	XREF	_mode__xGFX
	XREF	_numModes__xGFX
	XREF	_rPool__xSURFACE
	XREF	_DiskfontBase
	XREF	_fontInfo__xDRAW
	XREF	_fontData__xDRAW
	XREF	_fonts__xDRAW
	XREF	_flags__xDRAW
	XREF	_flushCnt__xDRAW
	XREF	_cTab__xDRAW
	XREF	_sTab__xDRAW
	XREF	_fault__xDRAW
	XREF	_vBufPos__xDRAW
	XREF	_zDepth__xDRAW
	XREF	_maxVBufPos__xDRAW
	XREF	_vArraySize__xDRAW
	XREF	_vArray__xDRAW
	XREF	_vBuffer__xDRAW
	XREF	_nestCount__xDRAW
	XREF	_currentCol__xDRAW
	XREF	_sineData__QTRIG
	XREF	_gradData__QTRIG
	XREF	_heap__TEXTUREHEAP
	XREF	_keys__TEXTUREHEAP
	XREF	_index__TEXTUREHEAP
	XREF	_heapSize__TEXTUREHEAP
	XREF	_lastTexture__TEXTUREHEAP
	XREF	_lastKey__TEXTUREHEAP
	XREF	_dimension__WORLDMAP
	XREF	_logDim__WORLDMAP
	XREF	_fracLimit__WORLDMAP
	XREF	_worldGrid__WORLDMAP
	XREF	_minZ__WORLDMAP
	XREF	_maxZ__WORLDMAP
	XREF	_floodLevel__WORLDMAP
	XREF	_scale__WORLDMAP
	XREF	_unitName__WORLDMAP
	XREF	_detailLevel__WORLDMAP
	XREF	_cell__WORLDMAP
	XREF	_visible__WORLDMAP
	XREF	_wet__WORLDMAP
	XREF	_things__WORLDMAP
	XREF	_frames__WORLDMAP
	XREF	_frameTime__WORLDMAP
	XREF	_totalTime__WORLDMAP
	XREF	_stopWatch__WORLDMAP
	XREF	_ground__WORLDMAP
	XREF	_water__WORLDMAP
	XREF	_count__PINETREE
	XREF	_texture__PINETREE
	XREF	_points__PINETREE
	XREF	_count__BUILDING
	XREF	_texture__BUILDING
	XREF	_points__BUILDING

	SECTION "_0ct__streampos__T:0",CODE

	rts

	SECTION "_vCachePtr__AXON:1",DATA

	XDEF	_vCachePtr__AXON
_vCachePtr__AXON
	dc.l	0

	SECTION "_vCache__AXON:1",DATA

	XDEF	_vCache__AXON
_vCache__AXON
	dc.l	0

	SECTION "Init__AXON_:0",CODE


;sint32 AXON::Init()
	XDEF	Init__AXON_
Init__AXON_
	movem.l	d2-d4/a2/a6,-(a7)
L294
;	if (TEXTUREHEAP::Init(64)!=OK)
	pea	$40.w
	jsr	Init__TEXTUREHEAP__j
	addq.w	#4,a7
	tst.l	d0
	beq.b	L296
L295
;	
;		Done();
	jsr	Done__AXON_
	move.l	#-$3050005,d0
	movem.l	(a7)+,d2-d4/a2/a6
	rts
L296
;	vCache = New(vCache, VCACHESIZE);
	move.l	#$4000,d2
	moveq	#1,d3
	move.l	d2,d0
	moveq	#6,d1
	asl.l	d1,d0
	move.l	d0,d1
	addq.l	#$8,d1
	tst.l	_allocated__MEM
	bne.b	L298
L297
	sub.l	a0,a0
	bra	L312
L298
	move.w	d3,d0
	move.l	d1,d4
	move.l	_cnt__MEM,d1
	cmp.l	#$200,d1
	bne.b	L300
L299
	move.l	#L291,-(a7)
	move.l	#L292,-(a7)
	move.l	#L293,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
	move.l	#-$3010002,d0
	bra	L309
L300
	cmp.w	#1,d0
	bne.b	L302
L301
	move.l	#$10001,d1
	bra.b	L303
L302
	moveq	#1,d1
L303
	move.l	_SysBase,a6
	move.l	d4,d0
	jsr	-$2AC(a6)
	move.l	d0,a0
	cmp.w	#0,a0
	beq	L308
L304
	move.l	_nextFree__MEM,d3
	move.l	d3,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a2
	move.l	a0,0(a2,d0.l)
	move.l	_SysBase,a6
	sub.l	a1,a1
	jsr	-$126(a6)
	move.l	d3,d1
	muls.l	#$C,d1
	move.l	_allocated__MEM,a1
	move.l	d0,4(a1,d1.l)
	move.l	d3,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	d4,$8(a1,d0.l)
	add.l	d4,_totSize__MEM
	addq.l	#1,_cnt__MEM
	bra.b	L306
L305
	addq.l	#1,_nextFree__MEM
L306
	move.l	_nextFree__MEM,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	0(a1,d0.l),a0
	cmp.w	#0,a0
	bne.b	L305
L307
	move.l	d3,d0
	bra.b	L309
L308
	move.l	#-$3030001,d0
L309
	tst.l	d0
	bmi.b	L311
L310
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	0(a1,d0.l),a0
	bra.b	L312
L311
	sub.l	a0,a0
L312
	cmp.w	#0,a0
	beq.b	L317
L313
	move.l	d2,(a0)
	move.l	#$40,4(a0)
	move.l	a0,d0
	addq.l	#$8,d0
	move.l	d0,a0
	moveq	#0,d0
	bra.b	L315
L314
	addq.l	#1,d0
L315
	cmp.l	d2,d0
	blo.b	L314
L316
	bra.b	L318
L317
	sub.l	a0,a0
L318
	move.l	a0,_vCache__AXON
;	if (!vCache)
	tst.l	_vCache__AXON
	bne.b	L320
L319
;	
;		Done();
	jsr	Done__AXON_
	move.l	#-$3030001,d0
	movem.l	(a7)+,d2-d4/a2/a6
	rts
L320
	moveq	#0,d0
	movem.l	(a7)+,d2-d4/a2/a6
	rts

L293
	dc.b	'Debug',0
L291
	dc.b	'MEM::AllocIndex()',$A,'Maximum allocation reached',0
L292
	dc.b	'Proceed',0

	SECTION "Done__AXON_:0",CODE


;void AXON::Done()
	XDEF	Done__AXON_
Done__AXON_
	movem.l	d2/a2/a6,-(a7)
L327
;	if (vCache)
	tst.l	_vCache__AXON
	beq	L352
L328
;		Delete(vCache);
	move.l	_vCache__AXON,a6
	cmp.w	#0,a6
	beq	L351
L329
	move.l	a6,d0
	subq.l	#$8,d0
	move.l	d0,a2
	moveq	#0,d2
	bra.b	L333
L330
	move.l	d2,d0
	asl.l	#6,d0
	lea	0(a6,d0.l),a0
	cmp.w	#0,a0
	beq.b	L332
L331
	pea	$40.w
	move.l	a0,-(a7)
	jsr	op__delete__PvUi
	addq.w	#$8,a7
L332
	addq.l	#1,d2
L333
	move.l	a2,a0
	cmp.l	(a0),d2
	blo.b	L330
L334
	move.l	a2,a1
	tst.l	_allocated__MEM
	beq	L351
L335
	cmp.w	#0,a1
	beq	L350
L336
	moveq	#0,d0
	moveq	#0,d1
	bra.b	L338
L337
	move.l	d0,d1
	muls.l	#$C,d1
	move.l	_allocated__MEM,a2
	move.l	a1,d2
	cmp.l	0(a2,d1.l),d2
	seq	d2
	and.l	#1,d2
	move.l	d2,d1
	addq.l	#1,d0
L338
	tst.l	d1
	bne.b	L340
L339
	cmp.l	#$200,d0
	blt.b	L337
L340
	tst.l	d1
	bne.b	L342
L341
	move.l	#L321,-(a7)
	move.l	#L322,-(a7)
	move.l	#L323,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
	bra	L351
L342
	move.l	d0,d2
	subq.l	#1,d2
	cmp.l	#$200,d2
	blo.b	L344
L343
	move.l	#L324,-(a7)
	move.l	#L322,-(a7)
	move.l	#L323,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
	bra	L349
L344
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	0(a1,d0.l),a0
	cmp.w	#0,a0
	bne.b	L346
L345
	move.l	#L325,-(a7)
	move.l	#L322,-(a7)
	move.l	#L323,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
	bra	L349
L346
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	_SysBase,a6
	move.l	0(a1,d0.l),a1
	jsr	-$2B2(a6)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	move.l	_totSize__MEM,d1
	sub.l	$8(a1,d0.l),d1
	move.l	d1,_totSize__MEM
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	clr.l	0(a1,d0.l)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	clr.l	4(a1,d0.l)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	_allocated__MEM,a1
	clr.l	$8(a1,d0.l)
	subq.l	#1,_cnt__MEM
	cmp.l	_nextFree__MEM,d2
	bhs.b	L348
L347
	move.l	d2,_nextFree__MEM
L348
L349
	bra.b	L351
L350
	move.l	#L326,-(a7)
	move.l	#L322,-(a7)
	move.l	#L323,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
L351
L352
;	vCache		= 0;
	clr.l	_vCache__AXON
;	TEXTUREHEAP::Done();
	jsr	Done__TEXTUREHEAP_
	movem.l	(a7)+,d2/a2/a6
	rts

L323
	dc.b	'Debug',0
L321
	dc.b	'MEM::Free()',$A,'Address not recognised',0
L326
	dc.b	'MEM::Free()',$A,'Attempt to free null address',0
L324
	dc.b	'MEM::FreeIndex()',$A,'Index overflow',0
L325
	dc.b	'MEM::FreeIndex()',$A,'Memory already free',0
L322
	dc.b	'Proceed',0

	SECTION "TraceVec__AXON__P05VEC3DP05VEC3DP05VEC3DPP05MODEL:0",CODE


;uint32 AXON::TraceVec(VEC3D* from, VEC3D* to, VEC3D* traceEnd, MODEL
	XDEF	TraceVec__AXON__P05VEC3DP05VEC3DP05VEC3DPP05MODEL
TraceVec__AXON__P05VEC3DP05VEC3DP05VEC3DPP05MODEL
L353
	moveq	#0,d0
	rts

	SECTION "MeshToStrips__AXON__P03C3DP10W3D_Vertexj:0",CODE


;void AXON::MeshToStrips(C3D* m, sysVERTEX* v, sint32 n)
	XDEF	MeshToStrips__AXON__P03C3DP10W3D_Vertexj
MeshToStrips__AXON__P03C3DP10W3D_Vertexj
L361	EQU	-$8
	link	a5,#L361
	movem.l	d2-d6/a2-a4/a6,-(a7)
	move.l	$10(a5),d4
	move.l	$C(a5),a6
L354
;	for (rsint32 s=0;
	moveq	#0,d5
	bra	L359
L355
;	
;		for (rsint32 i=0;
	moveq	#0,d2
	bra	L357
L356
;		
;			register C3D*			mSrc = m+i;
	move.l	d2,d0
	muls.l	#$18,d0
	move.l	$8(a5),a0
	lea	0(a0,d0.l),a1
;			register sysVERTEX*	vDst = v+(i+i);
	move.l	d2,d0
	add.l	d2,d0
	asl.l	#6,d0
	lea	0(a6,d0.l),a0
;			vDst->x = mSrc->x;
	move.l	(a1),(a0)
;			vDst->y = mSrc->y;
	move.l	4(a1),4(a0)
;			vDst->z = mSrc->z;
	fmove.s	$8(a1),fp0
	fmove.d	fp0,$8(a0)
;			vDst->u = mSrc->u;
	move.l	$C(a1),$14(a0)
;			vDst->v = mSrc->v;
	move.l	$10(a1),$18(a0)
;			xDRAW::ARGBtoCol(mSrc->c, &(vDst->color));
	lea	$20(a0),a2
	move.l	$14(a1),d1
	move.l	#$FF0000,d0
	move.l	d1,d3
	and.l	d0,d3
	moveq	#$10,d6
	lsr.l	d6,d3
	move.l	#_cTab__xDRAW,a4
	move.l	0(a4,d3.l*4),(a2)+
	moveq	#$8,d3
	lsr.l	d3,d0
	move.l	d1,d3
	and.l	d0,d3
	moveq	#$8,d6
	lsr.l	d6,d3
	move.l	#_cTab__xDRAW,a4
	move.l	0(a4,d3.l*4),(a2)+
	moveq	#$8,d3
	lsr.l	d3,d0
	move.l	d1,d3
	and.l	d0,d3
	move.l	#_cTab__xDRAW,a4
	move.l	0(a4,d3.l*4),(a2)+
	moveq	#$18,d3
	asl.l	d3,d0
	and.l	d0,d1
	moveq	#$18,d0
	lsr.l	d0,d1
	move.l	#_cTab__xDRAW,a4
	move.l	0(a4,d1.l*4),(a2)
;			mSrc += (n+1);
	move.l	d4,d0
	addq.l	#1,d0
	mulu.l	#$18,d0
	add.l	d0,a1
; vDst++;
	add.w	#$40,a0
;			vDst->x = mSrc->x;
	move.l	(a1),(a0)
;			vDst->y = mSrc->y;
	move.l	4(a1),4(a0)
;			vDst->z = mSrc->z;
	fmove.s	$8(a1),fp0
	fmove.d	fp0,$8(a0)
;			vDst->u = mSrc->u;
	move.l	$C(a1),$14(a0)
;			vDst->v = mSrc->v;
	move.l	$10(a1),$18(a0)
;			xDRAW::ARGBtoCol(mSrc->c, &(vDst->color));
	add.w	#$20,a0
	move.l	$14(a1),d1
	move.l	#$FF0000,d0
	move.l	d1,d3
	and.l	d0,d3
	moveq	#$10,d6
	lsr.l	d6,d3
	move.l	#_cTab__xDRAW,a2
	move.l	0(a2,d3.l*4),(a0)+
	moveq	#$8,d3
	lsr.l	d3,d0
	move.l	d1,d3
	and.l	d0,d3
	moveq	#$8,d6
	lsr.l	d6,d3
	move.l	#_cTab__xDRAW,a2
	move.l	0(a2,d3.l*4),(a0)+
	moveq	#$8,d3
	lsr.l	d3,d0
	move.l	d1,d3
	and.l	d0,d3
	move.l	#_cTab__xDRAW,a2
	move.l	0(a2,d3.l*4),(a0)+
	moveq	#$18,d3
	asl.l	d3,d0
	and.l	d0,d1
	moveq	#$18,d0
	lsr.l	d0,d1
	move.l	#_cTab__xDRAW,a2
	move.l	0(a2,d1.l*4),(a0)
	addq.l	#1,d2
L357
	cmp.l	d4,d2
	ble	L356
L358
	addq.l	#1,d5
	move.l	d4,d0
	addq.l	#1,d0
	mulu.l	#$18,d0
	add.l	$8(a5),d0
	move.l	d0,$8(a5)
	move.l	d4,d0
	moveq	#1,d1
	asl.l	d1,d0
	addq.l	#1,d0
	moveq	#6,d1
	asl.l	d1,d0
	add.l	a6,d0
	move.l	d0,a6
L359
	cmp.l	d4,d5
	blt	L355
L360
	movem.l	(a7)+,d2-d6/a2-a4/a6
	unlk	a5
	rts

	SECTION "PushCoords__AXON__P03C3Dj:0",CODE


;sysVERTEX* AXON::PushCoords(C3D* c, sint32 n)
	XDEF	PushCoords__AXON__P03C3Dj
PushCoords__AXON__P03C3Dj
L370	EQU	-$8
	link	a5,#L370
	movem.l	d2-d4/a2/a3/a6,-(a7)
	move.l	$C(a5),d3
	move.l	$8(a5),a3
L362
;	sysVERTEX* v = Vertices(n);
	move.l	d3,d2
	move.l	_vBufPos__xDRAW,d0
	add.l	d2,d0
	cmp.l	_vArraySize__xDRAW,d0
	blo.b	L366
L363
	move.l	_context__x3D,a0
	move.l	_Warp3DBase,a6
	jsr	-$138(a6)
	move.l	_vBufPos__xDRAW,d0
	cmp.l	_maxVBufPos__xDRAW,d0
	ble.b	L365
L364
	move.l	_vBufPos__xDRAW,_maxVBufPos__xDRAW
L365
	clr.l	_vBufPos__xDRAW
	and.l	#-3,_flags__xDRAW
	addq.l	#1,_flushCnt__xDRAW
L366
	move.l	_vBufPos__xDRAW,d0
	asl.l	#6,d0
	move.l	_vBuffer__xDRAW,a1
	lea	0(a1,d0.l),a0
	add.l	d2,_vBufPos__xDRAW
	or.l	#$40,_flags__xDRAW
	move.l	a0,-4(a5)
;	
;		register sysVERTEX* vt = v;
	move.l	-4(a5),a1
; n++;
	addq.l	#1,d3
;		while(--n)
	bra	L368
L367
;		
;			vt->x = c->x;
	move.l	a3,a0
	fmove.s	(a0),fp0
	fmove.s	fp0,(a1)
;		vt->y = c->y;
	move.l	a3,a0
	move.l	4(a0),4(a1)
;		vt->z = c->z;
	move.l	a3,a0
	fmove.s	$8(a0),fp0
	fmove.d	fp0,$8(a1)
;			vt->u = c->u;
	move.l	a3,a0
	move.l	$C(a0),$14(a1)
;		vt->v = c->v;
	move.l	a3,a0
	move.l	$10(a0),$18(a1)
;			ARGBtoCol((c++)->c, &((vt++)->color));
	move.l	a1,a0
	add.w	#$40,a1
	add.w	#$20,a0
	move.l	a3,a6
	moveq	#$18,d0
	add.l	a3,d0
	move.l	d0,a3
	move.l	$14(a6),d1
	move.l	#$FF0000,d0
	move.l	d1,d2
	and.l	d0,d2
	moveq	#$10,d4
	lsr.l	d4,d2
	move.l	#_cTab__xDRAW,a2
	move.l	0(a2,d2.l*4),(a0)+
	moveq	#$8,d2
	lsr.l	d2,d0
	move.l	d1,d2
	and.l	d0,d2
	moveq	#$8,d4
	lsr.l	d4,d2
	move.l	#_cTab__xDRAW,a2
	move.l	0(a2,d2.l*4),(a0)+
	moveq	#$8,d2
	lsr.l	d2,d0
	move.l	d1,d2
	and.l	d0,d2
	move.l	#_cTab__xDRAW,a2
	move.l	0(a2,d2.l*4),(a0)+
	moveq	#$18,d2
	asl.l	d2,d0
	and.l	d0,d1
	moveq	#$18,d0
	lsr.l	d0,d1
	move.l	#_cTab__xDRAW,a2
	move.l	0(a2,d1.l*4),(a0)
L368
	subq.l	#1,d3
	tst.l	d3
	bne	L367
L369
	move.l	-4(a5),d0
	movem.l	(a7)+,d2-d4/a2/a3/a6
	unlk	a5
	rts

	END
