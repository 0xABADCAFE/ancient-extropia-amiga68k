
; Storm C Compiler
; Mendoza:Extropia/eXtropia/prj/Engine/main.cpp
	mc68030
	mc68881
	XREF	WriteText__PREFAB_EDIT__TPCc
	XREF	ReadText__PREFAB_EDIT__TPCc
	XREF	SortTriangles__PREFAB_EDIT__T
	XREF	Delete__PREFAB_EDIT__T
	XREF	Delete__PREFAB__T
	XREF	_0ct__PREFAB_BASE__T
	XREF	_0dt__DRAWLIST__T
	XREF	Delete__xTEXFONT__T
	XREF	_0ct__xTEXSURF__T
	XREF	Delete__xTEXSURF__T
	XREF	ReadBody__xTEXSURF__TR05XSFIO
	XREF	WriteBody__xTEXSURF__TR05XSFIO
	XREF	ReadyForRead__xTEXSURF__T
	XREF	ReadyForWrite__xTEXSURF__T
	XREF	_0ct__XSFOBJ__T
	XREF	Set__XSFHEAD__TPCcUcUcUcUc
	XREF	op__equal__XSFHEAD__TR05XSFIO
	XREF	op__equal__XSFHEAD__TR07XSFHEAD
	XREF	op__notEqual__XSFHEAD__TR07XSFHEAD
	XREF	Value__XDATAID__TPCc
	XREF	Refresh__xDBSCREEN__T
	XREF	Close__xDBSCREEN__T
	XREF	Open__xDBSCREEN__T
	XREF	Close__xSCREEN__T
	XREF	Open__xSCREEN__T
	XREF	Set__xSCREEN__TP06xDMODEPCc
	XREF	Close__xDBWIN__T
	XREF	Open__xDBWIN__T
	XREF	Set__xDBWIN__TsssssPCc
	XREF	MoveEvent__xDISPLAYIO__T
	XREF	ResizeEvent__xDISPLAYIO__T
	XREF	Idle__xDISPLAYIO__T
	XREF	HandleEvent__xDISPLAYIO__T
	XREF	ApplyInputModification__xDISPLAYIO__T
	XREF	ViewSurface__xDISPLAY__T
	XREF	DrawSurface__xDISPLAY__T
	XREF	Refresh__xDISPLAY__T
	XREF	Close__xDISPLAY__T
	XREF	Open__xDISPLAY__T
	XREF	Close__xFILEIO__T
	XREF	Flush__xFILEIO__T
	XREF	Write64Swap__xFILEIO__TPvUi
	XREF	Write32Swap__xFILEIO__TPvUi
	XREF	Write16Swap__xFILEIO__TPvUi
	XREF	Write__xFILEIO__TPvUiUi
	XREF	Read64Swap__xFILEIO__TPvUi
	XREF	Read32Swap__xFILEIO__TPvUi
	XREF	Read16Swap__xFILEIO__TPvUi
	XREF	Read__xFILEIO__TPvUiUi
	XREF	Tell__xFILEIO__T
	XREF	Seek__xFILEIO__Tjj
	XREF	Open__xFILEIO__TPCcjj
	XREF	SendPacket__xFILEIO__TPv
	XREF	WaitPacket__xFILEIO__T
	XREF	InputQueued__xINPUT__T
	XREF	Idle__xINPUT__T
	XREF	ExitEvent__xINPUT__T
	XREF	MouseEvent__xINPUT__Tjjj
	XREF	ApplyInputModification__xINPUT__T
	XREF	_0dt__xKEY__T
	XREF	_0ct__xKEY__T
	XREF	KeyEvent__xKEY__Tjsj
	XREF	_0dt__xSURFACE__T
	XREF	_0dt__POOL_ST__T
	XREF	_0ct__POOL_ST__TUsUj
	XREF	FreeT__POOL_ST__TPv
	XREF	NewT__POOL_ST__TPvUs
	XREF	NewT__POOL_ST__TPv
	XREF	Create__POOL_ST__TUsUj
	XREF	_0dt__POOL_LT__T
	XREF	DrawSurface__x3D__P08xSURFACE
	XREF	Rotate__TRANSFORM__Tfff
	XREF	_fabs__r
	XREF	_sqrt__r
	XREF	_acos__r
	XREF	_0dt__LOCK__T
	XREF	_0dt__THREAD__T
	XREF	Run__THREAD__T
	XREF	_0dt__DELAY__T
	XREF	_0ct__DELAY__T
	XREF	Pause__DELAY__TUj
	XREF	Pause__DELAY__TUjUj
	XREF	Abort__DELAY__T
	XREF	UnLink__xCHAINABLE__T
	XREF	Done__xBASELIB_
	XREF	Init__xBASELIB_
	XREF	_system
	XREF	_puts
	XREF	op__delete__PvUi
	XREF	op__new__Ui
	XREF	_std__in
	XREF	_std__out
	XREF	_std__err
	XREF	_st
	XREF	_gxSt
	XREF	_numStartArgs__xBASELIB
	XREF	_startArgs__xBASELIB
	XREF	_SysBase
	XREF	_IntuitionBase
	XREF	_TimerBase
	XREF	_DOSBase
	XREF	_PowerPCBase
	XREF	_sysData__sysBASELIB
	XREF	_msgbuff__sysBASELIB
	XREF	_main__sysBASELIB
	XREF	_allocated__MEM
	XREF	_totSize__MEM
	XREF	_nextFree__MEM
	XREF	_cnt__MEM
	XREF	_maxAllocs__MEM
	XREF	_fpuPrecision__CPU
	XREF	_cpuNames__CPU
	XREF	_TimerBase__MILLICLOCK
	XREF	_current__MILLICLOCK
	XREF	_clockFreq__MILLICLOCK
	XREF	_threadCnt__THREAD
	XREF	_threadsIdle__THREAD
	XREF	_rootThread__THREAD
	XREF	_GfxBase
	XREF	_CyberGfxBase
	XREF	_surfaceTypes__x2D
	XREF	_Warp3DBase
	XREF	_hw3D__sys3DDEVICE
	XREF	_context__sys3DDEVICE
	XREF	_drawRegion__x3D
	XREF	_fogData__x3D
	XREF	_flags__x3D
	XREF	_vertices__x3D
	XREF	_currTex__x3D
	XREF	_drawSurface__x3D
	XREF	_currCol__x3D
	XREF	_flags__xGFX
	XREF	_mode__xGFX
	XREF	_numModes__xGFX
	XREF	_rPool__xSURFACE
	XREF	_KeymapBase
	XREF	_useCount__xKEY
	XREF	_sigXSF__XSFHEAD
	XREF	_fileMarker__XSFOBJ
	XREF	_DiskfontBase
	XREF	_flags__DRAW
	XREF	_stack__VGPU
	XREF	_stackPos__VGPU
	XREF	_vertexBase__VGPU
	XREF	_vertexTop__VGPU
	XREF	_dataPos__VGPU
	XREF	_instPos__VGPU
	XREF	_exe_flags__VGPU
	XREF	_exe_stateReg__VGPU
	XREF	_exe_colourReg__VGPU
	XREF	_exe_texReg__VGPU
	XREF	_exe_fogReg__VGPU
	XREF	_exe_errReg__VGPU
	XREF	_funcTab__VGPU
	XREF	_qTrigTab__DRAWLIST
	XREF	_buf__PREFAB_EDIT

	SECTION "Round16__r23d:0",CODE

	rts

	SECTION "_maxTris__PREFAB_BASE:1",DATA

_maxTris__PREFAB_BASE
	dc.l	$55

	SECTION "main_:0",CODE


;int main()
	XDEF	main_
main_
	move.l	a2,-(a7)
L97
;	if (xBASELIB::Init() != OK)
	jsr	Init__xBASELIB_
	tst.l	d0
	beq.b	L99
L98
;		puts("Error initialising base library");
	move.l	#L93,-(a7)
	jsr	_puts
	addq.w	#4,a7
;		return 10;
	moveq	#$A,d0
	move.l	(a7)+,a2
	rts
L99
;	PREFAB_EDIT *test = new PREFAB_EDIT;
	pea	$2C.w
	jsr	op__new__Ui
	move.l	d0,a2
	addq.w	#4,a7
	cmp.w	#0,a2
	beq.b	L101
L100
	move.l	#_0virttab__11PREFAB_EDIT__11PREFAB_EDIT,$14(a2)
	move.l	a2,-(a7)
	jsr	_0ct__PREFAB_BASE__T
	addq.w	#4,a7
	clr.l	$18(a2)
L101
;	if (test)
	cmp.w	#0,a2
	beq.b	L105
L102
;		test->ReadText("data/test1.pfb");
	move.l	#L94,-(a7)
	move.l	a2,-(a7)
	jsr	ReadText__PREFAB_EDIT__TPCc
	addq.w	#$8,a7
;		test->SortTriangles();
	move.l	a2,-(a7)
	jsr	SortTriangles__PREFAB_EDIT__T
	addq.w	#4,a7
;		test->WriteText("ram:test.pfb");
	move.l	#L95,-(a7)
	move.l	a2,-(a7)
	jsr	WriteText__PREFAB_EDIT__TPCc
	addq.w	#$8,a7
;		delete test;
	cmp.w	#0,a2
	beq.b	L104
L103
	move.l	$14(a2),a0
	move.l	a2,d0
	add.l	$1C(a0),d0
	move.l	d0,-(a7)
	move.l	$18(a0),a0
	jsr	(a0)
	addq.w	#4,a7
	move.l	$14(a2),a0
	move.l	$10(a0),-(a7)
	move.l	$14(a0),d0
	add.l	a2,d0
	move.l	d0,-(a7)
	jsr	op__delete__PvUi
	addq.w	#$8,a7
L104
	bra.b	L106
L105
;		puts("Failed to create PREFAB");
	move.l	#L96,-(a7)
	jsr	_puts
	addq.w	#4,a7
L106
;	xBASELIB::Done();
	jsr	Done__xBASELIB_
;	return 0;
	moveq	#0,d0
	move.l	(a7)+,a2
	rts

L93
	dc.b	'Error initialising base library',0
L96
	dc.b	'Failed to create PREFAB',0
L94
	dc.b	'data/test1.pfb',0
L95
	dc.b	'ram:test.pfb',0

	SECTION "_0dt__PREFAB_EDIT__T:0",CODE

	CNOP	0,2

	XDEF	_0dt__PREFAB_EDIT__T
_0dt__PREFAB_EDIT__T
	move.l	4(a7),a0
L107
	move.l	a0,-(a7)
	jsr	Delete__PREFAB_EDIT__T
	addq.w	#4,a7
	rts

	SECTION "_0virttab__11PREFAB_EDIT__11PREFAB_EDIT:0",CODE

	XDEF	_0virttab__11PREFAB_EDIT__11PREFAB_EDIT
_0virttab__11PREFAB_EDIT__11PREFAB_EDIT
	dc.l	$2C,0
	dc.l	_0dt__PREFAB_EDIT__T,0
	dc.l	$2C,0
	dc.l	_0dt__PREFAB_EDIT__T,0

	END
