
; Storm C Compiler
; Mendoza:Extropia/eXtropia/prj/Engine/prefabutil.cpp
	mc68030
	mc68881
	XREF	_0dt__PREFAB__T
	XREF	Create__PREFAB__TUiUiUiUiUi
	XREF	Rotate__TRANSFORM__Tfff
	XREF	_fabs__r
	XREF	_sqrt__r
	XREF	_acos__r
	XREF	_0dt__DRAWLIST__T
	XREF	Delete__xTEXFONT__T
	XREF	_0ct__xTEXSURF__T
	XREF	Delete__xTEXSURF__T
	XREF	ReadBody__xTEXSURF__TR05XSFIO
	XREF	WriteBody__xTEXSURF__TR05XSFIO
	XREF	ReadyForRead__xTEXSURF__T
	XREF	ReadyForWrite__xTEXSURF__T
	XREF	_0ct__XSFOBJ__T
	XREF	Set__XSFHEAD__TPCcUcUcUcUc
	XREF	op__equal__XSFHEAD__TR05XSFIO
	XREF	op__equal__XSFHEAD__TR07XSFHEAD
	XREF	op__notEqual__XSFHEAD__TR07XSFHEAD
	XREF	Value__XDATAID__TPCc
	XREF	Refresh__xDBSCREEN__T
	XREF	Close__xDBSCREEN__T
	XREF	Open__xDBSCREEN__T
	XREF	Close__xSCREEN__T
	XREF	Open__xSCREEN__T
	XREF	Set__xSCREEN__TP06xDMODEPCc
	XREF	Close__xDBWIN__T
	XREF	Open__xDBWIN__T
	XREF	Set__xDBWIN__TsssssPCc
	XREF	MoveEvent__xDISPLAYIO__T
	XREF	ResizeEvent__xDISPLAYIO__T
	XREF	Idle__xDISPLAYIO__T
	XREF	HandleEvent__xDISPLAYIO__T
	XREF	ApplyInputModification__xDISPLAYIO__T
	XREF	ViewSurface__xDISPLAY__T
	XREF	DrawSurface__xDISPLAY__T
	XREF	Refresh__xDISPLAY__T
	XREF	Close__xDISPLAY__T
	XREF	Open__xDISPLAY__T
	XREF	_0dt__LOCK__T
	XREF	_0dt__THREAD__T
	XREF	Run__THREAD__T
	XREF	_0dt__DELAY__T
	XREF	_0ct__DELAY__T
	XREF	Pause__DELAY__TUj
	XREF	Pause__DELAY__TUjUj
	XREF	Abort__DELAY__T
	XREF	UnLink__xCHAINABLE__T
	XREF	Close__xFILEIO__T
	XREF	Flush__xFILEIO__T
	XREF	WriteText__xFILEIO__TPce
	XREF	Write64Swap__xFILEIO__TPvUi
	XREF	Write32Swap__xFILEIO__TPvUi
	XREF	Write16Swap__xFILEIO__TPvUi
	XREF	Write__xFILEIO__TPvUiUi
	XREF	ReadText__xFILEIO__TPcjcj
	XREF	Read64Swap__xFILEIO__TPvUi
	XREF	Read32Swap__xFILEIO__TPvUi
	XREF	Read16Swap__xFILEIO__TPvUi
	XREF	Read__xFILEIO__TPvUiUi
	XREF	Tell__xFILEIO__T
	XREF	Seek__xFILEIO__Tjj
	XREF	Open__xFILEIO__TPCcjj
	XREF	SendPacket__xFILEIO__TPv
	XREF	WaitPacket__xFILEIO__T
	XREF	InputQueued__xINPUT__T
	XREF	Idle__xINPUT__T
	XREF	ExitEvent__xINPUT__T
	XREF	MouseEvent__xINPUT__Tjjj
	XREF	ApplyInputModification__xINPUT__T
	XREF	_0dt__xKEY__T
	XREF	_0ct__xKEY__T
	XREF	KeyEvent__xKEY__Tjsj
	XREF	_0dt__xSURFACE__T
	XREF	_0dt__POOL_ST__T
	XREF	_0ct__POOL_ST__TUsUj
	XREF	FreeT__POOL_ST__TPv
	XREF	NewT__POOL_ST__TPvUs
	XREF	NewT__POOL_ST__TPv
	XREF	Create__POOL_ST__TUsUj
	XREF	_0dt__POOL_LT__T
	XREF	DrawSurface__x3D__P08xSURFACE
	XREF	_qsort
	XREF	_system
	XREF	_sscanf
	XREF	_printf
	XREF	_puts
	XREF	_std__in
	XREF	_std__out
	XREF	_std__err
	XREF	_st
	XREF	_gxSt
	XREF	_numStartArgs__xBASELIB
	XREF	_startArgs__xBASELIB
	XREF	_SysBase
	XREF	_IntuitionBase
	XREF	_TimerBase
	XREF	_DOSBase
	XREF	_PowerPCBase
	XREF	_sysData__sysBASELIB
	XREF	_msgbuff__sysBASELIB
	XREF	_main__sysBASELIB
	XREF	_allocated__MEM
	XREF	_totSize__MEM
	XREF	_nextFree__MEM
	XREF	_cnt__MEM
	XREF	_maxAllocs__MEM
	XREF	_fpuPrecision__CPU
	XREF	_cpuNames__CPU
	XREF	_GfxBase
	XREF	_CyberGfxBase
	XREF	_surfaceTypes__x2D
	XREF	_Warp3DBase
	XREF	_hw3D__sys3DDEVICE
	XREF	_context__sys3DDEVICE
	XREF	_drawRegion__x3D
	XREF	_fogData__x3D
	XREF	_flags__x3D
	XREF	_vertices__x3D
	XREF	_currTex__x3D
	XREF	_drawSurface__x3D
	XREF	_currCol__x3D
	XREF	_flags__xGFX
	XREF	_mode__xGFX
	XREF	_numModes__xGFX
	XREF	_rPool__xSURFACE
	XREF	_KeymapBase
	XREF	_useCount__xKEY
	XREF	_TimerBase__MILLICLOCK
	XREF	_current__MILLICLOCK
	XREF	_clockFreq__MILLICLOCK
	XREF	_threadCnt__THREAD
	XREF	_threadsIdle__THREAD
	XREF	_rootThread__THREAD
	XREF	_sigXSF__XSFHEAD
	XREF	_fileMarker__XSFOBJ
	XREF	_DiskfontBase
	XREF	_flags__DRAW
	XREF	_stack__VGPU
	XREF	_stackPos__VGPU
	XREF	_vertexBase__VGPU
	XREF	_vertexTop__VGPU
	XREF	_dataPos__VGPU
	XREF	_instPos__VGPU
	XREF	_exe_flags__VGPU
	XREF	_exe_stateReg__VGPU
	XREF	_exe_colourReg__VGPU
	XREF	_exe_texReg__VGPU
	XREF	_exe_fogReg__VGPU
	XREF	_exe_errReg__VGPU
	XREF	_funcTab__VGPU
	XREF	_qTrigTab__DRAWLIST

	SECTION "Round16__r23d:0",CODE

	rts

	SECTION "_maxTris__PREFAB:1",DATA

_maxTris__PREFAB
	dc.l	$55

	SECTION "_buf__PREFABUTIL:0",CODE


	XDEF	_INIT_8_prefabutil_cpp__buf__PREFABUTIL
_INIT_8_prefabutil_cpp__buf__PREFABUTIL
L165
;char PREFABUTIL::buf[256] = {0};
	move.l	#_buf__PREFABUTIL,a0
	lea	1(a0),a0
	move.w	#$FE,d0
L166
	clr.b	(a0)+
	dbra	d0,L166
	rts

	SECTION "_buf__PREFABUTIL:1",DATA

	XDEF	_buf__PREFABUTIL
_buf__PREFABUTIL
	dc.b	0
	ds.b	255

	SECTION "ReadTextTri__PREFABUTIL__P06PREFABUi:0",CODE


;bool PREFABUTIL::ReadTextTri(PREFAB* pfb, size_t i)
	XDEF	ReadTextTri__PREFABUTIL__P06PREFABUi
ReadTextTri__PREFABUTIL__P06PREFABUi
L218	EQU	-$2C
	link	a5,#L218
	movem.l	d2/a2,-(a7)
	move.l	$C(a5),d2
	move.l	$8(a5),a2
L176
;	if (i<0 || i>pfb->numTris)
L177
	cmp.l	(a2),d2
	bls.b	L179
L178
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts
L179
;	if (sscanf(buf+1, " { %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d }
	pea	-$2C(a5)
	pea	-$28(a5)
	pea	-$24(a5)
	pea	-$20(a5)
	pea	-$1C(a5)
	pea	-$18(a5)
	pea	-$14(a5)
	pea	-$10(a5)
	pea	-$C(a5)
	pea	-$8(a5)
	pea	-4(a5)
	move.l	#L167,-(a7)
	move.l	#_buf__PREFABUTIL,a1
	pea	1(a1)
	jsr	_sscanf
	add.w	#$34,a7
	cmp.l	#$B,d0
	beq.b	L181
L180
;		puts("Malformed triangle definition");
	move.l	#L168,-(a7)
	jsr	_puts
	addq.w	#4,a7
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts
L181
;	if (tex<0 || tex>255) 
	tst.l	-4(a5)
	bmi.b	L183
L182
	move.l	-4(a5),d0
	cmp.l	#$FF,d0
	ble.b	L184
L183
;		printf("Illegal texture index %ld\n", tex);
	move.l	-4(a5),-(a7)
	move.l	#L169,-(a7)
	jsr	_printf
	addq.w	#$8,a7
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts
L184
;	else if (v1<0 || v1>=pfb->numVerts) 
	tst.l	-$8(a5)
	bmi.b	L186
L185
	move.l	-$8(a5),d1
	cmp.l	4(a2),d1
	blt.b	L187
L186
;		printf("Illegal vertex index %ld\n", v1);
	move.l	-$8(a5),-(a7)
	move.l	#L170,-(a7)
	jsr	_printf
	addq.w	#$8,a7
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts
L187
;	else if (v2<0 || v2>=pfb->numVerts	|| v2 == v1) 
	tst.l	-$C(a5)
	bmi.b	L190
L188
	move.l	-$C(a5),d1
	cmp.l	4(a2),d1
	bge.b	L190
L189
	move.l	-$C(a5),d0
	cmp.l	-$8(a5),d0
	bne.b	L191
L190
;		printf("Illegal vertex index %ld\n", v2);
	move.l	-$C(a5),-(a7)
	move.l	#L170,-(a7)
	jsr	_printf
	addq.w	#$8,a7
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts
L191
;	else if (v3<0 || v3>=pfb->numVerts || v3 == v2 || v3 == v1) 
	tst.l	-$10(a5)
	bmi.b	L195
L192
	move.l	-$10(a5),d1
	cmp.l	4(a2),d1
	bge.b	L195
L193
	move.l	-$10(a5),d0
	cmp.l	-$C(a5),d0
	beq.b	L195
L194
	move.l	-$10(a5),d0
	cmp.l	-$8(a5),d0
	bne.b	L196
L195
;		printf("Illegal vertex index %ld\n", v3);
	move.l	-$10(a5),-(a7)
	move.l	#L170,-(a7)
	jsr	_printf
	addq.w	#$8,a7
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts
L196
;	else if (n1<0 || n1>=pfb->numVertNorms) 
	tst.l	-$14(a5)
	bmi.b	L198
L197
	move.l	-$14(a5),d1
	cmp.l	$8(a2),d1
	blt.b	L199
L198
;		printf("Illegal vertex normal index %ld\n", n1);
	move.l	-$14(a5),-(a7)
	move.l	#L171,-(a7)
	jsr	_printf
	addq.w	#$8,a7
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts
L199
;	else if (n2<0 || n2>=pfb->numVertNorms) 
	tst.l	-$18(a5)
	bmi.b	L201
L200
	move.l	-$18(a5),d1
	cmp.l	$8(a2),d1
	blt.b	L202
L201
;		printf("Illegal vertex normal index %ld\n", n2);
	move.l	-$18(a5),-(a7)
	move.l	#L171,-(a7)
	jsr	_printf
	addq.w	#$8,a7
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts
L202
;	else if (n3<0 || n3>=pfb->numVertNorms) 
	tst.l	-$1C(a5)
	bmi.b	L204
L203
	move.l	-$1C(a5),d1
	cmp.l	$8(a2),d1
	blt.b	L205
L204
;		printf("Illegal vertex normal index %ld\n", n3);
	move.l	-$1C(a5),-(a7)
	move.l	#L171,-(a7)
	jsr	_printf
	addq.w	#$8,a7
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts
L205
;	else if (fn<0 || fn>=pfb->numFaceNorms) 
	tst.l	-$20(a5)
	bmi.b	L207
L206
	move.l	-$20(a5),d1
	cmp.l	$C(a2),d1
	blt.b	L208
L207
;		printf("Illegal face normal index %ld\n", fn);
	move.l	-$20(a5),-(a7)
	move.l	#L172,-(a7)
	jsr	_printf
	addq.w	#$8,a7
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts
L208
;	else if (pc<0 || pc>=pfb->numPlaneConsts) 
	tst.l	-$24(a5)
	bmi.b	L210
L209
	move.l	-$24(a5),d1
	cmp.l	$10(a2),d1
	blt.b	L211
L210
;		printf("Illegal plane constant index %ld\n", pc);
	move.l	-$24(a5),-(a7)
	move.l	#L173,-(a7)
	jsr	_printf
	addq.w	#$8,a7
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts
L211
;	else if (solid<0 || solid>255) 
	tst.l	-$28(a5)
	bmi.b	L213
L212
	move.l	-$28(a5),d0
	cmp.l	#$FF,d0
	ble.b	L214
L213
;		printf("Illegal solid value %ld\n", solid);
	move.l	-$28(a5),-(a7)
	move.l	#L174,-(a7)
	jsr	_printf
	addq.w	#$8,a7
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts
L214
;	else if (trans<0 || trans>255) 
	tst.l	-$2C(a5)
	bmi.b	L216
L215
	move.l	-$2C(a5),d0
	cmp.l	#$FF,d0
	ble.b	L217
L216
;		printf("Illegal transparity %ld\n", trans);
	move.l	-$2C(a5),-(a7)
	move.l	#L175,-(a7)
	jsr	_printf
	addq.w	#$8,a7
;		return false;
	moveq	#0,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts
L217
;	pfb->tris[i].iTexture = tex;
	move.l	d2,d1
	muls.l	#$C,d1
	move.l	$28(a2),a0
	move.b	-1(a5),0(a0,d1.l)
;	pfb->tris[i].iVertex1 = v1;
	move.l	d2,d1
	muls.l	#$C,d1
	move.l	$28(a2),a0
	move.b	-5(a5),1(a0,d1.l)
;	pfb->tris[i].iVertex2 = v2;
	move.l	d2,d1
	muls.l	#$C,d1
	move.l	$28(a2),a0
	move.b	-$9(a5),2(a0,d1.l)
;	pfb->tris[i].iVertex3 = v3;
	move.l	d2,d1
	muls.l	#$C,d1
	move.l	$28(a2),a0
	move.b	-$D(a5),3(a0,d1.l)
;	pfb->tris[i].iVertexNorm1 = n1;
	move.l	d2,d1
	muls.l	#$C,d1
	move.l	$28(a2),a0
	move.b	-$11(a5),4(a0,d1.l)
;	pfb->tris[i].iVertexNorm2 = n2;
	move.l	d2,d1
	muls.l	#$C,d1
	move.l	$28(a2),a0
	move.b	-$15(a5),5(a0,d1.l)
;	pfb->tris[i].iVertexNorm3 = n3;
	move.l	d2,d1
	muls.l	#$C,d1
	move.l	$28(a2),a0
	move.b	-$19(a5),6(a0,d1.l)
;	pfb->tris[i].iFaceNorm = fn;
	move.l	d2,d1
	muls.l	#$C,d1
	move.l	$28(a2),a0
	move.b	-$1D(a5),7(a0,d1.l)
;	pfb->tris[i].iPlaneConst = pc;
	move.l	d2,d1
	muls.l	#$C,d1
	move.l	$28(a2),a0
	move.b	-$21(a5),$8(a0,d1.l)
;	pfb->tris[i].solid = solid;
	move.l	d2,d1
	muls.l	#$C,d1
	move.l	$28(a2),a0
	move.b	-$25(a5),$9(a0,d1.l)
;	pfb->tris[i].trans = trans;
	move.l	d2,d1
	muls.l	#$C,d1
	move.l	$28(a2),a0
	move.b	-$29(a5),$A(a0,d1.l)
;	pfb->tris[i].vis = 0;
	muls.l	#$C,d2
	move.l	$28(a2),a0
	clr.b	$B(a0,d2.l)
;	return true;
	moveq	#1,d0
	movem.l	(a7)+,d2/a2
	unlk	a5
	rts

L167
	dc.b	' { %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d }',0
L172
	dc.b	'Illegal face normal index %ld',$A,0
L173
	dc.b	'Illegal plane constant index %ld',$A,0
L174
	dc.b	'Illegal solid value %ld',$A,0
L169
	dc.b	'Illegal texture index %ld',$A,0
L175
	dc.b	'Illegal transparity %ld',$A,0
L170
	dc.b	'Illegal vertex index %ld',$A,0
L171
	dc.b	'Illegal vertex normal index %ld',$A,0
L168
	dc.b	'Malformed triangle definition',0

	SECTION "ReadTextVert__PREFABUTIL__P06PREFABUi:0",CODE


;bool PREFABUTIL::ReadTextVert(PREFAB* pfb, size_t i)
	XDEF	ReadTextVert__PREFABUTIL__P06PREFABUi
ReadTextVert__PREFABUTIL__P06PREFABUi
	move.l	$8(a7),d0
	move.l	4(a7),a0
L221
;	if (i<0 || i>pfb->numVerts)
L222
	cmp.l	4(a0),d0
	bls.b	L224
L223
;		return false;
	moveq	#0,d0
	rts
L224
;	VERTEX *v = &(pfb->vertices[i]);
	asl.l	#5,d0
	move.l	$18(a0),a0
	add.l	d0,a0
;	if (sscanf(buf+1, " { %f, %f, %f, %f, %f, %x }",
	pea	$18(a0)
	pea	$14(a0)
	pea	$10(a0)
	pea	$8(a0)
	pea	4(a0)
	move.l	a0,-(a7)
	move.l	#L219,-(a7)
	move.l	#_buf__PREFABUTIL,a1
	pea	1(a1)
	jsr	_sscanf
	add.w	#$20,a7
	cmp.l	#6,d0
	beq.b	L226
L225
;		puts("Malformed vertex definition");
	move.l	#L220,-(a7)
	jsr	_puts
	addq.w	#4,a7
;		return false;
	moveq	#0,d0
	rts
L226
;	return true;
	moveq	#1,d0
	rts

L219
	dc.b	' { %f, %f, %f, %f, %f, %x }',0
L220
	dc.b	'Malformed vertex definition',0

	SECTION "ReadTextVNorm__PREFABUTIL__P06PREFABUi:0",CODE


;bool PREFABUTIL::ReadTextVNorm(PREFAB* pfb, size_t i)
	XDEF	ReadTextVNorm__PREFABUTIL__P06PREFABUi
ReadTextVNorm__PREFABUTIL__P06PREFABUi
	move.l	a2,-(a7)
	fmovem.x fp2,-(a7)
	move.l	$18(a7),d0
	move.l	$14(a7),a0
L230
;	if (i<0 || i>pfb->numVertNorms)
L231
	cmp.l	$8(a0),d0
	bls.b	L233
L232
;		return false;
	moveq	#0,d0
	fmovem.x (a7)+,fp2
	move.l	(a7)+,a2
	rts
L233
;	VEC3D *v = &(pfb->vertNorms[i]);
	muls.l	#$C,d0
	move.l	$1C(a0),a0
	lea	0(a0,d0.l),a2
;	if (sscanf(buf+1, " { %f, %f, %f }", &(v->x), &(v->y), &(v->z))!=3)
	pea	$8(a2)
	pea	4(a2)
	move.l	a2,-(a7)
	move.l	#L227,-(a7)
	move.l	#_buf__PREFABUTIL,a1
	pea	1(a1)
	jsr	_sscanf
	add.w	#$14,a7
	cmp.l	#3,d0
	beq.b	L235
L234
;		puts("Malformed normal definition");
	move.l	#L228,-(a7)
	jsr	_puts
	addq.w	#4,a7
;		return false;
	moveq	#0,d0
	fmovem.x (a7)+,fp2
	move.l	(a7)+,a2
	rts
L235
;	float32 len = v->Magnitude();
	move.l	a2,a0
	fmove.s	(a0),fp0
	fmul.s	(a0),fp0
	fmove.s	4(a0),fp1
	fmul.s	4(a0),fp1
	fadd.x	fp1,fp0
	fmove.s	$8(a0),fp1
	fmul.s	$8(a0),fp1
	fadd.x	fp1,fp0
	fmove.d	fp0,-(a7)
	jsr	_sqrt__r
	addq.w	#$8,a7
	fmove.x	fp0,fp2
;	if (FloatCompare(len, 1.0)==false)
	fmove.x	fp2,fp0
	fsub.d	#$.3FF00000.00000000,fp0
	fmove.d	fp0,-(a7)
	jsr	_fabs__r
	addq.w	#$8,a7
	fcmp.d	#$.3F1A36E2.C0000000,fp0
	fbole.b	L237
L236
	moveq	#0,d0
	bra.b	L238
L237
	moveq	#1,d0
L238
	tst.w	d0
	bne.b	L240
L239
;		printf("Normal has erronious magnitude %8.5f, renormalizing\n", 
	fmove.x	fp2,fp0
	fmove.d	fp0,-(a7)
	move.l	#L229,-(a7)
	jsr	_printf
	add.w	#$C,a7
;		(*v) /= len;
	move.l	a2,a0
	fmove.s	#$.3F800000,fp0
	fdiv.x	fp2,fp0
	fmove.s	(a0),fp1
	fmul.x	fp0,fp1
	fmove.s	fp1,(a0)
	fmove.s	4(a0),fp1
	fmul.x	fp0,fp1
	fmove.s	fp1,4(a0)
	fmove.s	$8(a0),fp1
	fmul.x	fp0,fp1
	fmove.s	fp1,$8(a0)
L240
;	return true;
	moveq	#1,d0
	fmovem.x (a7)+,fp2
	move.l	(a7)+,a2
	rts

L227
	dc.b	' { %f, %f, %f }',0
L228
	dc.b	'Malformed normal definition',0
L229
	dc.b	'Normal has erronious magnitude %8.5f, renormalizing',$A,0

	SECTION "ReadTextFNorm__PREFABUTIL__P06PREFABUi:0",CODE


;bool PREFABUTIL::ReadTextFNorm(PREFAB* pfb, size_t i)
	XDEF	ReadTextFNorm__PREFABUTIL__P06PREFABUi
ReadTextFNorm__PREFABUTIL__P06PREFABUi
	move.l	$8(a7),d0
	move.l	4(a7),a0
L243
;	if (i<0 || i>pfb->numFaceNorms)
L244
	cmp.l	$C(a0),d0
	bls.b	L246
L245
;		return false;
	moveq	#0,d0
	rts
L246
;	VEC3D *v = &(pfb->vertNorms[i]);
	muls.l	#$C,d0
	move.l	$1C(a0),a0
	add.l	d0,a0
;	if (sscanf(buf+1, " { %f, %f, %f }", &(v->x), &(v->y), &(v->z))!=3)
	pea	$8(a0)
	pea	4(a0)
	move.l	a0,-(a7)
	move.l	#L241,-(a7)
	move.l	#_buf__PREFABUTIL,a1
	pea	1(a1)
	jsr	_sscanf
	add.w	#$14,a7
	cmp.l	#3,d0
	beq.b	L248
L247
;		puts("Malformed normal definition");
	move.l	#L242,-(a7)
	jsr	_puts
	addq.w	#4,a7
;		return false;
	moveq	#0,d0
	rts
L248
;	return true;
	moveq	#1,d0
	rts

L241
	dc.b	' { %f, %f, %f }',0
L242
	dc.b	'Malformed normal definition',0

	SECTION "ReadTextPConst__PREFABUTIL__P06PREFABUi:0",CODE


;bool PREFABUTIL::ReadTextPConst(PREFAB* pfb, size_t i)
	XDEF	ReadTextPConst__PREFABUTIL__P06PREFABUi
ReadTextPConst__PREFABUTIL__P06PREFABUi
	move.l	$8(a7),d0
	move.l	4(a7),a0
L251
;	if (i<0 || i>pfb->numPlaneConsts)
L252
	cmp.l	$10(a0),d0
	bls.b	L254
L253
;		return false;
	moveq	#0,d0
	rts
L254
;	float32 *f = &(pfb->planeConsts[i]);
	move.l	$24(a0),a0
;	if (sscanf(buf+1, " %f", f)!=1)
	pea	0(a0,d0.l*4)
	move.l	#L249,-(a7)
	move.l	#_buf__PREFABUTIL,a1
	pea	1(a1)
	jsr	_sscanf
	add.w	#$C,a7
	cmp.l	#1,d0
	beq.b	L256
L255
;		puts("Malformed plane constant");
	move.l	#L250,-(a7)
	jsr	_puts
	addq.w	#4,a7
;		return false;
	moveq	#0,d0
	rts
L256
;	return true;
	moveq	#1,d0
	rts

L249
	dc.b	' %f',0
L250
	dc.b	'Malformed plane constant',0

	SECTION "ReadText__PREFABUTIL__P06PREFABPCc:0",CODE


;sint32 PREFABUTIL::ReadText(PREFAB* pfb, const char* fileName)
	XDEF	ReadText__PREFABUTIL__P06PREFABPCc
ReadText__PREFABUTIL__P06PREFABPCc
L307	EQU	-$BC
	link	a5,#L307
	movem.l	d2-d7/a2/a3,-(a7)
	move.l	$C(a5),a1
	move.l	$8(a5),a2
L265
;	if (!pfb || !fileName)
	cmp.w	#0,a2
	beq.b	L267
L266
	cmp.w	#0,a1
	bne.b	L268
L267
;		return ERR_PTR_ZERO;
	move.l	#-$3020002,d0
	movem.l	(a7)+,d2-d7/a2/a3
	unlk	a5
	rts
L268
;	xFILEIO file(fileName, xIOS::READTEXT);
	lea	-$9A(a5),a0
	clr.l	(a0)
	clr.l	$96(a0)
	pea	$400.w
	pea	1.w
	move.l	a1,-(a7)
	move.l	a0,-(a7)
	jsr	Open__xFILEIO__TPCcjj
	add.w	#$10,a7
;	if (file.Valid()==false)
	move.l	-4(a5),d0
	and.l	#$40,d0
	tst.w	d0
	bne.b	L270
L269
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	move.l	#-$304000B,d0
	movem.l	(a7)+,d2-d7/a2/a3
	unlk	a5
	rts
L270
;		sint32 nTris = -1;
	move.l	#-1,-$9E(a5)
;		sint32 nVerts = -1;
	move.l	#-1,-$A2(a5)
;		sint32 nVNorms = -1;
	move.l	#-1,-$A6(a5)
;		sint32 nFNorms = -1;
	move.l	#-1,-$AA(a5)
;		sint32 nPConsts = -1;
	move.l	#-1,-$AE(a5)
;		file.ReadText(buf, 255, '\n', 1);
	pea	1.w
	move.b	#$A,-(a7)
	pea	$FF.w
	move.l	#_buf__PREFABUTIL,-(a7)
	pea	-$9A(a5)
	jsr	ReadText__xFILEIO__TPcjcj
	add.w	#$12,a7
;		if (sscanf(buf, "PrefabDef %ld, %ld, %ld, %ld, %ld", \
	pea	-$AE(a5)
	pea	-$AA(a5)
	pea	-$A6(a5)
	pea	-$A2(a5)
	pea	-$9E(a5)
	move.l	#L257,-(a7)
	move.l	#_buf__PREFABUTIL,-(a7)
	jsr	_sscanf
	add.w	#$1C,a7
	cmp.l	#5,d0
	beq.b	L272
L271
;			puts("PREFABUTIL::ReadText() - [error] invalid prefab definiti
	move.l	#L258,-(a7)
	jsr	_puts
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#-1,d0
	movem.l	(a7)+,d2-d7/a2/a3
	unlk	a5
	rts
L272
;		if (pfb->Create(nTris, nVerts, nVNorms, nFNorms, nPConsts)!=OK)
	move.l	-$AE(a5),-(a7)
	move.l	-$AA(a5),-(a7)
	move.l	-$A6(a5),-(a7)
	move.l	-$A2(a5),-(a7)
	move.l	-$9E(a5),-(a7)
	move.l	a2,-(a7)
	jsr	Create__PREFAB__TUiUiUiUiUi
	add.w	#$18,a7
	tst.l	d0
	beq.b	L274
L273
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#-1,d0
	movem.l	(a7)+,d2-d7/a2/a3
	unlk	a5
	rts
L274
;		if (pfb->numTris==0) // null prefab
	tst.l	(a2)
	bne.b	L276
L275
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d7/a2/a3
	unlk	a5
	rts
L276
;	sint32 line					= 1;
	move.l	#1,-$9E(a5)
;	sint32 trisRead			= 0;
	moveq	#0,d6
;	sint32 vertsRead		= 0;
	moveq	#0,d5
;	sint32 vNormsRead		= 0;
	moveq	#0,d4
;	sint32 fNormsRead		= 0;
	moveq	#0,d3
;	sint32 pConstsRead	= 0;
	moveq	#0,d2
;	bool endDef					= false;
	moveq	#0,d7
;	while(file.EndOfFile()==false && endDef==false)
	bra	L304
L277
;		if (file.ReadText(buf, 255, '\n', 1)>0)
	pea	1.w
	move.b	#$A,-(a7)
	pea	$FF.w
	move.l	#_buf__PREFABUTIL,-(a7)
	pea	-$9A(a5)
	jsr	ReadText__xFILEIO__TPcjcj
	add.w	#$12,a7
	cmp.l	#0,d0
	ble	L303
L278
;			line++;
	addq.l	#1,-$9E(a5)
;			switch(buf[0])
	move.l	#_buf__PREFABUTIL,a0
	move.b	(a0),d0
	cmp.b	#$54,d0
	beq	L279
	bgt.b	L308
	cmp.b	#$3B,d0
	beq	L299
	bgt.b	L309
	cmp.b	#$D,d0
	beq	L299
	bgt.b	L310
	cmp.b	#$A,d0
	beq	L299
	bra	L301
L310
	cmp.b	#$23,d0
	beq	L300
	bra	L301
L309
	cmp.b	#$4E,d0
	beq	L287
	bgt.b	L311
	cmp.b	#$46,d0
	beq	L291
	bra	L301
L311
	cmp.b	#$50,d0
	beq	L295
	bra	L301
L308
	cmp.b	#$70,d0
	beq	L295
	bgt.b	L312
	cmp.b	#$66,d0
	beq	L291
	bgt.b	L313
	cmp.b	#$56,d0
	beq.b	L283
	bra	L301
L313
	cmp.b	#$6E,d0
	beq.b	L287
	bra	L301
L312
	cmp.b	#$74,d0
	beq.b	L279
	cmp.b	#$76,d0
	beq.b	L283
	bra	L301
;				
L279
;					if (trisRead < pfb->numTris) 
	move.l	d6,d1
	cmp.l	(a2),d1
	bge.b	L282
L280
;						if (ReadTextTri(pfb, trisRead)==true)
	move.l	d6,-(a7)
	move.l	a2,-(a7)
	jsr	ReadTextTri__PREFABUTIL__P06PREFABUi
	addq.w	#$8,a7
	cmp.w	#1,d0
	bne.b	L282
L281
;							trisRead++;
	move.l	d6,d0
	addq.l	#1,d0
	move.l	d0,d6
L282
;					
	bra	L302
L283
;					if (vertsRead < pfb->numVerts) 
	cmp.l	4(a2),d5
	bge.b	L286
L284
;						if (ReadTextVert(pfb, vertsRead)==true)
	move.l	d5,-(a7)
	move.l	a2,-(a7)
	jsr	ReadTextVert__PREFABUTIL__P06PREFABUi
	addq.w	#$8,a7
	cmp.w	#1,d0
	bne.b	L286
L285
;							vertsRead++;
	addq.l	#1,d5
L286
;					
	bra	L302
L287
;					if (vNormsRead < pfb->numVertNorms) 
	cmp.l	$8(a2),d4
	bge.b	L290
L288
;						if (ReadTextVNorm(pfb, vNormsRead)==true)
	move.l	d4,-(a7)
	move.l	a2,-(a7)
	jsr	ReadTextVNorm__PREFABUTIL__P06PREFABUi
	addq.w	#$8,a7
	cmp.w	#1,d0
	bne.b	L290
L289
;							vNormsRead++;
	addq.l	#1,d4
L290
;					
	bra.b	L302
L291
;					if (fNormsRead < pfb->numFaceNorms) 
	cmp.l	$C(a2),d3
	bge.b	L294
L292
;						if (ReadTextFNorm(pfb, fNormsRead)==true)
	move.l	d3,-(a7)
	move.l	a2,-(a7)
	jsr	ReadTextFNorm__PREFABUTIL__P06PREFABUi
	addq.w	#$8,a7
	cmp.w	#1,d0
	bne.b	L294
L293
;							fNormsRead++;
	addq.l	#1,d3
L294
;					
	bra.b	L302
L295
;					if (pConstsRead < pfb->numPlaneConsts) 
	cmp.l	$10(a2),d2
	bge.b	L298
L296
;						if (ReadTextPConst(pfb, pConstsRead)==true)
	move.l	d2,-(a7)
	move.l	a2,-(a7)
	jsr	ReadTextPConst__PREFABUTIL__P06PREFABUi
	addq.w	#$8,a7
	cmp.w	#1,d0
	bne.b	L298
L297
;							pConstsRead++;
	addq.l	#1,d2
L298
;					
	bra.b	L302
L299
;					
	bra.b	L302
L300
;					endDef = true;
	moveq	#1,d7
;					
	bra.b	L302
L301
;					printf("Warning : unknown token '%c' on line %ld\n", buf[0
	move.l	-$9E(a5),-(a7)
	move.l	#_buf__PREFABUTIL,a0
	move.b	(a0),d0
	extb.l	d0
	move.l	d0,-(a7)
	move.l	#L259,-(a7)
	jsr	_printf
	add.w	#$C,a7
;					
L302
	bra.b	L304
L303
;			endDef = true;
	moveq	#1,d7
L304
	move.l	-4(a5),d0
	and.l	#$10,d0
	tst.w	d0
	bne.b	L306
L305
	tst.w	d7
	beq	L277
L306
;	file.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
;	printf("Read %d / %d triangles\n", trisRead, pfb->numTris);
	move.l	(a2),-(a7)
	move.l	d6,-(a7)
	move.l	#L260,-(a7)
	jsr	_printf
	add.w	#$C,a7
;	printf("Read %d / %d vertices\n", vertsRead, pfb->numVerts);
	move.l	4(a2),-(a7)
	move.l	d5,-(a7)
	move.l	#L261,-(a7)
	jsr	_printf
	add.w	#$C,a7
;	printf("Read %d / %d vertex normals\n", vNormsRead, pfb->numVertNo
	move.l	$8(a2),-(a7)
	move.l	d4,-(a7)
	move.l	#L262,-(a7)
	jsr	_printf
	add.w	#$C,a7
;	printf("Read %d / %d face normals\n", fNormsRead, pfb->numFaceNorm
	move.l	$C(a2),-(a7)
	move.l	d3,-(a7)
	move.l	#L263,-(a7)
	jsr	_printf
	add.w	#$C,a7
;	printf("Read %d / %d plane consts\n", pConstsRead, pfb->numPlaneCo
	move.l	$10(a2),-(a7)
	move.l	d2,-(a7)
	move.l	#L264,-(a7)
	jsr	_printf
	add.w	#$C,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2-d7/a2/a3
	unlk	a5
	rts

L258
	dc.b	'PREFABUTIL::ReadText() - [error] invalid prefab definition',0
L257
	dc.b	'PrefabDef %ld, %ld, %ld, %ld, %ld',0
L263
	dc.b	'Read %d / %d face normals',$A,0
L264
	dc.b	'Read %d / %d plane consts',$A,0
L260
	dc.b	'Read %d / %d triangles',$A,0
L262
	dc.b	'Read %d / %d vertex normals',$A,0
L261
	dc.b	'Read %d / %d vertices',$A,0
L259
	dc.b	'Warning : unknown token '%c' on line %ld',$A,0

	SECTION "WriteText__PREFABUTIL__P06PREFABPCc:0",CODE


;sint32 PREFABUTIL::WriteText(PREFAB* pfb, const char* fileName)
	XDEF	WriteText__PREFABUTIL__P06PREFABPCc
WriteText__PREFABUTIL__P06PREFABPCc
L347	EQU	-$A4
	link	a5,#L347
	movem.l	d2/a2/a3,-(a7)
	move.l	$C(a5),a1
	move.l	$8(a5),a2
L326
;	if (!pfb || !fileName)
	cmp.w	#0,a2
	beq.b	L328
L327
	cmp.w	#0,a1
	bne.b	L329
L328
;		return ERR_PTR_ZERO;
	move.l	#-$3020002,d0
	movem.l	(a7)+,d2/a2/a3
	unlk	a5
	rts
L329
;	xFILEIO file(fileName, xIOS::WRITETEXT);
	lea	-$9A(a5),a0
	clr.l	(a0)
	clr.l	$96(a0)
	pea	$400.w
	pea	2.w
	move.l	a1,-(a7)
	move.l	a0,-(a7)
	jsr	Open__xFILEIO__TPCcjj
	add.w	#$10,a7
;	if (file.Valid()==false)
	move.l	-4(a5),d0
	and.l	#$40,d0
	tst.w	d0
	bne.b	L331
L330
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	move.l	#-$304000B,d0
	movem.l	(a7)+,d2/a2/a3
	unlk	a5
	rts
L331
;	file.WriteText("PrefabDef %ld, %ld, %ld, %ld, %ld\n",
	move.l	$10(a2),-(a7)
	move.l	$C(a2),-(a7)
	move.l	$8(a2),-(a7)
	move.l	4(a2),-(a7)
	move.l	(a2),-(a7)
	move.l	#L314,-(a7)
	pea	-$9A(a5)
	jsr	WriteText__xFILEIO__TPce
	add.w	#$1C,a7
;	file.WriteText("\n; Triangles [%d]\n", pfb->numTris);
	move.l	(a2),-(a7)
	move.l	#L315,-(a7)
	pea	-$9A(a5)
	jsr	WriteText__xFILEIO__TPce
	add.w	#$C,a7
;	for (i=0;
	moveq	#0,d2
	bra	L333
L332
;		file.WriteText("t { %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d }
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$28(a2),a0
	move.b	$A(a0,d0.l),d0
	and.l	#$FF,d0
	move.l	d0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$28(a2),a0
	move.b	$9(a0,d0.l),d0
	and.l	#$FF,d0
	move.l	d0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$28(a2),a0
	move.b	$8(a0,d0.l),d0
	and.l	#$FF,d0
	move.l	d0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$28(a2),a0
	move.b	7(a0,d0.l),d0
	and.l	#$FF,d0
	move.l	d0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$28(a2),a0
	move.b	6(a0,d0.l),d0
	and.l	#$FF,d0
	move.l	d0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$28(a2),a0
	move.b	5(a0,d0.l),d0
	and.l	#$FF,d0
	move.l	d0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$28(a2),a0
	move.b	4(a0,d0.l),d0
	and.l	#$FF,d0
	move.l	d0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$28(a2),a0
	move.b	3(a0,d0.l),d0
	and.l	#$FF,d0
	move.l	d0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$28(a2),a0
	move.b	2(a0,d0.l),d0
	and.l	#$FF,d0
	move.l	d0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$28(a2),a0
	move.b	1(a0,d0.l),d0
	and.l	#$FF,d0
	move.l	d0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$28(a2),a0
	move.b	0(a0,d0.l),d0
	and.l	#$FF,d0
	move.l	d0,-(a7)
	move.l	#L316,-(a7)
	pea	-$9A(a5)
	jsr	WriteText__xFILEIO__TPce
	add.w	#$34,a7
	addq.l	#1,d2
L333
	cmp.l	(a2),d2
	blt	L332
L334
;	file.WriteText("\n; Vertices [%d]\n", pfb->numVerts);
	move.l	4(a2),-(a7)
	move.l	#L317,-(a7)
	pea	-$9A(a5)
	jsr	WriteText__xFILEIO__TPce
	add.w	#$C,a7
;	for (i=0;
	moveq	#0,d2
	bra	L336
L335
;		file.WriteText("v { %10.6f, %10.6f, %10.6f, %10.6f, %10.6f, 0x%0
	move.l	d2,d0
	asl.l	#5,d0
	move.l	$18(a2),a0
	lea	0(a0,d0.l),a0
	move.l	$18(a0),-(a7)
	move.l	d2,d0
	asl.l	#5,d0
	move.l	$18(a2),a0
	fmove.s	$14(a0,d0.l),fp0
	fmove.d	fp0,-(a7)
	move.l	d2,d0
	asl.l	#5,d0
	move.l	$18(a2),a0
	fmove.s	$10(a0,d0.l),fp0
	fmove.d	fp0,-(a7)
	move.l	d2,d0
	asl.l	#5,d0
	move.l	$18(a2),a0
	fmove.s	$8(a0,d0.l),fp0
	fmove.d	fp0,-(a7)
	move.l	d2,d0
	asl.l	#5,d0
	move.l	$18(a2),a0
	fmove.s	4(a0,d0.l),fp0
	fmove.d	fp0,-(a7)
	move.l	d2,d0
	asl.l	#5,d0
	move.l	$18(a2),a0
	fmove.s	0(a0,d0.l),fp0
	fmove.d	fp0,-(a7)
	move.l	#L318,-(a7)
	pea	-$9A(a5)
	jsr	WriteText__xFILEIO__TPce
	add.w	#$34,a7
	addq.l	#1,d2
L336
	cmp.l	4(a2),d2
	blt	L335
L337
;	file.WriteText("\n; Vertex Normals [%d]\n", pfb->numVertNorms);
	move.l	$8(a2),-(a7)
	move.l	#L319,-(a7)
	pea	-$9A(a5)
	jsr	WriteText__xFILEIO__TPce
	add.w	#$C,a7
;	for (i=0;
	moveq	#0,d2
	bra.b	L339
L338
;		file.WriteText("n { %8.6f, %8.6f, %8.6f }\n",
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$1C(a2),a0
	fmove.s	$8(a0,d0.l),fp0
	fmove.d	fp0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$1C(a2),a0
	fmove.s	4(a0,d0.l),fp0
	fmove.d	fp0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$1C(a2),a0
	fmove.s	0(a0,d0.l),fp0
	fmove.d	fp0,-(a7)
	move.l	#L320,-(a7)
	pea	-$9A(a5)
	jsr	WriteText__xFILEIO__TPce
	add.w	#$20,a7
	addq.l	#1,d2
L339
	cmp.l	$8(a2),d2
	blt.b	L338
L340
;	file.WriteText("\n; Face Normals [%d]\n", pfb->numFaceNorms);
	move.l	$C(a2),-(a7)
	move.l	#L321,-(a7)
	pea	-$9A(a5)
	jsr	WriteText__xFILEIO__TPce
	add.w	#$C,a7
;	for (i=0;
	moveq	#0,d2
	bra.b	L342
L341
;		file.WriteText("f { %8.6f, %8.6f, %8.6f }\n",
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$20(a2),a0
	fmove.s	$8(a0,d0.l),fp0
	fmove.d	fp0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$20(a2),a0
	fmove.s	4(a0,d0.l),fp0
	fmove.d	fp0,-(a7)
	move.l	d2,d0
	muls.l	#$C,d0
	move.l	$20(a2),a0
	fmove.s	0(a0,d0.l),fp0
	fmove.d	fp0,-(a7)
	move.l	#L322,-(a7)
	pea	-$9A(a5)
	jsr	WriteText__xFILEIO__TPce
	add.w	#$20,a7
	addq.l	#1,d2
L342
	cmp.l	$C(a2),d2
	blt.b	L341
L343
;	file.WriteText("\n; Plane Constants [%d]\n", pfb->numPlaneConsts);
	move.l	$10(a2),-(a7)
	move.l	#L323,-(a7)
	pea	-$9A(a5)
	jsr	WriteText__xFILEIO__TPce
	add.w	#$C,a7
;	for (i=0;
	moveq	#0,d2
	bra.b	L345
L344
;		file.WriteText("p %10.6f\n", pfb->planeConsts[i]);
	move.l	$24(a2),a0
	fmove.s	0(a0,d2.l*4),fp0
	fmove.d	fp0,-(a7)
	move.l	#L324,-(a7)
	pea	-$9A(a5)
	jsr	WriteText__xFILEIO__TPce
	add.w	#$10,a7
	addq.l	#1,d2
L345
	cmp.l	$10(a2),d2
	blt.b	L344
L346
;	file.WriteText("\n#\n; end of prefab definition\n");
	move.l	#L325,-(a7)
	pea	-$9A(a5)
	jsr	WriteText__xFILEIO__TPce
	addq.w	#$8,a7
;	file.Close();
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	pea	-$9A(a5)
	jsr	Close__xFILEIO__T
	addq.w	#4,a7
	moveq	#0,d0
	movem.l	(a7)+,d2/a2/a3
	unlk	a5
	rts

L325
	dc.b	$A,'#',$A,'; end of prefab definition',$A,0
L321
	dc.b	$A,'; Face Normals [%d]',$A,0
L323
	dc.b	$A,'; Plane Constants [%d]',$A,0
L315
	dc.b	$A,'; Triangles [%d]',$A,0
L319
	dc.b	$A,'; Vertex Normals [%d]',$A,0
L317
	dc.b	$A,'; Vertices [%d]',$A,0
L314
	dc.b	'PrefabDef %ld, %ld, %ld, %ld, %ld',$A,0
L322
	dc.b	'f { %8.6f, %8.6f, %8.6f }',$A,0
L320
	dc.b	'n { %8.6f, %8.6f, %8.6f }',$A,0
L324
	dc.b	'p %10.6f',$A,0
L316
	dc.b	't { %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d }',$A,0
L318
	dc.b	'v { %10.6f, %10.6f, %10.6f, %10.6f, %10.6f, 0x%08x }',$A,0

	SECTION "CompareTris__PCvPCv:0",CODE


;int CompareTris(const void* a, const void* b)
	XDEF	CompareTris__PCvPCv
CompareTris__PCvPCv
	move.l	$8(a7),a0
	move.l	4(a7),a1
L348
;	PREFAB::TRIDEF* t1 = (PREFAB::TRIDEF*)a;
;	PREFAB::TRIDEF* t2 = (PREFAB::TRIDEF*)b;
;	if (t1->trans == t2->trans)
	move.b	$A(a1),d1
	cmp.b	$A(a0),d1
	bne.b	L350
L349
;		return ((int)(t1->iTexture)) - ((int)(t2->iTexture));
	moveq	#0,d0
	move.b	(a1),d0
	moveq	#0,d1
	move.b	(a0),d1
	sub.l	d1,d0
	rts
L350
;		return ((int)(t1->trans)) - ((int)(t2->trans));
	moveq	#0,d0
	move.b	$A(a1),d0
	moveq	#0,d1
	move.b	$A(a0),d1
	sub.l	d1,d0
	rts

	SECTION "SortTriangles__PREFABUTIL__P06PREFAB:0",CODE


;sint32 PREFABUTIL::SortTriangles(PREFAB* pfb)
	XDEF	SortTriangles__PREFABUTIL__P06PREFAB
SortTriangles__PREFABUTIL__P06PREFAB
	move.l	4(a7),a0
L351
;	if (!pfb || !pfb->tris || pfb->numTris<2)
	cmp.w	#0,a0
	beq.b	L354
L352
	tst.l	$28(a0)
	beq.b	L354
L353
	move.l	(a0),d0
	cmp.l	#2,d0
	bhs.b	L355
L354
;		return ERR_PTR_ZERO;
	move.l	#-$3020002,d0
	rts
L355
;	qsort(pfb->tris, pfb->numTris, sizeof(PREFAB::TRIDEF), CompareTris)
	move.l	#CompareTris__PCvPCv,-(a7)
	pea	$C.w
	move.l	(a0),-(a7)
	move.l	$28(a0),-(a7)
	jsr	_qsort
	add.w	#$10,a7
;	return OK;
	moveq	#0,d0
	rts

	END
