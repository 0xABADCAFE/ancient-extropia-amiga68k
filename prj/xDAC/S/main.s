
; Storm C Compiler
; Developer:eXtropia/eXtropiaOld/prj/xDAC/main.cpp
	mc68030
	mc68881
	XREF	Done__APP_
	XREF	Init__APP__PCcPCcjjs
	XREF	ViewRender__DRAWFRAME__T
	XREF	ViewClear__DRAWFRAME__T
	XREF	ViewDefine__DRAWFRAME__Tssss
	XREF	ViewRender__DRAWWAVE__T
	XREF	ViewClear__DRAWWAVE__T
	XREF	ViewDefine__DRAWWAVE__Tssss
	XREF	_0dt__APPWINDOW__T
	XREF	Refresh__APPWINDOW__T
	XREF	Close__APPWINDOW__T
	XREF	Open__APPWINDOW__T
	XREF	MoveEvent__APPWINDOW__T
	XREF	ResizeEvent__APPWINDOW__T
	XREF	ExitEvent__APPWINDOW__T
	XREF	KeyEvent__APPWINDOW__Tjsj
	XREF	MouseEvent__APPWINDOW__Tjjj
	XREF	Save__AIFF__TPCc
	XREF	Load__AIFF__TPCc
	XREF	_0dt__XDACCODEC__T
	XREF	ReadBody__XDAC__TR05XSFIO
	XREF	WriteBody__XDAC__TR05XSFIO
	XREF	_0dt__XDACENCODE__T
	XREF	op__minusminus__XDACENCODE__Ti
	XREF	op__Cplusplus__XDACENCODE__Ti
	XREF	Last__XDACENCODE__T
	XREF	First__XDACENCODE__T
	XREF	Size__XDACENCODE__Ts
	XREF	Set__XDACENCODE__TR03PCMsss
	XREF	Analyse__XDACENCODE__T
	XREF	FreeSpace__XDACENCODE__T
	XREF	_0dt__DRAWLIST__T
	XREF	Delete__xTEXFONT__T
	XREF	_0ct__xTEXSURF__T
	XREF	Delete__xTEXSURF__T
	XREF	ReadBody__xTEXSURF__TR05XSFIO
	XREF	WriteBody__xTEXSURF__TR05XSFIO
	XREF	ReadyForRead__xTEXSURF__T
	XREF	ReadyForWrite__xTEXSURF__T
	XREF	Refresh__xDBSCREEN__T
	XREF	Close__xDBSCREEN__T
	XREF	Open__xDBSCREEN__T
	XREF	Close__xSCREEN__T
	XREF	Open__xSCREEN__T
	XREF	Set__xSCREEN__TP06xDMODEPCc
	XREF	Close__xDBWIN__T
	XREF	Open__xDBWIN__T
	XREF	Set__xDBWIN__TsssssPCc
	XREF	MoveEvent__xDISPLAYIO__T
	XREF	ResizeEvent__xDISPLAYIO__T
	XREF	Idle__xDISPLAYIO__T
	XREF	HandleEvent__xDISPLAYIO__T
	XREF	ApplyInputModification__xDISPLAYIO__T
	XREF	ViewSurface__xDISPLAY__T
	XREF	DrawSurface__xDISPLAY__T
	XREF	Refresh__xDISPLAY__T
	XREF	Close__xDISPLAY__T
	XREF	Open__xDISPLAY__T
	XREF	_0dt__LOCK__T
	XREF	_0dt__THREAD__T
	XREF	Run__THREAD__T
	XREF	_0dt__DELAY__T
	XREF	_0ct__DELAY__T
	XREF	Pause__DELAY__TUj
	XREF	Pause__DELAY__TUjUj
	XREF	Abort__DELAY__T
	XREF	UnLink__xCHAINABLE__T
	XREF	LinkEnd__xCHAINABLE__TP06xCHAIN
	XREF	_0dt__xSURFACE__T
	XREF	_0dt__POOL_ST__T
	XREF	_0ct__POOL_ST__TUsUj
	XREF	FreeT__POOL_ST__TPv
	XREF	NewT__POOL_ST__TPvUs
	XREF	NewT__POOL_ST__TPv
	XREF	Create__POOL_ST__TUsUj
	XREF	_0dt__POOL_LT__T
	XREF	DrawSurface__x3D__P08xSURFACE
	XREF	v3DrawLineStrip__x3D__jj
	XREF	v3DrawLines__x3D__jj
	XREF	Delete__xPCM__T
	XREF	ReadBody__xPCM__TR05XSFIO
	XREF	WriteBody__xPCM__TR05XSFIO
	XREF	New__PCM__Tjjj
	XREF	SaveRaw16__PCM__TPCc
	XREF	LoadRaw16__PCM__TPCcUss
	XREF	Data__PCM__T
	XREF	Free__PCM__T
	XREF	_0ct__XSFOBJ__T
	XREF	Set__XSFHEAD__TPCcUcUcUcUc
	XREF	op__equal__XSFHEAD__TR05XSFIO
	XREF	op__equal__XSFHEAD__TR07XSFHEAD
	XREF	op__notEqual__XSFHEAD__TR07XSFHEAD
	XREF	Value__XDATAID__TPCc
	XREF	Close__xFILEIO__T
	XREF	Flush__xFILEIO__T
	XREF	Write64Swap__xFILEIO__TPvUi
	XREF	Write32Swap__xFILEIO__TPvUi
	XREF	Write16Swap__xFILEIO__TPvUi
	XREF	Write__xFILEIO__TPvUiUi
	XREF	Read64Swap__xFILEIO__TPvUi
	XREF	Read32Swap__xFILEIO__TPvUi
	XREF	Read16Swap__xFILEIO__TPvUi
	XREF	Read__xFILEIO__TPvUiUi
	XREF	Tell__xFILEIO__T
	XREF	Seek__xFILEIO__Tjj
	XREF	Open__xFILEIO__TPCcjj
	XREF	SendPacket__xFILEIO__TPv
	XREF	WaitPacket__xFILEIO__T
	XREF	InputQueued__xINPUT__T
	XREF	Idle__xINPUT__T
	XREF	ExitEvent__xINPUT__T
	XREF	MouseEvent__xINPUT__Tjjj
	XREF	ApplyInputModification__xINPUT__T
	XREF	_0dt__xKEY__T
	XREF	_0ct__xKEY__T
	XREF	KeyEvent__xKEY__Tjsj
	XREF	Free__MEM__Pv
	XREF	MessageBox__sysBASELIB__PcPcPce
	XREF	Done__xBASELIB_
	XREF	Init__xBASELIB_
	XREF	_stricmp
	XREF	_system
	XREF	_atoi
	XREF	_std__in
	XREF	_std__out
	XREF	_std__err
	XREF	_st
	XREF	_gxSt
	XREF	_numStartArgs__xBASELIB
	XREF	_startArgs__xBASELIB
	XREF	_SysBase
	XREF	_IntuitionBase
	XREF	_TimerBase
	XREF	_DOSBase
	XREF	_PowerPCBase
	XREF	_sysData__sysBASELIB
	XREF	_msgbuff__sysBASELIB
	XREF	_main__sysBASELIB
	XREF	_allocated__MEM
	XREF	_totSize__MEM
	XREF	_nextFree__MEM
	XREF	_cnt__MEM
	XREF	_maxAllocs__MEM
	XREF	_fpuPrecision__CPU
	XREF	_cpuNames__CPU
	XREF	_KeymapBase
	XREF	_useCount__xKEY
	XREF	_AHIBase
	XREF	_AHIport__xAUDIO
	XREF	_AHImain__xAUDIO
	XREF	_flags__xAUDIO
	XREF	_sigXSF__XSFHEAD
	XREF	_fileMarker__XSFOBJ
	XREF	_rawSig__PCM
	XREF	_GfxBase
	XREF	_CyberGfxBase
	XREF	_surfaceTypes__x2D
	XREF	_Warp3DBase
	XREF	_hw3D__sys3DDEVICE
	XREF	_context__sys3DDEVICE
	XREF	_drawRegion__x3D
	XREF	_fogData__x3D
	XREF	_flags__x3D
	XREF	_vertices__x3D
	XREF	_currTex__x3D
	XREF	_drawSurface__x3D
	XREF	_currCol__x3D
	XREF	_useV4__x3D
	XREF	_flags__xGFX
	XREF	_mode__xGFX
	XREF	_numModes__xGFX
	XREF	_rPool__xSURFACE
	XREF	_TimerBase__MILLICLOCK
	XREF	_current__MILLICLOCK
	XREF	_clockFreq__MILLICLOCK
	XREF	_threadCnt__THREAD
	XREF	_threadsIdle__THREAD
	XREF	_rootThread__THREAD
	XREF	_DiskfontBase
	XREF	_flags__DRAW
	XREF	_stack__VGPU
	XREF	_stackPos__VGPU
	XREF	_vertexBase__VGPU
	XREF	_vertexTop__VGPU
	XREF	_dataPos__VGPU
	XREF	_instPos__VGPU
	XREF	_exe_flags__VGPU
	XREF	_exe_stateReg__VGPU
	XREF	_exe_colourReg__VGPU
	XREF	_exe_texReg__VGPU
	XREF	_exe_fogReg__VGPU
	XREF	_exe_errReg__VGPU
	XREF	_funcTab__VGPU
	XREF	_qTrigTab__DRAWLIST
	XREF	_draw
	XREF	_font
	XREF	_xDacName__APP
	XREF	_sourceWave__APP
	XREF	_frame__APP
	XREF	_viewWindow__APP

	SECTION "Round16__r23d:0",CODE

	rts

	SECTION "main__iPPc:0",CODE


;int main(int argc, char* argv[])
	XDEF	main__iPPc
main__iPPc
L187	EQU	-$1A
	link	a5,#L187
	movem.l	d2-d5/a2/a3/a6,-(a7)
	movem.l	$8(a5),d2/a2
L152
;	if (xBASELIB::Init()!=OK)
	jsr	Init__xBASELIB_
	tst.l	d0
	beq.b	L154
L153
;		return 10;
	moveq	#$A,d0
	movem.l	(a7)+,d2-d5/a2/a3/a6
	unlk	a5
	rts
L154
;	char*		aiffName = GetCLIParm(argc, argv, "-snd");
	move.l	#L143,-(a7)
	move.l	a2,-(a7)
	move.l	d2,-(a7)
	jsr	GetCLIParm__iPPcPCc
	add.w	#$C,a7
	move.l	d0,-4(a5)
;	char*		xDacName	= GetCLIParm(argc, argv, "-xdac");
	move.l	#L144,-(a7)
	move.l	a2,-(a7)
	move.l	d2,-(a7)
	jsr	GetCLIParm__iPPcPCc
	add.w	#$C,a7
	move.l	d0,-$8(a5)
;	char*		fsize = GetCLIParm(argc, argv, "-fsize");
	move.l	#L145,-(a7)
	move.l	a2,-(a7)
	move.l	d2,-(a7)
	jsr	GetCLIParm__iPPcPCc
	add.w	#$C,a7
	move.l	d0,a6
;	char*		brate = GetCLIParm(argc, argv, "-brate");
	move.l	#L146,-(a7)
	move.l	a2,-(a7)
	move.l	d2,-(a7)
	jsr	GetCLIParm__iPPcPCc
	add.w	#$C,a7
	move.l	d0,a3
;	bool		fast	= GetCLISwitch(argc, argv, "-fast");
	move.l	#L147,-(a7)
	move.l	a2,-(a7)
	move.l	d2,-(a7)
	jsr	GetCLISwitch__iPPcPCc
	add.w	#$C,a7
	move.w	d0,d5
;	sint32 frameSize = (fsize) ? Clamp(atoi(fsize), 64, 1024) : 256;
	cmp.w	#0,a6
	beq.b	L162
L155
	move.l	#$400,d3
	moveq	#$40,d2
	move.l	a6,-(a7)
	jsr	_atoi
	addq.w	#4,a7
	cmp.l	d2,d0
	bge.b	L157
L156
	bra.b	L161
L157
	cmp.l	d3,d0
	ble.b	L159
L158
	move.l	d3,d2
	bra.b	L160
L159
	move.l	d0,d2
L160
L161
	bra.b	L163
L162
	move.l	#$100,d2
L163
;	sint32 bitRate = (brate) ? Clamp(atoi(brate), 2, 5) : 4;
	cmp.w	#0,a3
	beq.b	L171
L164
	moveq	#5,d4
	moveq	#2,d3
	move.l	a3,-(a7)
	jsr	_atoi
	addq.w	#4,a7
	cmp.l	d3,d0
	bge.b	L166
L165
	move.l	d3,d0
	bra.b	L170
L166
	cmp.l	d4,d0
	ble.b	L168
L167
	move.l	d4,d0
L168
L169
L170
	bra.b	L172
L171
	moveq	#4,d0
L172
;	if (!aiffName)
	tst.l	-4(a5)
	bne.b	L174
L173
;		sysBASELIB::MessageBox("Message", "OK", "No file spe
	move.l	#L148,-(a7)
	move.l	#L149,-(a7)
	move.l	#L150,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
	bra	L186
L174
;		if (APP::Init(aiffName, xDacName, frameSize, bitRate, fast)==OK)
	move.w	d5,-(a7)
	move.l	d0,-(a7)
	move.l	d2,-(a7)
	move.l	-$8(a5),-(a7)
	move.l	-4(a5),-(a7)
	jsr	Init__APP__PCcPCcjjs
	add.w	#$12,a7
	tst.l	d0
	bne	L186
L175
;			while (APP::viewWindow.IsRunning())
	bra.b	L184
L176
;				while (APP::viewWindow.InputQueued())
	bra.b	L178
L177
;					APP::viewWindow.Refresh();
	move.l	#_viewWindow__APP,-(a7)
	jsr	Refresh__APPWINDOW__T
	addq.w	#4,a7
L178
	move.l	#_viewWindow__APP,a0
	cmp.w	#0,a0
	beq.b	L180
L179
	add.w	#$9A,a0
L180
	move.l	a0,-(a7)
	jsr	HandleEvent__xDISPLAYIO__T
	addq.w	#4,a7
	tst.w	d0
	bne.b	L177
L181
;				APP::viewWindow.Idle();
	move.l	#_viewWindow__APP,a0
	cmp.w	#0,a0
	beq.b	L183
L182
	add.w	#$9A,a0
L183
	move.l	a0,-(a7)
	jsr	Idle__xDISPLAYIO__T
	addq.w	#4,a7
L184
	move.l	#_viewWindow__APP,a0
	move.l	$A8(a0),d0
	and.l	#$10000,d0
	seq	d0
	and.l	#1,d0
	tst.w	d0
	bne.b	L176
L185
; 			sysBASELIB::MessageBox("Message", "OK", "Finishe
	move.l	#L151,-(a7)
	move.l	#L149,-(a7)
	move.l	#L150,-(a7)
	jsr	MessageBox__sysBASELIB__PcPcPce
	add.w	#$C,a7
;			APP::Done();
	jsr	Done__APP_
L186
;	xBASELIB::Done();
	jsr	Done__xBASELIB_
;	return 0;
	moveq	#0,d0
	movem.l	(a7)+,d2-d5/a2/a3/a6
	unlk	a5
	rts

L146
	dc.b	'-brate',0
L147
	dc.b	'-fast',0
L145
	dc.b	'-fsize',0
L143
	dc.b	'-snd',0
L144
	dc.b	'-xdac',0
L151
	dc.b	'Finished',0
L150
	dc.b	'Message',0
L148
	dc.b	'No file specified',$A,' use xDAC -snd <name> -xdac <name> -fsize '
	dc.b	'<frame size> -brate <bit rate> [-fast]',0
L149
	dc.b	'OK',0

	SECTION "GetCLIParm__iPPcPCc:0",CODE


;char* GetCLIParm(int argc, char** argv, const char* arg)
	XDEF	GetCLIParm__iPPcPCc
GetCLIParm__iPPcPCc
L195	EQU	-4
	link	a5,#L195
	movem.l	d2/d3/a2/a3,-(a7)
	movem.l	$8(a5),d3/a2/a3
L188
;	for (int i=0;
	moveq	#0,d2
	bra.b	L193
L189
;		if (0 == stricmp(argv[i], arg))
	move.l	a3,-(a7)
	move.l	0(a2,d2.l*4),-(a7)
	jsr	_stricmp
	addq.w	#$8,a7
	tst.l	d0
	bne.b	L192
L190
;			if (++i<argc)
	addq.l	#1,d2
	cmp.l	d3,d2
	bge.b	L192
L191
;				return argv[i];
	move.l	0(a2,d2.l*4),d0
	movem.l	(a7)+,d2/d3/a2/a3
	unlk	a5
	rts
L192
	addq.l	#1,d2
L193
	cmp.l	d3,d2
	blt.b	L189
L194
;	return 0;
	moveq	#0,d0
	movem.l	(a7)+,d2/d3/a2/a3
	unlk	a5
	rts

	SECTION "GetCLISwitch__iPPcPCc:0",CODE


;bool GetCLISwitch(int argc, char** argv, const char* arg)
	XDEF	GetCLISwitch__iPPcPCc
GetCLISwitch__iPPcPCc
L202	EQU	-4
	link	a5,#L202
	movem.l	d2/d3/a2/a3,-(a7)
	movem.l	$8(a5),d3/a2/a3
L196
;	for (int i=0;
	moveq	#0,d2
	bra.b	L200
L197
;		if (0 == stricmp(argv[i], arg))
	move.l	a3,-(a7)
	move.l	0(a2,d2.l*4),-(a7)
	jsr	_stricmp
	addq.w	#$8,a7
	tst.l	d0
	bne.b	L199
L198
;			return TRUE;
	moveq	#1,d0
	movem.l	(a7)+,d2/d3/a2/a3
	unlk	a5
	rts
L199
	addq.l	#1,d2
L200
	cmp.l	d3,d2
	blt.b	L197
L201
;	return FALSE;
	moveq	#0,d0
	movem.l	(a7)+,d2/d3/a2/a3
	unlk	a5
	rts

	END
